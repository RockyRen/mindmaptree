var ma=Object.defineProperty;var ya=(r,t,e)=>t in r?ma(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var _=(r,t,e)=>(ya(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(n){if(n.ep)return;n.ep=!0;const l=e(n);fetch(n.href,l)}})();const ae=()=>new Map,ti=r=>{const t=ae();return r.forEach((e,s)=>{t.set(s,e)}),t},Me=(r,t,e)=>{let s=r.get(t);return s===void 0&&r.set(t,s=e()),s},wa=(r,t)=>{const e=[];for(const[s,n]of r)e.push(t(n,s));return e},va=(r,t)=>{for(const[e,s]of r)if(t(s,e))return!0;return!1},ds=()=>new Set,$r=r=>r[r.length-1],ba=(r,t)=>{for(let e=0;e<t.length;e++)r.push(t[e])},Ie=Array.from,xa=(r,t)=>{for(let e=0;e<r.length;e++)if(t(r[e],e,r))return!0;return!1},ei=Array.isArray;class Xn{constructor(){this._observers=ae()}on(t,e){Me(this._observers,t,ds).add(e)}once(t,e){const s=(...n)=>{this.off(t,s),e(...n)};this.on(t,s)}off(t,e){const s=this._observers.get(t);s!==void 0&&(s.delete(e),s.size===0&&this._observers.delete(t))}emit(t,e){return Ie((this._observers.get(t)||ae()).values()).forEach(s=>s(...e))}destroy(){this._observers=ae()}}const Te=Math.floor,dr=Math.abs,Ld=Math.log10,Wn=(r,t)=>r<t?r:t,Pe=(r,t)=>r>t?r:t,jn=r=>r!==0?r<0:1/r<0,Sa=String.fromCharCode,ka=r=>r.toLowerCase(),_a=/^\s*/g,Ea=r=>r.replace(_a,""),Ca=/([A-Z])/g,sn=(r,t)=>Ea(r.replace(Ca,e=>`${t}${ka(e)}`)),Da=r=>{const t=unescape(encodeURIComponent(r)),e=t.length,s=new Uint8Array(e);for(let n=0;n<e;n++)s[n]=t.codePointAt(n);return s},Rs=typeof TextEncoder<"u"?new TextEncoder:null,Na=r=>Rs.encode(r),La=Rs?Na:Da;let Ms=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ms&&Ms.decode(new Uint8Array).length===1&&(Ms=null);const rn=r=>r===void 0?null:r;class Ba{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let Kn=new Ba,pi=!0;try{typeof localStorage<"u"&&(Kn=localStorage,pi=!1)}catch{}const Ia=Kn,Bd=r=>pi||addEventListener("storage",r),Id=r=>pi||removeEventListener("storage",r),Ta=Object.assign,Ma=Object.keys,Aa=(r,t)=>{for(const e in r)t(r[e],e)},mr=r=>Ma(r).length,Ra=r=>{for(const t in r)return!1;return!0},Oa=(r,t)=>{for(const e in r)if(!t(r[e],e))return!1;return!0},qn=(r,t)=>Object.prototype.hasOwnProperty.call(r,t),Ha=(r,t)=>r===t||mr(r)===mr(t)&&Oa(r,(e,s)=>(e!==void 0||qn(t,s))&&t[s]===e),gi=(r,t,e=0)=>{try{for(;e<r.length;e++)r[e](...t)}finally{e<r.length&&gi(r,t,e+1)}},Fa=()=>{},za=r=>r,Va=(r,t)=>r===t,Pr=(r,t)=>{if(r==null||t==null)return Va(r,t);if(r.constructor!==t.constructor)return!1;if(r===t)return!0;switch(r.constructor){case ArrayBuffer:r=new Uint8Array(r),t=new Uint8Array(t);case Uint8Array:{if(r.byteLength!==t.byteLength)return!1;for(let e=0;e<r.length;e++)if(r[e]!==t[e])return!1;break}case Set:{if(r.size!==t.size)return!1;for(const e of r)if(!t.has(e))return!1;break}case Map:{if(r.size!==t.size)return!1;for(const e of r.keys())if(!t.has(e)||!Pr(r.get(e),t.get(e)))return!1;break}case Object:if(mr(r)!==mr(t))return!1;for(const e in r)if(!qn(r,e)||!Pr(r[e],t[e]))return!1;break;case Array:if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(!Pr(r[e],t[e]))return!1;break;default:return!1}return!0},Ua=(r,t)=>t.includes(r),us=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name),Jn=typeof window<"u"&&typeof document<"u"&&!us;let he;const $a=()=>{if(he===void 0)if(us){he=ae();const r=process.argv;let t=null;for(let e=0;e<r.length;e++){const s=r[e];s[0]==="-"?(t!==null&&he.set(t,""),t=s):t!==null&&(he.set(t,s),t=null)}t!==null&&he.set(t,"")}else typeof location=="object"?(he=ae(),(location.search||"?").slice(1).split("&").forEach(r=>{if(r.length!==0){const[t,e]=r.split("=");he.set(`--${sn(t,"-")}`,e),he.set(`-${sn(t,"-")}`,e)}})):he=ae();return he},si=r=>$a().has(r),yr=r=>rn(us?process.env[r.toUpperCase()]:Ia.getItem(r)),Pa=r=>si("--"+r)||yr(r)!==null;Pa("production");const nn=us&&Ua({}.FORCE_COLOR,["true","1","2"]),Ya=!si("no-colors")&&(!us||process.stdout.isTTY||nn)&&(!us||si("color")||nn||yr("COLORTERM")!==null||(yr("TERM")||"").includes("color")),on=1,an=2,Yr=4,Gr=8,Os=32,ve=64,se=128,Cr=31,ri=63,Fe=127,Ga=2147483647,Zn=Number.MAX_SAFE_INTEGER,Xa=Number.isInteger||(r=>typeof r=="number"&&isFinite(r)&&Te(r)===r),ys=r=>new Error(r),de=()=>{throw ys("Method unimplemented")},ue=()=>{throw ys("Unexpected case")},Qn=ys("Unexpected end of array"),to=ys("Integer out of Range");class Dr{constructor(t){this.arr=t,this.pos=0}}const ws=r=>new Dr(r),Wa=r=>r.pos!==r.arr.length,ja=(r,t)=>{const e=wi(r.arr.buffer,r.pos+r.arr.byteOffset,t);return r.pos+=t,e},Qt=r=>ja(r,wt(r)),fs=r=>r.arr[r.pos++],wt=r=>{let t=0,e=1;const s=r.arr.length;for(;r.pos<s;){const n=r.arr[r.pos++];if(t=t+(n&Fe)*e,e*=128,n<se)return t;if(t>Zn)throw to}throw Qn},mi=r=>{let t=r.arr[r.pos++],e=t&ri,s=64;const n=(t&ve)>0?-1:1;if(!(t&se))return n*e;const l=r.arr.length;for(;r.pos<l;){if(t=r.arr[r.pos++],e=e+(t&Fe)*s,s*=128,t<se)return n*e;if(e>Zn)throw to}throw Qn},Ka=r=>{let t=wt(r);if(t===0)return"";{let e=String.fromCodePoint(fs(r));if(--t<100)for(;t--;)e+=String.fromCodePoint(fs(r));else for(;t>0;){const s=t<1e4?t:1e4,n=r.arr.subarray(r.pos,r.pos+s);r.pos+=s,e+=String.fromCodePoint.apply(null,n),t-=s}return decodeURIComponent(escape(e))}},qa=r=>Ms.decode(Qt(r)),os=Ms?qa:Ka,yi=(r,t)=>{const e=new DataView(r.arr.buffer,r.arr.byteOffset+r.pos,t);return r.pos+=t,e},Ja=r=>yi(r,4).getFloat32(0,!1),Za=r=>yi(r,8).getFloat64(0,!1),Qa=r=>yi(r,8).getBigInt64(0,!1),tl=[r=>{},r=>null,mi,Ja,Za,Qa,r=>!1,r=>!0,os,r=>{const t=wt(r),e={};for(let s=0;s<t;s++){const n=os(r);e[n]=Hs(r)}return e},r=>{const t=wt(r),e=[];for(let s=0;s<t;s++)e.push(Hs(r));return e},Qt],Hs=r=>tl[127-fs(r)](r);class ln extends Dr{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Wa(this)?this.count=wt(this)+1:this.count=-1),this.count--,this.s}}class ur extends Dr{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=mi(this);const t=jn(this.s);this.count=1,t&&(this.s=-this.s,this.count=wt(this)+2)}return this.count--,this.s}}class Xr extends Dr{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=mi(this),e=t&1;this.diff=Te(t/2),this.count=1,e&&(this.count=wt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class el{constructor(t){this.decoder=new ur(t),this.str=os(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}const eo=r=>new Uint8Array(r),wi=(r,t,e)=>new Uint8Array(r,t,e),Td=r=>new Uint8Array(r),sl=r=>{let t="";for(let e=0;e<r.byteLength;e++)t+=Sa(r[e]);return btoa(t)},rl=r=>Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("base64"),il=r=>{const t=atob(r),e=eo(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e},nl=r=>{const t=Buffer.from(r,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Md=Jn?sl:rl,Ad=Jn?il:nl,ol=r=>{const t=eo(r.byteLength);return t.set(r),t};class Gs{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Nr=()=>new Gs,al=r=>{let t=r.cpos;for(let e=0;e<r.bufs.length;e++)t+=r.bufs[e].length;return t},ce=r=>{const t=new Uint8Array(al(r));let e=0;for(let s=0;s<r.bufs.length;s++){const n=r.bufs[s];t.set(n,e),e+=n.length}return t.set(wi(r.cbuf.buffer,0,r.cpos),e),t},ll=(r,t)=>{const e=r.cbuf.length;e-r.cpos<t&&(r.bufs.push(wi(r.cbuf.buffer,0,r.cpos)),r.cbuf=new Uint8Array(Pe(e,t)*2),r.cpos=0)},Ut=(r,t)=>{const e=r.cbuf.length;r.cpos===e&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(e*2),r.cpos=0),r.cbuf[r.cpos++]=t},ii=Ut,St=(r,t)=>{for(;t>Fe;)Ut(r,se|Fe&t),t=Te(t/128);Ut(r,Fe&t)},vi=(r,t)=>{const e=jn(t);for(e&&(t=-t),Ut(r,(t>ri?se:0)|(e?ve:0)|ri&t),t=Te(t/64);t>0;)Ut(r,(t>Fe?se:0)|Fe&t),t=Te(t/128)},ni=new Uint8Array(3e4),hl=ni.length/3,cl=(r,t)=>{if(t.length<hl){const e=Rs.encodeInto(t,ni).written||0;St(r,e);for(let s=0;s<e;s++)Ut(r,ni[s])}else te(r,La(t))},dl=(r,t)=>{const e=unescape(encodeURIComponent(t)),s=e.length;St(r,s);for(let n=0;n<s;n++)Ut(r,e.codePointAt(n))},as=Rs&&Rs.encodeInto?cl:dl,Lr=(r,t)=>{const e=r.cbuf.length,s=r.cpos,n=Wn(e-s,t.length),l=t.length-n;r.cbuf.set(t.subarray(0,n),s),r.cpos+=n,l>0&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(Pe(e*2,l)),r.cbuf.set(t.subarray(n)),r.cpos=l)},te=(r,t)=>{St(r,t.byteLength),Lr(r,t)},bi=(r,t)=>{ll(r,t);const e=new DataView(r.cbuf.buffer,r.cpos,t);return r.cpos+=t,e},ul=(r,t)=>bi(r,4).setFloat32(0,t,!1),fl=(r,t)=>bi(r,8).setFloat64(0,t,!1),pl=(r,t)=>bi(r,8).setBigInt64(0,t,!1),hn=new DataView(new ArrayBuffer(4)),gl=r=>(hn.setFloat32(0,r),hn.getFloat32(0)===r),Fs=(r,t)=>{switch(typeof t){case"string":Ut(r,119),as(r,t);break;case"number":Xa(t)&&dr(t)<=Ga?(Ut(r,125),vi(r,t)):gl(t)?(Ut(r,124),ul(r,t)):(Ut(r,123),fl(r,t));break;case"bigint":Ut(r,122),pl(r,t);break;case"object":if(t===null)Ut(r,126);else if(ei(t)){Ut(r,117),St(r,t.length);for(let e=0;e<t.length;e++)Fs(r,t[e])}else if(t instanceof Uint8Array)Ut(r,116),te(r,t);else{Ut(r,118);const e=Object.keys(t);St(r,e.length);for(let s=0;s<e.length;s++){const n=e[s];as(r,n),Fs(r,t[n])}}break;case"boolean":Ut(r,t?120:121);break;default:Ut(r,127)}};class cn extends Gs{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&St(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const dn=r=>{r.count>0&&(vi(r.encoder,r.count===1?r.s:-r.s),r.count>1&&St(r.encoder,r.count-2))};class fr{constructor(){this.encoder=new Gs,this.s=0,this.count=0}write(t){this.s===t?this.count++:(dn(this),this.count=1,this.s=t)}toUint8Array(){return dn(this),ce(this.encoder)}}const un=r=>{if(r.count>0){const t=r.diff*2+(r.count===1?0:1);vi(r.encoder,t),r.count>1&&St(r.encoder,r.count-2)}};class Wr{constructor(){this.encoder=new Gs,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(un(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return un(this),ce(this.encoder)}}class ml{constructor(){this.sarr=[],this.s="",this.lensE=new fr}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Gs;return this.sarr.push(this.s),this.s="",as(t,this.sarr.join("")),Lr(t,this.lensE.toUint8Array()),ce(t)}}const yl=crypto.getRandomValues.bind(crypto),Rd=Math.random,so=()=>yl(new Uint32Array(1))[0],wl=[1e7]+-1e3+-4e3+-8e3+-1e11,vl=()=>wl.replace(/[018]/g,r=>(r^so()&15>>r/4).toString(16)),xi=Date.now,fn=r=>new Promise(r);Promise.all.bind(Promise);const Od=r=>Promise.reject(r),Hd=r=>Promise.resolve(r);class bl{constructor(t,e){this.left=t,this.right=e}}const we=(r,t)=>new bl(r,t);typeof DOMParser<"u"&&new DOMParser;const xl=r=>wa(r,(t,e)=>`${e}:${t};`).join(""),be=Symbol,ro=be(),io=be(),no=be(),Sl=be(),oo=be(),ao=be(),lo=be(),Si=be(),ho=be(),kl=r=>{const t=[];let e=0;for(;e<r.length;e++){const s=r[e];s.constructor===String||s.constructor===Number||s.constructor===Object&&t.push(JSON.stringify(s))}return t},pn=[oo,lo,Si,no];let jr=0,gn=xi();const _l=(r,t)=>{const e=pn[jr],s=yr("log"),n=s!==null&&(s==="*"||s==="true"||new RegExp(s,"gi").test(t));return jr=(jr+1)%pn.length,t+=": ",n?(...l)=>{const c=xi(),o=c-gn;gn=c,r(e,t,ho,...l.map(h=>typeof h=="string"||typeof h=="symbol"?h:JSON.stringify(h)),e," +"+o+"ms")}:Fa},El={[ro]:we("font-weight","bold"),[io]:we("font-weight","normal"),[no]:we("color","blue"),[oo]:we("color","green"),[Sl]:we("color","grey"),[ao]:we("color","red"),[lo]:we("color","purple"),[Si]:we("color","orange"),[ho]:we("color","black")},Cl=r=>{const t=[],e=[],s=ae();let n=[],l=0;for(;l<r.length;l++){const c=r[l],o=El[c];if(o!==void 0)s.set(o.left,o.right);else if(c.constructor===String||c.constructor===Number){const h=xl(s);l>0||h.length>0?(t.push("%c"+c),e.push(h)):t.push(c)}else break}for(l>0&&(n=e,n.unshift(t.join("")));l<r.length;l++){const c=r[l];c instanceof Symbol||n.push(c)}return n},Dl=Ya?Cl:kl,co=(...r)=>{console.log(...Dl(r)),Nl.forEach(t=>t.print(r))},Nl=ds(),Fd=r=>_l(co,r),uo=r=>({[Symbol.iterator](){return this},next:r}),Ll=(r,t)=>uo(()=>{let e;do e=r.next();while(!e.done&&!t(e.value));return e}),Kr=(r,t)=>uo(()=>{const{done:e,value:s}=r.next();return{done:e,value:e?void 0:t(s)}});class ki{constructor(t,e){this.clock=t,this.len=e}}class vs{constructor(){this.clients=new Map}}const ze=(r,t,e)=>t.clients.forEach((s,n)=>{const l=r.doc.store.clients.get(n);for(let c=0;c<s.length;c++){const o=s[c];_o(r,l,o.clock,o.len,e)}}),Bl=(r,t)=>{let e=0,s=r.length-1;for(;e<=s;){const n=Te((e+s)/2),l=r[n],c=l.clock;if(c<=t){if(t<c+l.len)return n;e=n+1}else s=n-1}return null},Xs=(r,t)=>{const e=r.clients.get(t.client);return e!==void 0&&Bl(e,t.clock)!==null},_i=r=>{r.clients.forEach(t=>{t.sort((n,l)=>n.clock-l.clock);let e,s;for(e=1,s=1;e<t.length;e++){const n=t[s-1],l=t[e];n.clock+n.len>=l.clock?n.len=Pe(n.len,l.clock+l.len-n.clock):(s<e&&(t[s]=l),s++)}t.length=s})},oi=r=>{const t=new vs;for(let e=0;e<r.length;e++)r[e].clients.forEach((s,n)=>{if(!t.clients.has(n)){const l=s.slice();for(let c=e+1;c<r.length;c++)ba(l,r[c].clients.get(n)||[]);t.clients.set(n,l)}});return _i(t),t},zs=(r,t,e,s)=>{Me(r.clients,t,()=>[]).push(new ki(e,s))},Il=()=>new vs,Tl=r=>{const t=Il();return r.clients.forEach((e,s)=>{const n=[];for(let l=0;l<e.length;l++){const c=e[l];if(c.deleted){const o=c.id.clock;let h=c.length;if(l+1<e.length)for(let g=e[l+1];l+1<e.length&&g.deleted;g=e[++l+1])h+=g.length;n.push(new ki(o,h))}}n.length>0&&t.clients.set(s,n)}),t},bs=(r,t)=>{St(r.restEncoder,t.clients.size),Ie(t.clients.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{r.resetDsCurVal(),St(r.restEncoder,e);const n=s.length;St(r.restEncoder,n);for(let l=0;l<n;l++){const c=s[l];r.writeDsClock(c.clock),r.writeDsLen(c.len)}})},Ei=r=>{const t=new vs,e=wt(r.restDecoder);for(let s=0;s<e;s++){r.resetDsCurVal();const n=wt(r.restDecoder),l=wt(r.restDecoder);if(l>0){const c=Me(t.clients,n,()=>[]);for(let o=0;o<l;o++)c.push(new ki(r.readDsClock(),r.readDsLen()))}}return t},mn=(r,t,e)=>{const s=new vs,n=wt(r.restDecoder);for(let l=0;l<n;l++){r.resetDsCurVal();const c=wt(r.restDecoder),o=wt(r.restDecoder),h=e.clients.get(c)||[],g=zt(e,c);for(let m=0;m<o;m++){const E=r.readDsClock(),D=E+r.readDsLen();if(E<g){g<D&&zs(s,c,g,D-g);let L=fe(h,E),I=h[L];for(!I.deleted&&I.id.clock<E&&(h.splice(L+1,0,Er(t,I,E-I.id.clock)),L++);L<h.length&&(I=h[L++],I.id.clock<D);)I.deleted||(D<I.id.clock+I.length&&h.splice(L,0,Er(t,I,D-I.id.clock)),I.delete(t))}else zs(s,c,E,D-E)}}if(s.clients.size>0){const l=new Ve;return St(l.restEncoder,0),bs(l,s),l.toUint8Array()}return null},fo=so;class xs extends Xn{constructor({guid:t=vl(),collectionid:e=null,gc:s=!0,gcFilter:n=()=>!0,meta:l=null,autoLoad:c=!1,shouldLoad:o=!0}={}){super(),this.gc=s,this.gcFilter=n,this.clientID=fo(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new So,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=c,this.meta=l,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=fn(g=>{this.on("load",()=>{this.isLoaded=!0,g(this)})});const h=()=>fn(g=>{const m=E=>{(E===void 0||E===!0)&&(this.off("sync",m),g())};this.on("sync",m)});this.on("sync",g=>{g===!1&&this.isSynced&&(this.whenSynced=h()),this.isSynced=g===void 0||g===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=h()}load(){const t=this._item;t!==null&&!this.shouldLoad&&Mt(t.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ie(this.subdocs).map(t=>t.guid))}transact(t,e=null){return Mt(this,t,e)}get(t,e=$t){const s=Me(this.share,t,()=>{const l=new e;return l._integrate(this,null),l}),n=s.constructor;if(e!==$t&&n!==e)if(n===$t){const l=new e;l._map=s._map,s._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=l}),l._start=s._start;for(let c=l._start;c!==null;c=c.right)c.parent=l;return l._length=s._length,this.share.set(t,l),l._integrate(this,null),l}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return s}getArray(t=""){return this.get(t,hs)}getText(t=""){return this.get(t,ms)}getMap(t=""){return this.get(t,gs)}getXmlFragment(t=""){return this.get(t,Ue)}toJSON(){const t={};return this.share.forEach((e,s)=>{t[s]=e.toJSON()}),t}destroy(){Ie(this.subdocs).forEach(e=>e.destroy());const t=this._item;if(t!==null){this._item=null;const e=t.content;e.doc=new xs({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Mt(t.parent.doc,s=>{const n=e.doc;t.deleted||s.subdocsAdded.add(n),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class po{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return wt(this.restDecoder)}readDsLen(){return wt(this.restDecoder)}}class go extends po{readLeftID(){return vt(wt(this.restDecoder),wt(this.restDecoder))}readRightID(){return vt(wt(this.restDecoder),wt(this.restDecoder))}readClient(){return wt(this.restDecoder)}readInfo(){return fs(this.restDecoder)}readString(){return os(this.restDecoder)}readParentInfo(){return wt(this.restDecoder)===1}readTypeRef(){return wt(this.restDecoder)}readLen(){return wt(this.restDecoder)}readAny(){return Hs(this.restDecoder)}readBuf(){return ol(Qt(this.restDecoder))}readJSON(){return JSON.parse(os(this.restDecoder))}readKey(){return os(this.restDecoder)}}class Ml{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=wt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=wt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ps extends Ml{constructor(t){super(t),this.keys=[],wt(t),this.keyClockDecoder=new Xr(Qt(t)),this.clientDecoder=new ur(Qt(t)),this.leftClockDecoder=new Xr(Qt(t)),this.rightClockDecoder=new Xr(Qt(t)),this.infoDecoder=new ln(Qt(t),fs),this.stringDecoder=new el(Qt(t)),this.parentInfoDecoder=new ln(Qt(t),fs),this.typeRefDecoder=new ur(Qt(t)),this.lenDecoder=new ur(Qt(t))}readLeftID(){return new ls(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ls(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Hs(this.restDecoder)}readBuf(){return Qt(this.restDecoder)}readJSON(){return Hs(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class mo{constructor(){this.restEncoder=Nr()}toUint8Array(){return ce(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){St(this.restEncoder,t)}writeDsLen(t){St(this.restEncoder,t)}}class Ws extends mo{writeLeftID(t){St(this.restEncoder,t.client),St(this.restEncoder,t.clock)}writeRightID(t){St(this.restEncoder,t.client),St(this.restEncoder,t.clock)}writeClient(t){St(this.restEncoder,t)}writeInfo(t){ii(this.restEncoder,t)}writeString(t){as(this.restEncoder,t)}writeParentInfo(t){St(this.restEncoder,t?1:0)}writeTypeRef(t){St(this.restEncoder,t)}writeLen(t){St(this.restEncoder,t)}writeAny(t){Fs(this.restEncoder,t)}writeBuf(t){te(this.restEncoder,t)}writeJSON(t){as(this.restEncoder,JSON.stringify(t))}writeKey(t){as(this.restEncoder,t)}}class yo{constructor(){this.restEncoder=Nr(),this.dsCurrVal=0}toUint8Array(){return ce(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,St(this.restEncoder,e)}writeDsLen(t){t===0&&ue(),St(this.restEncoder,t-1),this.dsCurrVal+=t}}class Ve extends yo{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Wr,this.clientEncoder=new fr,this.leftClockEncoder=new Wr,this.rightClockEncoder=new Wr,this.infoEncoder=new cn(ii),this.stringEncoder=new ml,this.parentInfoEncoder=new cn(ii),this.typeRefEncoder=new fr,this.lenEncoder=new fr}toUint8Array(){const t=Nr();return St(t,0),te(t,this.keyClockEncoder.toUint8Array()),te(t,this.clientEncoder.toUint8Array()),te(t,this.leftClockEncoder.toUint8Array()),te(t,this.rightClockEncoder.toUint8Array()),te(t,ce(this.infoEncoder)),te(t,this.stringEncoder.toUint8Array()),te(t,ce(this.parentInfoEncoder)),te(t,this.typeRefEncoder.toUint8Array()),te(t,this.lenEncoder.toUint8Array()),Lr(t,ce(this.restEncoder)),ce(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Fs(this.restEncoder,t)}writeBuf(t){te(this.restEncoder,t)}writeJSON(t){Fs(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);e===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Al=(r,t,e,s)=>{s=Pe(s,t[0].id.clock);const n=fe(t,s);St(r.restEncoder,t.length-n),r.writeClient(e),St(r.restEncoder,s);const l=t[n];l.write(r,s-l.id.clock);for(let c=n+1;c<t.length;c++)t[c].write(r,0)},Ci=(r,t,e)=>{const s=new Map;e.forEach((n,l)=>{zt(t,l)>n&&s.set(l,n)}),Br(t).forEach((n,l)=>{e.has(l)||s.set(l,0)}),St(r.restEncoder,s.size),Ie(s.entries()).sort((n,l)=>l[0]-n[0]).forEach(([n,l])=>{Al(r,t.clients.get(n),n,l)})},Rl=(r,t)=>{const e=ae(),s=wt(r.restDecoder);for(let n=0;n<s;n++){const l=wt(r.restDecoder),c=new Array(l),o=r.readClient();let h=wt(r.restDecoder);e.set(o,{i:0,refs:c});for(let g=0;g<l;g++){const m=r.readInfo();switch(Cr&m){case 0:{const E=r.readLen();c[g]=new ie(vt(o,h),E),h+=E;break}case 10:{const E=wt(r.restDecoder);c[g]=new ne(vt(o,h),E),h+=E;break}default:{const E=(m&(ve|se))===0,D=new At(vt(o,h),null,(m&se)===se?r.readLeftID():null,null,(m&ve)===ve?r.readRightID():null,E?r.readParentInfo()?t.get(r.readString()):r.readLeftID():null,E&&(m&Os)===Os?r.readString():null,Yo(r,m));c[g]=D,h+=D.length}}}}return e},Ol=(r,t,e)=>{const s=[];let n=Ie(e.keys()).sort((L,I)=>L-I);if(n.length===0)return null;const l=()=>{if(n.length===0)return null;let L=e.get(n[n.length-1]);for(;L.refs.length===L.i;)if(n.pop(),n.length>0)L=e.get(n[n.length-1]);else return null;return L};let c=l();if(c===null&&s.length===0)return null;const o=new So,h=new Map,g=(L,I)=>{const O=h.get(L);(O==null||O>I)&&h.set(L,I)};let m=c.refs[c.i++];const E=new Map,D=()=>{for(const L of s){const I=L.id.client,O=e.get(I);O?(O.i--,o.clients.set(I,O.refs.slice(O.i)),e.delete(I),O.i=0,O.refs=[]):o.clients.set(I,[L]),n=n.filter(q=>q!==I)}s.length=0};for(;;){if(m.constructor!==ne){const I=Me(E,m.id.client,()=>zt(t,m.id.client))-m.id.clock;if(I<0)s.push(m),g(m.id.client,m.id.clock-1),D();else{const O=m.getMissing(r,t);if(O!==null){s.push(m);const q=e.get(O)||{refs:[],i:0};if(q.refs.length===q.i)g(O,zt(t,O)),D();else{m=q.refs[q.i++];continue}}else(I===0||I<m.length)&&(m.integrate(r,I),E.set(m.id.client,m.id.clock+m.length))}}if(s.length>0)m=s.pop();else if(c!==null&&c.i<c.refs.length)m=c.refs[c.i++];else{if(c=l(),c===null)break;m=c.refs[c.i++]}}if(o.clients.size>0){const L=new Ve;return Ci(L,o,new Map),St(L.restEncoder,0),{missing:h,update:L.toUint8Array()}}return null},Hl=(r,t)=>Ci(r,t.doc.store,t.beforeState),Fl=(r,t,e,s=new ps(r))=>Mt(t,n=>{n.local=!1;let l=!1;const c=n.doc,o=c.store,h=Rl(s,c),g=Ol(n,o,h),m=o.pendingStructs;if(m){for(const[D,L]of m.missing)if(L<zt(o,D)){l=!0;break}if(g){for(const[D,L]of g.missing){const I=m.missing.get(D);(I==null||I>L)&&m.missing.set(D,L)}m.update=vr([m.update,g.update])}}else o.pendingStructs=g;const E=mn(s,n,o);if(o.pendingDs){const D=new ps(ws(o.pendingDs));wt(D.restDecoder);const L=mn(D,n,o);E&&L?o.pendingDs=vr([E,L]):o.pendingDs=E||L}else o.pendingDs=E;if(l){const D=o.pendingStructs.update;o.pendingStructs=null,wo(n.doc,D)}},e,!1),wo=(r,t,e,s=ps)=>{const n=ws(t);Fl(n,r,e,new s(n))},zd=(r,t,e)=>wo(r,t,e,go),zl=(r,t,e=new Map)=>{Ci(r,t.store,e),bs(r,Tl(t.store))},Vl=(r,t=new Uint8Array([0]),e=new Ve)=>{const s=vo(t);zl(e,r,s);const n=[e.toUint8Array()];if(r.store.pendingDs&&n.push(r.store.pendingDs),r.store.pendingStructs&&n.push(sh(r.store.pendingStructs.update,t)),n.length>1){if(e.constructor===Ws)return th(n.map((l,c)=>c===0?l:ih(l)));if(e.constructor===Ve)return vr(n)}return n[0]},Vd=(r,t)=>Vl(r,t,new Ws),Ul=r=>{const t=new Map,e=wt(r.restDecoder);for(let s=0;s<e;s++){const n=wt(r.restDecoder),l=wt(r.restDecoder);t.set(n,l)}return t},vo=r=>Ul(new po(ws(r))),bo=(r,t)=>(St(r.restEncoder,t.size),Ie(t.entries()).sort((e,s)=>s[0]-e[0]).forEach(([e,s])=>{St(r.restEncoder,e),St(r.restEncoder,s)}),r),$l=(r,t)=>bo(r,Br(t.store)),Pl=(r,t=new yo)=>(r instanceof Map?bo(t,r):$l(t,r),t.toUint8Array()),Ud=r=>Pl(r,new mo);class Yl{constructor(){this.l=[]}}const yn=()=>new Yl,wn=(r,t)=>r.l.push(t),vn=(r,t)=>{const e=r.l,s=e.length;r.l=e.filter(n=>t!==n),s===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},xo=(r,t,e)=>gi(r.l,[t,e]);class ls{constructor(t,e){this.client=t,this.clock=e}}const ir=(r,t)=>r===t||r!==null&&t!==null&&r.client===t.client&&r.clock===t.clock,vt=(r,t)=>new ls(r,t),Gl=r=>{for(const[t,e]of r.doc.share.entries())if(e===r)return t;throw ue()},wr=(r,t)=>{for(;t!==null;){if(t.parent===r)return!0;t=t.parent._item}return!1},Ts=(r,t)=>t===void 0?!r.deleted:t.sv.has(r.id.client)&&(t.sv.get(r.id.client)||0)>r.id.clock&&!Xs(t.ds,r.id),ai=(r,t)=>{const e=Me(r.meta,ai,ds),s=r.doc.store;e.has(t)||(t.sv.forEach((n,l)=>{n<zt(s,l)&&qt(r,vt(l,n))}),ze(r,t.ds,n=>{}),e.add(t))};class So{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Br=r=>{const t=new Map;return r.clients.forEach((e,s)=>{const n=e[e.length-1];t.set(s,n.id.clock+n.length)}),t},zt=(r,t)=>{const e=r.clients.get(t);if(e===void 0)return 0;const s=e[e.length-1];return s.id.clock+s.length},ko=(r,t)=>{let e=r.clients.get(t.id.client);if(e===void 0)e=[],r.clients.set(t.id.client,e);else{const s=e[e.length-1];if(s.id.clock+s.length!==t.id.clock)throw ue()}e.push(t)},fe=(r,t)=>{let e=0,s=r.length-1,n=r[s],l=n.id.clock;if(l===t)return s;let c=Te(t/(l+n.length-1)*s);for(;e<=s;){if(n=r[c],l=n.id.clock,l<=t){if(t<l+n.length)return c;e=c+1}else s=c-1;c=Te((e+s)/2)}throw ue()},Xl=(r,t)=>{const e=r.clients.get(t.client);return e[fe(e,t.clock)]},pr=Xl,li=(r,t,e)=>{const s=fe(t,e),n=t[s];return n.id.clock<e&&n instanceof At?(t.splice(s+1,0,Er(r,n,e-n.id.clock)),s+1):s},qt=(r,t)=>{const e=r.doc.store.clients.get(t.client);return e[li(r,e,t.clock)]},bn=(r,t,e)=>{const s=t.clients.get(e.client),n=fe(s,e.clock),l=s[n];return e.clock!==l.id.clock+l.length-1&&l.constructor!==ie&&s.splice(n+1,0,Er(r,l,e.clock-l.id.clock+1)),l},Wl=(r,t,e)=>{const s=r.clients.get(t.id.client);s[fe(s,t.id.clock)]=e},_o=(r,t,e,s,n)=>{if(s===0)return;const l=e+s;let c=li(r,t,e),o;do o=t[c++],l<o.id.clock+o.length&&li(r,t,l),n(o);while(c<t.length&&t[c].id.clock<l)};class jl{constructor(t,e,s){this.doc=t,this.deleteSet=new vs,this.beforeState=Br(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const xn=(r,t)=>t.deleteSet.clients.size===0&&!va(t.afterState,(e,s)=>t.beforeState.get(s)!==e)?!1:(_i(t.deleteSet),Hl(r,t),bs(r,t.deleteSet),!0),Sn=(r,t,e)=>{const s=t._item;(s===null||s.id.clock<(r.beforeState.get(s.id.client)||0)&&!s.deleted)&&Me(r.changed,t,ds).add(e)},gr=(r,t)=>{const e=r[t-1],s=r[t];e.deleted===s.deleted&&e.constructor===s.constructor&&e.mergeWith(s)&&(r.splice(t,1),s instanceof At&&s.parentSub!==null&&s.parent._map.get(s.parentSub)===s&&s.parent._map.set(s.parentSub,e))},Kl=(r,t,e)=>{for(const[s,n]of r.clients.entries()){const l=t.clients.get(s);for(let c=n.length-1;c>=0;c--){const o=n[c],h=o.clock+o.len;for(let g=fe(l,o.clock),m=l[g];g<l.length&&m.id.clock<h;m=l[++g]){const E=l[g];if(o.clock+o.len<=E.id.clock)break;E instanceof At&&E.deleted&&!E.keep&&e(E)&&E.gc(t,!1)}}}},ql=(r,t)=>{r.clients.forEach((e,s)=>{const n=t.clients.get(s);for(let l=e.length-1;l>=0;l--){const c=e[l],o=Wn(n.length-1,1+fe(n,c.clock+c.len-1));for(let h=o,g=n[h];h>0&&g.id.clock>=c.clock;g=n[--h])gr(n,h)}})},Eo=(r,t)=>{if(t<r.length){const e=r[t],s=e.doc,n=s.store,l=e.deleteSet,c=e._mergeStructs;try{_i(l),e.afterState=Br(e.doc.store),s.emit("beforeObserverCalls",[e,s]);const o=[];e.changed.forEach((h,g)=>o.push(()=>{(g._item===null||!g._item.deleted)&&g._callObserver(e,h)})),o.push(()=>{e.changedParentTypes.forEach((h,g)=>o.push(()=>{(g._item===null||!g._item.deleted)&&(h=h.filter(m=>m.target._item===null||!m.target._item.deleted),h.forEach(m=>{m.currentTarget=g}),h.sort((m,E)=>m.path.length-E.path.length),xo(g._dEH,h,e))})),o.push(()=>s.emit("afterTransaction",[e,s]))}),gi(o,[])}finally{s.gc&&Kl(l,n,s.gcFilter),ql(l,n),e.afterState.forEach((m,E)=>{const D=e.beforeState.get(E)||0;if(D!==m){const L=n.clients.get(E),I=Pe(fe(L,D),1);for(let O=L.length-1;O>=I;O--)gr(L,O)}});for(let m=0;m<c.length;m++){const{client:E,clock:D}=c[m].id,L=n.clients.get(E),I=fe(L,D);I+1<L.length&&gr(L,I+1),I>0&&gr(L,I)}if(!e.local&&e.afterState.get(s.clientID)!==e.beforeState.get(s.clientID)&&(co(Si,ro,"[yjs] ",io,ao,"Changed the client-id because another client seems to be using it."),s.clientID=fo()),s.emit("afterTransactionCleanup",[e,s]),s._observers.has("update")){const m=new Ws;xn(m,e)&&s.emit("update",[m.toUint8Array(),e.origin,s,e])}if(s._observers.has("updateV2")){const m=new Ve;xn(m,e)&&s.emit("updateV2",[m.toUint8Array(),e.origin,s,e])}const{subdocsAdded:o,subdocsLoaded:h,subdocsRemoved:g}=e;(o.size>0||g.size>0||h.size>0)&&(o.forEach(m=>{m.clientID=s.clientID,m.collectionid==null&&(m.collectionid=s.collectionid),s.subdocs.add(m)}),g.forEach(m=>s.subdocs.delete(m)),s.emit("subdocs",[{loaded:h,added:o,removed:g},s,e]),g.forEach(m=>m.destroy())),r.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,r])):Eo(r,t+1)}}},Mt=(r,t,e=null,s=!0)=>{const n=r._transactionCleanups;let l=!1,c=null;r._transaction===null&&(l=!0,r._transaction=new jl(r,e,s),n.push(r._transaction),n.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{c=t(r._transaction)}finally{if(l){const o=r._transaction===n[0];r._transaction=null,o&&Eo(n,0)}}return c};class Jl{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const kn=(r,t,e)=>{ze(r,e.deletions,s=>{s instanceof At&&t.scope.some(n=>wr(n,s))&&Ai(s,!1)})},_n=(r,t,e)=>{let s=null,n=null;const l=r.doc,c=r.scope;if(Mt(l,o=>{for(;t.length>0&&s===null;){const h=l.store,g=t.pop(),m=new Set,E=[];let D=!1;ze(o,g.insertions,L=>{if(L instanceof At){if(L.redone!==null){let{item:I,diff:O}=$h(h,L.id);O>0&&(I=qt(o,vt(I.id.client,I.id.clock+O))),L=I}!L.deleted&&c.some(I=>wr(I,L))&&E.push(L)}}),ze(o,g.deletions,L=>{L instanceof At&&c.some(I=>wr(I,L))&&!Xs(g.insertions,L.id)&&m.add(L)}),m.forEach(L=>{D=Po(o,L,m,g.insertions,r.ignoreRemoteMapChanges,r)!==null||D});for(let L=E.length-1;L>=0;L--){const I=E[L];r.deleteFilter(I)&&(I.delete(o),D=!0)}s=D?g:null}o.changed.forEach((h,g)=>{h.has(null)&&g._searchMarker&&(g._searchMarker.length=0)}),n=o},r),s!=null){const o=n.changedParentTypes;r.emit("stack-item-popped",[{stackItem:s,type:e,changedParentTypes:o},r])}return s};class Zl extends Xn{constructor(t,{captureTimeout:e=500,captureTransaction:s=h=>!0,deleteFilter:n=()=>!0,trackedOrigins:l=new Set([null]),ignoreRemoteMapChanges:c=!1,doc:o=ei(t)?t[0].doc:t.doc}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=n,l.add(this),this.trackedOrigins=l,this.captureTransaction=s,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=o,this.lastChange=0,this.ignoreRemoteMapChanges=c,this.captureTimeout=e,this.afterTransactionHandler=h=>{if(!this.captureTransaction(h)||!this.scope.some(q=>h.changedParentTypes.has(q))||!this.trackedOrigins.has(h.origin)&&(!h.origin||!this.trackedOrigins.has(h.origin.constructor)))return;const g=this.undoing,m=this.redoing,E=g?this.redoStack:this.undoStack;g?this.stopCapturing():m||this.clear(!1,!0);const D=new vs;h.afterState.forEach((q,it)=>{const Z=h.beforeState.get(it)||0,H=q-Z;H>0&&zs(D,it,Z,H)});const L=xi();let I=!1;if(this.lastChange>0&&L-this.lastChange<this.captureTimeout&&E.length>0&&!g&&!m){const q=E[E.length-1];q.deletions=oi([q.deletions,h.deleteSet]),q.insertions=oi([q.insertions,D])}else E.push(new Jl(h.deleteSet,D)),I=!0;!g&&!m&&(this.lastChange=L),ze(h,h.deleteSet,q=>{q instanceof At&&this.scope.some(it=>wr(it,q))&&Ai(q,!0)});const O=[{stackItem:E[E.length-1],origin:h.origin,type:g?"redo":"undo",changedParentTypes:h.changedParentTypes},this];I?this.emit("stack-item-added",O):this.emit("stack-item-updated",O)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){t=ei(t)?t:[t],t.forEach(e=>{this.scope.every(s=>s!==e)&&this.scope.push(e)})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(s=>{t&&(this.undoStack.forEach(n=>kn(s,this,n)),this.undoStack=[]),e&&(this.redoStack.forEach(n=>kn(s,this,n)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=_n(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=_n(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Ql(r){const t=wt(r.restDecoder);for(let e=0;e<t;e++){const s=wt(r.restDecoder),n=r.readClient();let l=wt(r.restDecoder);for(let c=0;c<s;c++){const o=r.readInfo();if(o===10){const h=wt(r.restDecoder);yield new ne(vt(n,l),h),l+=h}else if(Cr&o){const h=(o&(ve|se))===0,g=new At(vt(n,l),null,(o&se)===se?r.readLeftID():null,null,(o&ve)===ve?r.readRightID():null,h?r.readParentInfo()?r.readString():r.readLeftID():null,h&&(o&Os)===Os?r.readString():null,Yo(r,o));yield g,l+=g.length}else{const h=r.readLen();yield new ie(vt(n,l),h),l+=h}}}}class Di{constructor(t,e){this.gen=Ql(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ne);return this.curr}}class Ni{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const th=r=>vr(r,go,Ws),eh=(r,t)=>{if(r.constructor===ie){const{client:e,clock:s}=r.id;return new ie(vt(e,s+t),r.length-t)}else if(r.constructor===ne){const{client:e,clock:s}=r.id;return new ne(vt(e,s+t),r.length-t)}else{const e=r,{client:s,clock:n}=e.id;return new At(vt(s,n+t),null,vt(s,n+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},vr=(r,t=ps,e=Ve)=>{if(r.length===1)return r[0];const s=r.map(m=>new t(ws(m)));let n=s.map(m=>new Di(m,!0)),l=null;const c=new e,o=new Ni(c);for(;n=n.filter(D=>D.curr!==null),n.sort((D,L)=>{if(D.curr.id.client===L.curr.id.client){const I=D.curr.id.clock-L.curr.id.clock;return I===0?D.curr.constructor===L.curr.constructor?0:D.curr.constructor===ne?1:-1:I}else return L.curr.id.client-D.curr.id.client}),n.length!==0;){const m=n[0],E=m.curr.id.client;if(l!==null){let D=m.curr,L=!1;for(;D!==null&&D.id.clock+D.length<=l.struct.id.clock+l.struct.length&&D.id.client>=l.struct.id.client;)D=m.next(),L=!0;if(D===null||D.id.client!==E||L&&D.id.clock>l.struct.id.clock+l.struct.length)continue;if(E!==l.struct.id.client)Le(o,l.struct,l.offset),l={struct:D,offset:0},m.next();else if(l.struct.id.clock+l.struct.length<D.id.clock)if(l.struct.constructor===ne)l.struct.length=D.id.clock+D.length-l.struct.id.clock;else{Le(o,l.struct,l.offset);const I=D.id.clock-l.struct.id.clock-l.struct.length;l={struct:new ne(vt(E,l.struct.id.clock+l.struct.length),I),offset:0}}else{const I=l.struct.id.clock+l.struct.length-D.id.clock;I>0&&(l.struct.constructor===ne?l.struct.length-=I:D=eh(D,I)),l.struct.mergeWith(D)||(Le(o,l.struct,l.offset),l={struct:D,offset:0},m.next())}}else l={struct:m.curr,offset:0},m.next();for(let D=m.curr;D!==null&&D.id.client===E&&D.id.clock===l.struct.id.clock+l.struct.length&&D.constructor!==ne;D=m.next())Le(o,l.struct,l.offset),l={struct:D,offset:0}}l!==null&&(Le(o,l.struct,l.offset),l=null),Li(o);const h=s.map(m=>Ei(m)),g=oi(h);return bs(c,g),c.toUint8Array()},sh=(r,t,e=ps,s=Ve)=>{const n=vo(t),l=new s,c=new Ni(l),o=new e(ws(r)),h=new Di(o,!1);for(;h.curr;){const m=h.curr,E=m.id.client,D=n.get(E)||0;if(h.curr.constructor===ne){h.next();continue}if(m.id.clock+m.length>D)for(Le(c,m,Pe(D-m.id.clock,0)),h.next();h.curr&&h.curr.id.client===E;)Le(c,h.curr,0),h.next();else for(;h.curr&&h.curr.id.client===E&&h.curr.id.clock+h.curr.length<=D;)h.next()}Li(c);const g=Ei(o);return bs(l,g),l.toUint8Array()},Co=r=>{r.written>0&&(r.clientStructs.push({written:r.written,restEncoder:ce(r.encoder.restEncoder)}),r.encoder.restEncoder=Nr(),r.written=0)},Le=(r,t,e)=>{r.written>0&&r.currClient!==t.id.client&&Co(r),r.written===0&&(r.currClient=t.id.client,r.encoder.writeClient(t.id.client),St(r.encoder.restEncoder,t.id.clock+e)),t.write(r.encoder,e),r.written++},Li=r=>{Co(r);const t=r.encoder.restEncoder;St(t,r.clientStructs.length);for(let e=0;e<r.clientStructs.length;e++){const s=r.clientStructs[e];St(t,s.written),Lr(t,s.restEncoder)}},rh=(r,t,e,s)=>{const n=new e(ws(r)),l=new Di(n,!1),c=new s,o=new Ni(c);for(let g=l.curr;g!==null;g=l.next())Le(o,t(g),0);Li(o);const h=Ei(n);return bs(c,h),c.toUint8Array()},ih=r=>rh(r,za,ps,Ws);class Ir{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return nh(this.currentTarget,this.target)}deletes(t){return Xs(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,e=this.target;this.transaction.changed.get(e).forEach(n=>{if(n!==null){const l=e._map.get(n);let c,o;if(this.adds(l)){let h=l.left;for(;h!==null&&this.adds(h);)h=h.left;if(this.deletes(l))if(h!==null&&this.deletes(h))c="delete",o=$r(h.content.getContent());else return;else h!==null&&this.deletes(h)?(c="update",o=$r(h.content.getContent())):(c="add",o=void 0)}else if(this.deletes(l))c="delete",o=$r(l.content.getContent());else return;t.set(n,{action:c,oldValue:o})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const e=this.target,s=ds(),n=ds(),l=[];if(t={added:s,deleted:n,delta:l,keys:this.keys},this.transaction.changed.get(e).has(null)){let o=null;const h=()=>{o&&l.push(o)};for(let g=e._start;g!==null;g=g.right)g.deleted?this.deletes(g)&&!this.adds(g)&&((o===null||o.delete===void 0)&&(h(),o={delete:0}),o.delete+=g.length,n.add(g)):this.adds(g)?((o===null||o.insert===void 0)&&(h(),o={insert:[]}),o.insert=o.insert.concat(g.content.getContent()),s.add(g)):((o===null||o.retain===void 0)&&(h(),o={retain:0}),o.retain+=g.length);o!==null&&o.retain===void 0&&h()}this._changes=t}return t}}const nh=(r,t)=>{const e=[];for(;t._item!==null&&t!==r;){if(t._item.parentSub!==null)e.unshift(t._item.parentSub);else{let s=0,n=t._item.parent._start;for(;n!==t._item&&n!==null;)n.deleted||s++,n=n.right;e.unshift(s)}t=t._item.parent}return e},Do=80;let Bi=0;class oh{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=Bi++}}const ah=r=>{r.timestamp=Bi++},No=(r,t,e)=>{r.p.marker=!1,r.p=t,t.marker=!0,r.index=e,r.timestamp=Bi++},lh=(r,t,e)=>{if(r.length>=Do){const s=r.reduce((n,l)=>n.timestamp<l.timestamp?n:l);return No(s,t,e),s}else{const s=new oh(t,e);return r.push(s),s}},Tr=(r,t)=>{if(r._start===null||t===0||r._searchMarker===null)return null;const e=r._searchMarker.length===0?null:r._searchMarker.reduce((l,c)=>dr(t-l.index)<dr(t-c.index)?l:c);let s=r._start,n=0;for(e!==null&&(s=e.p,n=e.index,ah(e));s.right!==null&&n<t;){if(!s.deleted&&s.countable){if(t<n+s.length)break;n+=s.length}s=s.right}for(;s.left!==null&&n>t;)s=s.left,!s.deleted&&s.countable&&(n-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(n-=s.length);return e!==null&&dr(e.index-n)<s.parent.length/Do?(No(e,s,n),e):lh(r._searchMarker,s,n)},Vs=(r,t,e)=>{for(let s=r.length-1;s>=0;s--){const n=r[s];if(e>0){let l=n.p;for(l.marker=!1;l&&(l.deleted||!l.countable);)l=l.left,l&&!l.deleted&&l.countable&&(n.index-=l.length);if(l===null||l.marker===!0){r.splice(s,1);continue}n.p=l,l.marker=!0}(t<n.index||e>0&&t===n.index)&&(n.index=Pe(t,n.index+e))}},Mr=(r,t,e)=>{const s=r,n=t.changedParentTypes;for(;Me(n,r,()=>[]).push(e),r._item!==null;)r=r._item.parent;xo(s._eH,e,t)};class $t{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=yn(),this._dEH=yn(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw de()}clone(){throw de()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){wn(this._eH,t)}observeDeep(t){wn(this._dEH,t)}unobserve(t){vn(this._eH,t)}unobserveDeep(t){vn(this._dEH,t)}toJSON(){}}const Lo=(r,t,e)=>{t<0&&(t=r._length+t),e<0&&(e=r._length+e);let s=e-t;const n=[];let l=r._start;for(;l!==null&&s>0;){if(l.countable&&!l.deleted){const c=l.content.getContent();if(c.length<=t)t-=c.length;else{for(let o=t;o<c.length&&s>0;o++)n.push(c[o]),s--;t=0}}l=l.right}return n},Bo=r=>{const t=[];let e=r._start;for(;e!==null;){if(e.countable&&!e.deleted){const s=e.content.getContent();for(let n=0;n<s.length;n++)t.push(s[n])}e=e.right}return t},Us=(r,t)=>{let e=0,s=r._start;for(;s!==null;){if(s.countable&&!s.deleted){const n=s.content.getContent();for(let l=0;l<n.length;l++)t(n[l],e++,r)}s=s.right}},Io=(r,t)=>{const e=[];return Us(r,(s,n)=>{e.push(t(s,n,r))}),e},hh=r=>{let t=r._start,e=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(e===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};e=t.content.getContent(),s=0,t=t.right}const n=e[s++];return e.length<=s&&(e=null),{done:!1,value:n}}}},To=(r,t)=>{const e=Tr(r,t);let s=r._start;for(e!==null&&(s=e.p,t-=e.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},br=(r,t,e,s)=>{let n=e;const l=r.doc,c=l.clientID,o=l.store,h=e===null?t._start:e.right;let g=[];const m=()=>{g.length>0&&(n=new At(vt(c,zt(o,c)),n,n&&n.lastId,h,h&&h.id,t,null,new $e(g)),n.integrate(r,0),g=[])};s.forEach(E=>{if(E===null)g.push(E);else switch(E.constructor){case Number:case Object:case Boolean:case Array:case String:g.push(E);break;default:switch(m(),E.constructor){case Uint8Array:case ArrayBuffer:n=new At(vt(c,zt(o,c)),n,n&&n.lastId,h,h&&h.id,t,null,new js(new Uint8Array(E))),n.integrate(r,0);break;case xs:n=new At(vt(c,zt(o,c)),n,n&&n.lastId,h,h&&h.id,t,null,new Ks(E)),n.integrate(r,0);break;default:if(E instanceof $t)n=new At(vt(c,zt(o,c)),n,n&&n.lastId,h,h&&h.id,t,null,new xe(E)),n.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),m()},Mo=ys("Length exceeded!"),Ao=(r,t,e,s)=>{if(e>t._length)throw Mo;if(e===0)return t._searchMarker&&Vs(t._searchMarker,e,s.length),br(r,t,null,s);const n=e,l=Tr(t,e);let c=t._start;for(l!==null&&(c=l.p,e-=l.index,e===0&&(c=c.prev,e+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(e<=c.length){e<c.length&&qt(r,vt(c.id.client,c.id.clock+e));break}e-=c.length}return t._searchMarker&&Vs(t._searchMarker,n,s.length),br(r,t,c,s)},ch=(r,t,e)=>{let n=(t._searchMarker||[]).reduce((l,c)=>c.index>l.index?c:l,{index:0,p:t._start}).p;if(n)for(;n.right;)n=n.right;return br(r,t,n,e)},Ro=(r,t,e,s)=>{if(s===0)return;const n=e,l=s,c=Tr(t,e);let o=t._start;for(c!==null&&(o=c.p,e-=c.index);o!==null&&e>0;o=o.right)!o.deleted&&o.countable&&(e<o.length&&qt(r,vt(o.id.client,o.id.clock+e)),e-=o.length);for(;s>0&&o!==null;)o.deleted||(s<o.length&&qt(r,vt(o.id.client,o.id.clock+s)),o.delete(r),s-=o.length),o=o.right;if(s>0)throw Mo;t._searchMarker&&Vs(t._searchMarker,n,-l+s)},xr=(r,t,e)=>{const s=t._map.get(e);s!==void 0&&s.delete(r)},Ii=(r,t,e,s)=>{const n=t._map.get(e)||null,l=r.doc,c=l.clientID;let o;if(s==null)o=new $e([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:o=new $e([s]);break;case Uint8Array:o=new js(s);break;case xs:o=new Ks(s);break;default:if(s instanceof $t)o=new xe(s);else throw new Error("Unexpected content type")}new At(vt(c,zt(l.store,c)),n,n&&n.lastId,null,null,t,e,o).integrate(r,0)},Ti=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted?e.content.getContent()[e.length-1]:void 0},Oo=r=>{const t={};return r._map.forEach((e,s)=>{e.deleted||(t[s]=e.content.getContent()[e.length-1])}),t},Ho=(r,t)=>{const e=r._map.get(t);return e!==void 0&&!e.deleted},nr=r=>Ll(r.entries(),t=>!t[1].deleted);class dh extends Ir{constructor(t,e){super(t,e),this._transaction=e}}class hs extends $t{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new hs;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new hs}clone(){const t=new hs;return t.insert(0,this.toArray().map(e=>e instanceof $t?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),Mr(this,t,new dh(this,t))}insert(t,e){this.doc!==null?Mt(this.doc,s=>{Ao(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}push(t){this.doc!==null?Mt(this.doc,e=>{ch(e,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){this.doc!==null?Mt(this.doc,s=>{Ro(s,this,t,e)}):this._prelimContent.splice(t,e)}get(t){return To(this,t)}toArray(){return Bo(this)}slice(t=0,e=this.length){return Lo(this,t,e)}toJSON(){return this.map(t=>t instanceof $t?t.toJSON():t)}map(t){return Io(this,t)}forEach(t){Us(this,t)}[Symbol.iterator](){return hh(this)}_write(t){t.writeTypeRef(Ah)}}const uh=r=>new hs;class fh extends Ir{constructor(t,e,s){super(t,e),this.keysChanged=s}}class gs extends $t{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach((s,n)=>{this.set(n,s)}),this._prelimContent=null}_copy(){return new gs}clone(){const t=new gs;return this.forEach((e,s)=>{t.set(s,e instanceof $t?e.clone():e)}),t}_callObserver(t,e){Mr(this,t,new fh(this,t,e))}toJSON(){const t={};return this._map.forEach((e,s)=>{if(!e.deleted){const n=e.content.getContent()[e.length-1];t[s]=n instanceof $t?n.toJSON():n}}),t}get size(){return[...nr(this._map)].length}keys(){return Kr(nr(this._map),t=>t[0])}values(){return Kr(nr(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Kr(nr(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((e,s)=>{e.deleted||t(e.content.getContent()[e.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?Mt(this.doc,e=>{xr(e,this,t)}):this._prelimContent.delete(t)}set(t,e){return this.doc!==null?Mt(this.doc,s=>{Ii(s,this,t,e)}):this._prelimContent.set(t,e),e}get(t){return Ti(this,t)}has(t){return Ho(this,t)}clear(){this.doc!==null?Mt(this.doc,t=>{this.forEach(function(e,s,n){xr(t,n,s)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Rh)}}const ph=r=>new gs,Be=(r,t)=>r===t||typeof r=="object"&&typeof t=="object"&&r&&t&&Ha(r,t);class hi{constructor(t,e,s,n){this.left=t,this.right=e,this.index=s,this.currentAttributes=n}forward(){switch(this.right===null&&ue(),this.right.content.constructor){case Vt:this.right.deleted||Ss(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const En=(r,t,e)=>{for(;t.right!==null&&e>0;){switch(t.right.content.constructor){case Vt:t.right.deleted||Ss(t.currentAttributes,t.right.content);break;default:t.right.deleted||(e<t.right.length&&qt(r,vt(t.right.id.client,t.right.id.clock+e)),t.index+=t.right.length,e-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},or=(r,t,e)=>{const s=new Map,n=Tr(t,e);if(n){const l=new hi(n.p.left,n.p,n.index,s);return En(r,l,e-n.index)}else{const l=new hi(null,t._start,0,s);return En(r,l,e)}},Fo=(r,t,e,s)=>{for(;e.right!==null&&(e.right.deleted===!0||e.right.content.constructor===Vt&&Be(s.get(e.right.content.key),e.right.content.value));)e.right.deleted||s.delete(e.right.content.key),e.forward();const n=r.doc,l=n.clientID;s.forEach((c,o)=>{const h=e.left,g=e.right,m=new At(vt(l,zt(n.store,l)),h,h&&h.lastId,g,g&&g.id,t,null,new Vt(o,c));m.integrate(r,0),e.right=m,e.forward()})},Ss=(r,t)=>{const{key:e,value:s}=t;s===null?r.delete(e):r.set(e,s)},zo=(r,t)=>{for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===Vt&&Be(t[r.right.content.key]||null,r.right.content.value)))break;r.forward()}},Vo=(r,t,e,s)=>{const n=r.doc,l=n.clientID,c=new Map;for(const o in s){const h=s[o],g=e.currentAttributes.get(o)||null;if(!Be(g,h)){c.set(o,g);const{left:m,right:E}=e;e.right=new At(vt(l,zt(n.store,l)),m,m&&m.lastId,E,E&&E.id,t,null,new Vt(o,h)),e.right.integrate(r,0),e.forward()}}return c},qr=(r,t,e,s,n)=>{e.currentAttributes.forEach((D,L)=>{n[L]===void 0&&(n[L]=null)});const l=r.doc,c=l.clientID;zo(e,n);const o=Vo(r,t,e,n),h=s.constructor===String?new pe(s):s instanceof $t?new xe(s):new Ye(s);let{left:g,right:m,index:E}=e;t._searchMarker&&Vs(t._searchMarker,e.index,h.getLength()),m=new At(vt(c,zt(l.store,c)),g,g&&g.lastId,m,m&&m.id,t,null,h),m.integrate(r,0),e.right=m,e.index=E,e.forward(),Fo(r,t,e,o)},Cn=(r,t,e,s,n)=>{const l=r.doc,c=l.clientID;zo(e,n);const o=Vo(r,t,e,n);t:for(;e.right!==null&&(s>0||o.size>0&&(e.right.deleted||e.right.content.constructor===Vt));){if(!e.right.deleted)switch(e.right.content.constructor){case Vt:{const{key:h,value:g}=e.right.content,m=n[h];if(m!==void 0){if(Be(m,g))o.delete(h);else{if(s===0)break t;o.set(h,g)}e.right.delete(r)}else e.currentAttributes.set(h,g);break}default:s<e.right.length&&qt(r,vt(e.right.id.client,e.right.id.clock+s)),s-=e.right.length;break}e.forward()}if(s>0){let h="";for(;s>0;s--)h+=`
`;e.right=new At(vt(c,zt(l.store,c)),e.left,e.left&&e.left.lastId,e.right,e.right&&e.right.id,t,null,new pe(h)),e.right.integrate(r,0),e.forward()}Fo(r,t,e,o)},Uo=(r,t,e,s,n)=>{let l=t;const c=ae();for(;l&&(!l.countable||l.deleted);){if(!l.deleted&&l.content.constructor===Vt){const g=l.content;c.set(g.key,g)}l=l.right}let o=0,h=!1;for(;t!==l;){if(e===t&&(h=!0),!t.deleted){const g=t.content;switch(g.constructor){case Vt:{const{key:m,value:E}=g,D=s.get(m)||null;(c.get(m)!==g||D===E)&&(t.delete(r),o++,!h&&(n.get(m)||null)===E&&D!==E&&(D===null?n.delete(m):n.set(m,D))),!h&&!t.deleted&&Ss(n,g);break}}}t=t.right}return o},gh=(r,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const e=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Vt){const s=t.content.key;e.has(s)?t.delete(r):e.add(s)}t=t.left}},mh=r=>{let t=0;return Mt(r.doc,e=>{let s=r._start,n=r._start,l=ae();const c=ti(l);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case Vt:Ss(c,n.content);break;default:t+=Uo(e,s,n,l,c),l=ti(c),s=n;break}n=n.right}}),t},Dn=(r,t,e)=>{const s=e,n=ti(t.currentAttributes),l=t.right;for(;e>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case xe:case Ye:case pe:e<t.right.length&&qt(r,vt(t.right.id.client,t.right.id.clock+e)),e-=t.right.length,t.right.delete(r);break}t.forward()}l&&Uo(r,l,t.right,n,t.currentAttributes);const c=(t.left||t.right).parent;return c._searchMarker&&Vs(c._searchMarker,t.index,-s+e),t};class yh extends Ir{constructor(t,e,s){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,e=[];Mt(t,s=>{const n=new Map,l=new Map;let c=this.target._start,o=null;const h={};let g="",m=0,E=0;const D=()=>{if(o!==null){let L=null;switch(o){case"delete":E>0&&(L={delete:E}),E=0;break;case"insert":(typeof g=="object"||g.length>0)&&(L={insert:g},n.size>0&&(L.attributes={},n.forEach((I,O)=>{I!==null&&(L.attributes[O]=I)}))),g="";break;case"retain":m>0&&(L={retain:m},Ra(h)||(L.attributes=Ta({},h))),m=0;break}L&&e.push(L),o=null}};for(;c!==null;){switch(c.content.constructor){case xe:case Ye:this.adds(c)?this.deletes(c)||(D(),o="insert",g=c.content.getContent()[0],D()):this.deletes(c)?(o!=="delete"&&(D(),o="delete"),E+=1):c.deleted||(o!=="retain"&&(D(),o="retain"),m+=1);break;case pe:this.adds(c)?this.deletes(c)||(o!=="insert"&&(D(),o="insert"),g+=c.content.str):this.deletes(c)?(o!=="delete"&&(D(),o="delete"),E+=c.length):c.deleted||(o!=="retain"&&(D(),o="retain"),m+=c.length);break;case Vt:{const{key:L,value:I}=c.content;if(this.adds(c)){if(!this.deletes(c)){const O=n.get(L)||null;Be(O,I)?I!==null&&c.delete(s):(o==="retain"&&D(),Be(I,l.get(L)||null)?delete h[L]:h[L]=I)}}else if(this.deletes(c)){l.set(L,I);const O=n.get(L)||null;Be(O,I)||(o==="retain"&&D(),h[L]=O)}else if(!c.deleted){l.set(L,I);const O=h[L];O!==void 0&&(Be(O,I)?O!==null&&c.delete(s):(o==="retain"&&D(),I===null?delete h[L]:h[L]=I))}c.deleted||(o==="insert"&&D(),Ss(n,c.content));break}}c=c.right}for(D();e.length>0;){const L=e[e.length-1];if(L.retain!==void 0&&L.attributes===void 0)e.pop();else break}}),this._delta=e}return this._delta}}class ms extends $t{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new ms}clone(){const t=new ms;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const s=new yh(this,t,e),n=t.doc;if(Mr(this,t,s),!t.local){let l=!1;for(const[c,o]of t.afterState.entries()){const h=t.beforeState.get(c)||0;if(o!==h&&(_o(t,n.store.clients.get(c),h,o,g=>{!g.deleted&&g.content.constructor===Vt&&(l=!0)}),l))break}l||ze(t,t.deleteSet,c=>{c instanceof ie||l||c.parent===this&&c.content.constructor===Vt&&(l=!0)}),Mt(n,c=>{l?mh(this):ze(c,c.deleteSet,o=>{o instanceof ie||o.parent===this&&gh(c,o)})})}}toString(){let t="",e=this._start;for(;e!==null;)!e.deleted&&e.countable&&e.content.constructor===pe&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){this.doc!==null?Mt(this.doc,s=>{const n=new hi(null,this._start,0,new Map);for(let l=0;l<t.length;l++){const c=t[l];if(c.insert!==void 0){const o=!e&&typeof c.insert=="string"&&l===t.length-1&&n.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof o!="string"||o.length>0)&&qr(s,this,n,o,c.attributes||{})}else c.retain!==void 0?Cn(s,this,n,c.retain,c.attributes||{}):c.delete!==void 0&&Dn(s,n,c.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,e,s){const n=[],l=new Map,c=this.doc;let o="",h=this._start;function g(){if(o.length>0){const E={};let D=!1;l.forEach((I,O)=>{D=!0,E[O]=I});const L={insert:o};D&&(L.attributes=E),n.push(L),o=""}}const m=()=>{for(;h!==null;){if(Ts(h,t)||e!==void 0&&Ts(h,e))switch(h.content.constructor){case pe:{const E=l.get("ychange");t!==void 0&&!Ts(h,t)?(E===void 0||E.user!==h.id.client||E.type!=="removed")&&(g(),l.set("ychange",s?s("removed",h.id):{type:"removed"})):e!==void 0&&!Ts(h,e)?(E===void 0||E.user!==h.id.client||E.type!=="added")&&(g(),l.set("ychange",s?s("added",h.id):{type:"added"})):E!==void 0&&(g(),l.delete("ychange")),o+=h.content.str;break}case xe:case Ye:{g();const E={insert:h.content.getContent()[0]};if(l.size>0){const D={};E.attributes=D,l.forEach((L,I)=>{D[I]=L})}n.push(E);break}case Vt:Ts(h,t)&&(g(),Ss(l,h.content));break}h=h.right}g()};return t||e?Mt(c,E=>{t&&ai(E,t),e&&ai(E,e),m()},"cleanup"):m(),n}insert(t,e,s){if(e.length<=0)return;const n=this.doc;n!==null?Mt(n,l=>{const c=or(l,this,t);s||(s={},c.currentAttributes.forEach((o,h)=>{s[h]=o})),qr(l,this,c,e,s)}):this._pending.push(()=>this.insert(t,e,s))}insertEmbed(t,e,s={}){const n=this.doc;n!==null?Mt(n,l=>{const c=or(l,this,t);qr(l,this,c,e,s)}):this._pending.push(()=>this.insertEmbed(t,e,s))}delete(t,e){if(e===0)return;const s=this.doc;s!==null?Mt(s,n=>{Dn(n,or(n,this,t),e)}):this._pending.push(()=>this.delete(t,e))}format(t,e,s){if(e===0)return;const n=this.doc;n!==null?Mt(n,l=>{const c=or(l,this,t);c.right!==null&&Cn(l,this,c,e,s)}):this._pending.push(()=>this.format(t,e,s))}removeAttribute(t){this.doc!==null?Mt(this.doc,e=>{xr(e,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,e){this.doc!==null?Mt(this.doc,s=>{Ii(s,this,t,e)}):this._pending.push(()=>this.setAttribute(t,e))}getAttribute(t){return Ti(this,t)}getAttributes(){return Oo(this)}_write(t){t.writeTypeRef(Oh)}}const wh=r=>new ms;class Jr{constructor(t,e=()=>!0){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(e)))do if(e=t.content.type,!t.deleted&&(e.constructor===$s||e.constructor===Ue)&&e._start!==null)t=e._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Ue extends $t{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ue}clone(){const t=new Ue;return t.insert(0,this.toArray().map(e=>e instanceof $t?e.clone():e)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Jr(this,t)}querySelector(t){t=t.toUpperCase();const s=new Jr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t).next();return s.done?null:s.value}querySelectorAll(t){return t=t.toUpperCase(),Ie(new Jr(this,e=>e.nodeName&&e.nodeName.toUpperCase()===t))}_callObserver(t,e){Mr(this,t,new xh(this,e,t))}toString(){return Io(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},s){const n=t.createDocumentFragment();return s!==void 0&&s._createAssociation(n,this),Us(this,l=>{n.insertBefore(l.toDOM(t,e,s),null)}),n}insert(t,e){this.doc!==null?Mt(this.doc,s=>{Ao(s,this,t,e)}):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(this.doc!==null)Mt(this.doc,s=>{const n=t&&t instanceof $t?t._item:t;br(s,this,n,e)});else{const s=this._prelimContent,n=t===null?0:s.findIndex(l=>l===t)+1;if(n===0&&t!==null)throw ys("Reference item not found");s.splice(n,0,...e)}}delete(t,e=1){this.doc!==null?Mt(this.doc,s=>{Ro(s,this,t,e)}):this._prelimContent.splice(t,e)}toArray(){return Bo(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return To(this,t)}slice(t=0,e=this.length){return Lo(this,t,e)}forEach(t){Us(this,t)}_write(t){t.writeTypeRef(Fh)}}const vh=r=>new Ue;class $s extends Ue{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach((s,n)=>{this.setAttribute(n,s)}),this._prelimAttrs=null}_copy(){return new $s(this.nodeName)}clone(){const t=new $s(this.nodeName),e=this.getAttributes();return Aa(e,(s,n)=>{typeof s=="string"&&t.setAttribute(n,s)}),t.insert(0,this.toArray().map(s=>s instanceof $t?s.clone():s)),t}toString(){const t=this.getAttributes(),e=[],s=[];for(const o in t)s.push(o);s.sort();const n=s.length;for(let o=0;o<n;o++){const h=s[o];e.push(h+'="'+t[h]+'"')}const l=this.nodeName.toLocaleLowerCase(),c=e.length>0?" "+e.join(" "):"";return`<${l}${c}>${super.toString()}</${l}>`}removeAttribute(t){this.doc!==null?Mt(this.doc,e=>{xr(e,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,e){this.doc!==null?Mt(this.doc,s=>{Ii(s,this,t,e)}):this._prelimAttrs.set(t,e)}getAttribute(t){return Ti(this,t)}hasAttribute(t){return Ho(this,t)}getAttributes(){return Oo(this)}toDOM(t=document,e={},s){const n=t.createElement(this.nodeName),l=this.getAttributes();for(const c in l){const o=l[c];typeof o=="string"&&n.setAttribute(c,o)}return Us(this,c=>{n.appendChild(c.toDOM(t,e,s))}),s!==void 0&&s._createAssociation(n,this),n}_write(t){t.writeTypeRef(Hh),t.writeKey(this.nodeName)}}const bh=r=>new $s(r.readKey());class xh extends Ir{constructor(t,e,s){super(t,s),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}}class Sr extends gs{constructor(t){super(),this.hookName=t}_copy(){return new Sr(this.hookName)}clone(){const t=new Sr(this.hookName);return this.forEach((e,s)=>{t.set(s,e)}),t}toDOM(t=document,e={},s){const n=e[this.hookName];let l;return n!==void 0?l=n.createDom(this):l=document.createElement(this.hookName),l.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(l,this),l}_write(t){t.writeTypeRef(zh),t.writeKey(this.hookName)}}const Sh=r=>new Sr(r.readKey());class kr extends ms{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new kr}clone(){const t=new kr;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,s){const n=t.createTextNode(this.toString());return s!==void 0&&s._createAssociation(n,this),n}toString(){return this.toDelta().map(t=>{const e=[];for(const n in t.attributes){const l=[];for(const c in t.attributes[n])l.push({key:c,value:t.attributes[n][c]});l.sort((c,o)=>c.key<o.key?-1:1),e.push({nodeName:n,attrs:l})}e.sort((n,l)=>n.nodeName<l.nodeName?-1:1);let s="";for(let n=0;n<e.length;n++){const l=e[n];s+=`<${l.nodeName}`;for(let c=0;c<l.attrs.length;c++){const o=l.attrs[c];s+=` ${o.key}="${o.value}"`}s+=">"}s+=t.insert;for(let n=e.length-1;n>=0;n--)s+=`</${e[n].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Vh)}}const kh=r=>new kr;class Mi{constructor(t,e){this.id=t,this.length=e}get deleted(){throw de()}mergeWith(t){return!1}write(t,e,s){throw de()}integrate(t,e){throw de()}}const _h=0;class ie extends Mi{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),ko(t.doc.store,this)}write(t,e){t.writeInfo(_h),t.writeLen(this.length-e)}getMissing(t,e){return null}}class js{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new js(this.content)}splice(t){throw de()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const Eh=r=>new js(r.readBuf());class Ps{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ps(this.len)}splice(t){const e=new Ps(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){zs(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const Ch=r=>new Ps(r.readLen()),$o=(r,t)=>new xs({guid:r,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ks{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),t.meta!==null&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ks($o(this.doc.guid,this.opts))}splice(t){throw de()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Dh=r=>new Ks($o(r.readString(),r.readAny()));class Ye{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ye(this.embed)}splice(t){throw de()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const Nh=r=>new Ye(r.readJSON());class Vt{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Vt(this.key,this.value)}splice(t){throw de()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Lh=r=>new Vt(r.readKey(),r.readJSON());class _r{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _r(this.arr)}splice(t){const e=new _r(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let n=e;n<s;n++){const l=this.arr[n];t.writeString(l===void 0?"undefined":JSON.stringify(l))}}getRef(){return 2}}const Bh=r=>{const t=r.readLen(),e=[];for(let s=0;s<t;s++){const n=r.readString();n==="undefined"?e.push(void 0):e.push(JSON.parse(n))}return new _r(e)};class $e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $e(this.arr)}splice(t){const e=new $e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const s=this.arr.length;t.writeLen(s-e);for(let n=e;n<s;n++){const l=this.arr[n];t.writeAny(l)}}getRef(){return 8}}const Ih=r=>{const t=r.readLen(),e=[];for(let s=0;s<t;s++)e.push(r.readAny());return new $e(e)};class pe{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new pe(this.str)}splice(t){const e=new pe(this.str.slice(t));this.str=this.str.slice(0,t);const s=this.str.charCodeAt(t-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,t-1)+"",e.str=""+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(e===0?this.str:this.str.slice(e))}getRef(){return 4}}const Th=r=>new pe(r.readString()),Mh=[uh,ph,wh,bh,vh,Sh,kh],Ah=0,Rh=1,Oh=2,Hh=3,Fh=4,zh=5,Vh=6;class xe{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new xe(this.type._copy())}splice(t){throw de()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;for(;e!==null;)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach(s=>{s.deleted?t._mergeStructs.push(s):s.delete(t)}),t.changed.delete(this.type)}gc(t){let e=this.type._start;for(;e!==null;)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(t,!0),s=s.left}),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Uh=r=>new xe(Mh[r.readTypeRef()](r)),$h=(r,t)=>{let e=t,s=0,n;do s>0&&(e=vt(e.client,e.clock+s)),n=pr(r,e),s=e.clock-n.id.clock,e=n.redone;while(e!==null&&n instanceof At);return{item:n,diff:s}},Ai=(r,t)=>{for(;r!==null&&r.keep!==t;)r.keep=t,r=r.parent._item},Er=(r,t,e)=>{const{client:s,clock:n}=t.id,l=new At(vt(s,n+e),t,vt(s,n+e-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e));return t.deleted&&l.markDeleted(),t.keep&&(l.keep=!0),t.redone!==null&&(l.redone=vt(t.redone.client,t.redone.clock+e)),t.right=l,l.right!==null&&(l.right.left=l),r._mergeStructs.push(l),l.parentSub!==null&&l.right===null&&l.parent._map.set(l.parentSub,l),t.length=e,l},Nn=(r,t)=>xa(r,e=>Xs(e.deletions,t)),Po=(r,t,e,s,n,l)=>{const c=r.doc,o=c.store,h=c.clientID,g=t.redone;if(g!==null)return qt(r,g);let m=t.parent._item,E=null,D;if(m!==null&&m.deleted===!0){if(m.redone===null&&(!e.has(m)||Po(r,m,e,s,n,l)===null))return null;for(;m.redone!==null;)m=qt(r,m.redone)}const L=m===null?t.parent:m.content.type;if(t.parentSub===null){for(E=t.left,D=t;E!==null;){let it=E;for(;it!==null&&it.parent._item!==m;)it=it.redone===null?null:qt(r,it.redone);if(it!==null&&it.parent._item===m){E=it;break}E=E.left}for(;D!==null;){let it=D;for(;it!==null&&it.parent._item!==m;)it=it.redone===null?null:qt(r,it.redone);if(it!==null&&it.parent._item===m){D=it;break}D=D.right}}else if(D=null,t.right&&!n){for(E=t;E!==null&&E.right!==null&&(E.right.redone||Xs(s,E.right.id)||Nn(l.undoStack,E.right.id)||Nn(l.redoStack,E.right.id));)for(E=E.right;E.redone;)E=qt(r,E.redone);if(E&&E.right!==null)return null}else E=L._map.get(t.parentSub)||null;const I=zt(o,h),O=vt(h,I),q=new At(O,E,E&&E.lastId,D,D&&D.id,L,t.parentSub,t.content.copy());return t.redone=O,Ai(q,!0),q.integrate(r,0),q};class At extends Mi{constructor(t,e,s,n,l,c,o,h){super(t,h.getLength()),this.origin=s,this.left=e,this.right=n,this.rightOrigin=l,this.parent=c,this.parentSub=o,this.redone=null,this.content=h,this.info=this.content.isCountable()?an:0}set marker(t){(this.info&Gr)>0!==t&&(this.info^=Gr)}get marker(){return(this.info&Gr)>0}get keep(){return(this.info&on)>0}set keep(t){this.keep!==t&&(this.info^=on)}get countable(){return(this.info&an)>0}get deleted(){return(this.info&Yr)>0}set deleted(t){this.deleted!==t&&(this.info^=Yr)}markDeleted(){this.info|=Yr}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=zt(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=zt(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ls&&this.id.client!==this.parent.client&&this.parent.clock>=zt(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bn(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=qt(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===ie||this.right&&this.right.constructor===ie)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===At&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===At&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ls){const s=pr(e,this.parent);s.constructor===ie?this.parent=null:this.parent=s.content.type}return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=bn(t,t.doc.store,vt(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,n;if(s!==null)n=s.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;const l=new Set,c=new Set;for(;n!==null&&n!==this.right;){if(c.add(n),l.add(n),ir(this.origin,n.origin)){if(n.id.client<this.id.client)s=n,l.clear();else if(ir(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&c.has(pr(t.doc.store,n.origin)))l.has(pr(t.doc.store,n.origin))||(s=n,l.clear());else break;n=n.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ko(t.doc.store,this),this.content.integrate(t,this),Sn(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new ie(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:vt(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&ir(t.origin,this.lastId)&&this.right===t&&ir(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach(s=>{s.p===t&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&this.parentSub===null&&(e._length-=this.length),this.markDeleted(),zs(t.deleteSet,this.id.client,this.id.clock,this.length),Sn(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw ue();this.content.gc(t),e?Wl(t,this,new ie(this.id,this.length)):this.content=new Ps(this.length)}write(t,e){const s=e>0?vt(this.id.client,this.id.clock+e-1):this.origin,n=this.rightOrigin,l=this.parentSub,c=this.content.getRef()&Cr|(s===null?0:se)|(n===null?0:ve)|(l===null?0:Os);if(t.writeInfo(c),s!==null&&t.writeLeftID(s),n!==null&&t.writeRightID(n),s===null&&n===null){const o=this.parent;if(o._item!==void 0){const h=o._item;if(h===null){const g=Gl(o);t.writeParentInfo(!0),t.writeString(g)}else t.writeParentInfo(!1),t.writeLeftID(h.id)}else o.constructor===String?(t.writeParentInfo(!0),t.writeString(o)):o.constructor===ls?(t.writeParentInfo(!1),t.writeLeftID(o)):ue();l!==null&&t.writeString(l)}this.content.write(t,e)}}const Yo=(r,t)=>Ph[t&Cr](r),Ph=[()=>{ue()},Ch,Bh,Eh,Th,Nh,Lh,Uh,Ih,Dh,()=>{ue()}],Yh=10;class ne extends Mi{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,e){ue()}write(t,e){t.writeInfo(Yh),St(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const Go=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Xo="__ $YJS$ __";Go[Xo]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Go[Xo]=!0;var $d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wo(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var jo={exports:{}};(function(r,t){(function(e,s){r.exports=s()})(window,function(){return function(e){var s={};function n(l){if(s[l])return s[l].exports;var c=s[l]={i:l,l:!1,exports:{}};return e[l].call(c.exports,c,c.exports,n),c.l=!0,c.exports}return n.m=e,n.c=s,n.d=function(l,c,o){n.o(l,c)||Object.defineProperty(l,c,{enumerable:!0,get:o})},n.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},n.t=function(l,c){if(1&c&&(l=n(l)),8&c||4&c&&typeof l=="object"&&l&&l.__esModule)return l;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:l}),2&c&&typeof l!="string")for(var h in l)n.d(o,h,function(g){return l[g]}.bind(null,h));return o},n.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return n.d(c,"a",c),c},n.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)},n.p="",n(n.s=1)}([function(e,s,n){var l,c;l=[n(2)],(c=function(o){function h(i){if(h.is(i,"function"))return g?i():o.on("raphael.DOMload",i);if(h.is(i,bt))return h._engine.create[Z](h,i.splice(0,3+h.is(i[0],gt))).add(i);var a=Array.prototype.slice.call(arguments,0);if(h.is(a[a.length-1],"function")){var d=a.pop();return g?d.call(h._engine.create[Z](h,a)):o.on("raphael.DOMload",function(){d.call(h._engine.create[Z](h,a))})}return h._engine.create[Z](h,arguments)}h.version="2.3.0",h.eve=o;var g,m,E=/[, ]+/,D={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},L=/\{(\d+)\}/g,I="hasOwnProperty",O={doc:document,win:window},q={was:Object.prototype[I].call(O.win,"Raphael"),is:O.win.Raphael},it=function(){this.ca=this.customAttributes={}},Z="apply",H="concat",dt="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,nt="",ut=" ",W=String,et="split",at="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[et](ut),Et={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},ht=W.prototype.toLowerCase,Q=Math,ot=Q.max,rt=Q.min,Dt=Q.abs,Tt=Q.pow,Rt=Q.PI,gt="number",bt="array",ge=Object.prototype.toString,v=(h._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),y={NaN:1,Infinity:1,"-Infinity":1},p=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,S=Q.round,C=parseFloat,B=parseInt,T=W.prototype.toUpperCase,$=h._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},M=h._availableAnimAttrs={blur:gt,"clip-rect":"csv",cx:gt,cy:gt,fill:"colour","fill-opacity":gt,"font-size":gt,height:gt,opacity:gt,path:"path",r:gt,rx:gt,ry:gt,stroke:"colour","stroke-opacity":gt,"stroke-width":gt,transform:"transform",width:gt,x:gt,y:gt},j=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,J={hs:1,rg:1},st=/,?([achlmqrstvxz]),?/gi,mt=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,xt=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,yt=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,Lt=(h._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Bt=function(i,a){return C(i)-C(a)},Ct=function(i){return i},ct=h._rectPath=function(i,a,d,u,f){return f?[["M",i+f,a],["l",d-2*f,0],["a",f,f,0,0,1,f,f],["l",0,u-2*f],["a",f,f,0,0,1,-f,f],["l",2*f-d,0],["a",f,f,0,0,1,-f,-f],["l",0,2*f-u],["a",f,f,0,0,1,f,-f],["z"]]:[["M",i,a],["l",d,0],["l",0,u],["l",-d,0],["z"]]},Ht=function(i,a,d,u){return u==null&&(u=d),[["M",i,a],["m",0,-u],["a",d,u,0,1,1,0,2*u],["a",d,u,0,1,1,0,-2*u],["z"]]},Ot=h._getPath={path:function(i){return i.attr("path")},circle:function(i){var a=i.attrs;return Ht(a.cx,a.cy,a.r)},ellipse:function(i){var a=i.attrs;return Ht(a.cx,a.cy,a.rx,a.ry)},rect:function(i){var a=i.attrs;return ct(a.x,a.y,a.width,a.height,a.r)},image:function(i){var a=i.attrs;return ct(a.x,a.y,a.width,a.height)},text:function(i){var a=i._getBBox();return ct(a.x,a.y,a.width,a.height)},set:function(i){var a=i._getBBox();return ct(a.x,a.y,a.width,a.height)}},Ft=h.mapPath=function(i,a){if(!a)return i;var d,u,f,w,x,b,k;for(f=0,x=(i=Ns(i)).length;f<x;f++)for(w=1,b=(k=i[f]).length;w<b;w+=2)d=a.x(k[w],k[w+1]),u=a.y(k[w],k[w+1]),k[w]=d,k[w+1]=u;return i};if(h._g=O,h.type=O.win.SVGAngle||O.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML",h.type=="VML"){var It,Jt=O.doc.createElement("div");if(Jt.innerHTML='<v:shape adj="1"/>',(It=Jt.firstChild).style.behavior="url(#default#VML)",!It||typeof It.adj!="object")return h.type=nt;Jt=null}function Xt(i){if(typeof i=="function"||Object(i)!==i)return i;var a=new i.constructor;for(var d in i)i[I](d)&&(a[d]=Xt(i[d]));return a}h.svg=!(h.vml=h.type=="VML"),h._Paper=it,h.fn=m=it.prototype=h.prototype,h._id=0,h.is=function(i,a){return(a=ht.call(a))=="finite"?!y[I](+i):a=="array"?i instanceof Array:a=="null"&&i===null||a==typeof i&&i!==null||a=="object"&&i===Object(i)||a=="array"&&Array.isArray&&Array.isArray(i)||ge.call(i).slice(8,-1).toLowerCase()==a},h.angle=function(i,a,d,u,f,w){if(f==null){var x=i-d,b=a-u;return x||b?(180+180*Q.atan2(-b,-x)/Rt+360)%360:0}return h.angle(i,a,f,w)-h.angle(d,u,f,w)},h.rad=function(i){return i%360*Rt/180},h.deg=function(i){return Math.round(180*i/Rt%360*1e3)/1e3},h.snapTo=function(i,a,d){if(d=h.is(d,"finite")?d:10,h.is(i,bt)){for(var u=i.length;u--;)if(Dt(i[u]-a)<=d)return i[u]}else{var f=a%(i=+i);if(f<d)return a-f;if(f>i-d)return a-f+i}return a};var Se,_s;h.createUUID=(Se=/[xy]/g,_s=function(i){var a=16*Q.random()|0;return(i=="x"?a:3&a|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(Se,_s).toUpperCase()}),h.setWindow=function(i){o("raphael.setWindow",h,O.win,i),O.win=i,O.doc=O.win.document,h._engine.initWin&&h._engine.initWin(O.win)};var ke=function(i){if(h.vml){var a,d=/^\s+|\s+$/g;try{var u=new ActiveXObject("htmlfile");u.write("<body>"),u.close(),a=u.body}catch{a=createPopup().document.body}var f=a.createTextRange();ke=Yt(function(x){try{a.style.color=W(x).replace(d,nt);var b=f.queryCommandValue("ForeColor");return"#"+("000000"+(b=(255&b)<<16|65280&b|(16711680&b)>>>16).toString(16)).slice(-6)}catch{return"none"}})}else{var w=O.doc.createElement("i");w.title="Raphal Colour Picker",w.style.display="none",O.doc.body.appendChild(w),ke=Yt(function(x){return w.style.color=x,O.doc.defaultView.getComputedStyle(w,nt).getPropertyValue("color")})}return ke(i)},Xe=function(){return"hsb("+[this.h,this.s,this.b]+")"},We=function(){return"hsl("+[this.h,this.s,this.l]+")"},Es=function(){return this.hex},je=function(i,a,d){if(a==null&&h.is(i,"object")&&"r"in i&&"g"in i&&"b"in i&&(d=i.b,a=i.g,i=i.r),a==null&&h.is(i,"string")){var u=h.getRGB(i);i=u.r,a=u.g,d=u.b}return(i>1||a>1||d>1)&&(i/=255,a/=255,d/=255),[i,a,d]},Js=function(i,a,d,u){var f={r:i*=255,g:a*=255,b:d*=255,hex:h.rgb(i,a,d),toString:Es};return h.is(u,"finite")&&(f.opacity=u),f};function Yt(i,a,d){return function u(){var f=Array.prototype.slice.call(arguments,0),w=f.join(""),x=u.cache=u.cache||{},b=u.count=u.count||[];return x[I](w)?(function(k,N){for(var R=0,P=k.length;R<P;R++)if(k[R]===N)return k.push(k.splice(R,1)[0])}(b,w),d?d(x[w]):x[w]):(b.length>=1e3&&delete x[b.shift()],b.push(w),x[w]=i[Z](a,f),d?d(x[w]):x[w])}}h.color=function(i){var a;return h.is(i,"object")&&"h"in i&&"s"in i&&"b"in i?(a=h.hsb2rgb(i),i.r=a.r,i.g=a.g,i.b=a.b,i.hex=a.hex):h.is(i,"object")&&"h"in i&&"s"in i&&"l"in i?(a=h.hsl2rgb(i),i.r=a.r,i.g=a.g,i.b=a.b,i.hex=a.hex):(h.is(i,"string")&&(i=h.getRGB(i)),h.is(i,"object")&&"r"in i&&"g"in i&&"b"in i?(a=h.rgb2hsl(i),i.h=a.h,i.s=a.s,i.l=a.l,a=h.rgb2hsb(i),i.v=a.b):(i={hex:"none"}).r=i.g=i.b=i.h=i.s=i.v=i.l=-1),i.toString=Es,i},h.hsb2rgb=function(i,a,d,u){var f,w,x,b,k;return this.is(i,"object")&&"h"in i&&"s"in i&&"b"in i&&(d=i.b,a=i.s,u=i.o,i=i.h),b=(k=d*a)*(1-Dt((i=(i*=360)%360/60)%2-1)),f=w=x=d-k,Js(f+=[k,b,0,0,b,k][i=~~i],w+=[b,k,k,b,0,0][i],x+=[0,0,b,k,k,b][i],u)},h.hsl2rgb=function(i,a,d,u){var f,w,x,b,k;return this.is(i,"object")&&"h"in i&&"s"in i&&"l"in i&&(d=i.l,a=i.s,i=i.h),(i>1||a>1||d>1)&&(i/=360,a/=100,d/=100),b=(k=2*a*(d<.5?d:1-d))*(1-Dt((i=(i*=360)%360/60)%2-1)),f=w=x=d-k/2,Js(f+=[k,b,0,0,b,k][i=~~i],w+=[b,k,k,b,0,0][i],x+=[0,0,b,k,k,b][i],u)},h.rgb2hsb=function(i,a,d){var u,f;return i=(d=je(i,a,d))[0],a=d[1],d=d[2],{h:(((f=(u=ot(i,a,d))-rt(i,a,d))==0?null:u==i?(a-d)/f:u==a?(d-i)/f+2:(i-a)/f+4)+360)%6*60/360,s:f==0?0:f/u,b:u,toString:Xe}},h.rgb2hsl=function(i,a,d){var u,f,w,x;return i=(d=je(i,a,d))[0],a=d[1],d=d[2],u=((f=ot(i,a,d))+(w=rt(i,a,d)))/2,{h:(((x=f-w)==0?null:f==i?(a-d)/x:f==a?(d-i)/x+2:(i-a)/x+4)+360)%6*60/360,s:x==0?0:u<.5?x/(2*u):x/(2-2*u),l:u,toString:We}},h._path2string=function(){return this.join(",").replace(st,"$1")},h._preload=function(i,a){var d=O.doc.createElement("img");d.style.cssText="position:absolute;left:-9999em;top:-9999em",d.onload=function(){a.call(this),this.onload=null,O.doc.body.removeChild(this)},d.onerror=function(){O.doc.body.removeChild(this)},O.doc.body.appendChild(d),d.src=i};function _e(){return this.hex}function Ke(i,a){for(var d=[],u=0,f=i.length;f-2*!a>u;u+=2){var w=[{x:+i[u-2],y:+i[u-1]},{x:+i[u],y:+i[u+1]},{x:+i[u+2],y:+i[u+3]},{x:+i[u+4],y:+i[u+5]}];a?u?f-4==u?w[3]={x:+i[0],y:+i[1]}:f-2==u&&(w[2]={x:+i[0],y:+i[1]},w[3]={x:+i[2],y:+i[3]}):w[0]={x:+i[f-2],y:+i[f-1]}:f-4==u?w[3]=w[2]:u||(w[0]={x:+i[u],y:+i[u+1]}),d.push(["C",(-w[0].x+6*w[1].x+w[2].x)/6,(-w[0].y+6*w[1].y+w[2].y)/6,(w[1].x+6*w[2].x-w[3].x)/6,(w[1].y+6*w[2].y-w[3].y)/6,w[2].x,w[2].y])}return d}h.getRGB=Yt(function(i){if(!i||(i=W(i)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:_e};if(i=="none")return{r:-1,g:-1,b:-1,hex:"none",toString:_e};!J[I](i.toLowerCase().substring(0,2))&&i.charAt()!="#"&&(i=ke(i));var a,d,u,f,w,x,b=i.match(v);return b?(b[2]&&(u=B(b[2].substring(5),16),d=B(b[2].substring(3,5),16),a=B(b[2].substring(1,3),16)),b[3]&&(u=B((w=b[3].charAt(3))+w,16),d=B((w=b[3].charAt(2))+w,16),a=B((w=b[3].charAt(1))+w,16)),b[4]&&(x=b[4][et](j),a=C(x[0]),x[0].slice(-1)=="%"&&(a*=2.55),d=C(x[1]),x[1].slice(-1)=="%"&&(d*=2.55),u=C(x[2]),x[2].slice(-1)=="%"&&(u*=2.55),b[1].toLowerCase().slice(0,4)=="rgba"&&(f=C(x[3])),x[3]&&x[3].slice(-1)=="%"&&(f/=100)),b[5]?(x=b[5][et](j),a=C(x[0]),x[0].slice(-1)=="%"&&(a*=2.55),d=C(x[1]),x[1].slice(-1)=="%"&&(d*=2.55),u=C(x[2]),x[2].slice(-1)=="%"&&(u*=2.55),(x[0].slice(-3)=="deg"||x[0].slice(-1)=="")&&(a/=360),b[1].toLowerCase().slice(0,4)=="hsba"&&(f=C(x[3])),x[3]&&x[3].slice(-1)=="%"&&(f/=100),h.hsb2rgb(a,d,u,f)):b[6]?(x=b[6][et](j),a=C(x[0]),x[0].slice(-1)=="%"&&(a*=2.55),d=C(x[1]),x[1].slice(-1)=="%"&&(d*=2.55),u=C(x[2]),x[2].slice(-1)=="%"&&(u*=2.55),(x[0].slice(-3)=="deg"||x[0].slice(-1)=="")&&(a/=360),b[1].toLowerCase().slice(0,4)=="hsla"&&(f=C(x[3])),x[3]&&x[3].slice(-1)=="%"&&(f/=100),h.hsl2rgb(a,d,u,f)):((b={r:a,g:d,b:u,toString:_e}).hex="#"+(16777216|u|d<<8|a<<16).toString(16).slice(1),h.is(f,"finite")&&(b.opacity=f),b)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:_e}},h),h.hsb=Yt(function(i,a,d){return h.hsb2rgb(i,a,d).hex}),h.hsl=Yt(function(i,a,d){return h.hsl2rgb(i,a,d).hex}),h.rgb=Yt(function(i,a,d){function u(f){return f+.5|0}return"#"+(16777216|u(d)|u(a)<<8|u(i)<<16).toString(16).slice(1)}),h.getColor=function(i){var a=this.getColor.start=this.getColor.start||{h:0,s:1,b:i||.75},d=this.hsb2rgb(a.h,a.s,a.b);return a.h+=.075,a.h>1&&(a.h=0,a.s-=.2,a.s<=0&&(this.getColor.start={h:0,s:1,b:a.b})),d.hex},h.getColor.reset=function(){delete this.start},h.parsePathString=function(i){if(!i)return null;var a=re(i);if(a.arr)return jt(a.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},u=[];return h.is(i,bt)&&h.is(i[0],bt)&&(u=jt(i)),u.length||W(i).replace(mt,function(f,w,x){var b=[],k=w.toLowerCase();if(x.replace(yt,function(N,R){R&&b.push(+R)}),k=="m"&&b.length>2&&(u.push([w][H](b.splice(0,2))),k="l",w=w=="m"?"l":"L"),k=="r")u.push([w][H](b));else for(;b.length>=d[k]&&(u.push([w][H](b.splice(0,d[k]))),d[k]););}),u.toString=h._path2string,a.arr=jt(u),u},h.parseTransformString=Yt(function(i){if(!i)return null;var a=[];return h.is(i,bt)&&h.is(i[0],bt)&&(a=jt(i)),a.length||W(i).replace(xt,function(d,u,f){var w=[];ht.call(u),f.replace(yt,function(x,b){b&&w.push(+b)}),a.push([u][H](w))}),a.toString=h._path2string,a},this,function(i){if(!i)return i;for(var a=[],d=0;d<i.length;d++){for(var u=[],f=0;f<i[d].length;f++)u.push(i[d][f]);a.push(u)}return a});var re=function(i){var a=re.ps=re.ps||{};return a[i]?a[i].sleep=100:a[i]={sleep:100},setTimeout(function(){for(var d in a)a[I](d)&&d!=i&&(a[d].sleep--,!a[d].sleep&&delete a[d])}),a[i]};function qe(i,a,d,u,f){return i*(i*(-3*a+9*d-9*u+3*f)+6*a-12*d+6*u)-3*a+3*d}function oe(i,a,d,u,f,w,x,b,k){k==null&&(k=1);for(var N=(k=k>1?1:k<0?0:k)/2,R=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],P=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],z=0,A=0;A<12;A++){var V=N*R[A]+N,Y=qe(V,i,d,f,x),U=qe(V,a,u,w,b),F=Y*Y+U*U;z+=P[A]*Q.sqrt(F)}return N*z}function Cs(i,a,d,u,f,w,x,b){if(!(ot(i,d)<rt(f,x)||rt(i,d)>ot(f,x)||ot(a,u)<rt(w,b)||rt(a,u)>ot(w,b))){var k=(i-d)*(w-b)-(a-u)*(f-x);if(k){var N=((i*u-a*d)*(f-x)-(i-d)*(f*b-w*x))/k,R=((i*u-a*d)*(w-b)-(a-u)*(f*b-w*x))/k,P=+N.toFixed(2),z=+R.toFixed(2);if(!(P<+rt(i,d).toFixed(2)||P>+ot(i,d).toFixed(2)||P<+rt(f,x).toFixed(2)||P>+ot(f,x).toFixed(2)||z<+rt(a,u).toFixed(2)||z>+ot(a,u).toFixed(2)||z<+rt(w,b).toFixed(2)||z>+ot(w,b).toFixed(2)))return{x:N,y:R}}}}function Je(i,a,d){var u=h.bezierBBox(i),f=h.bezierBBox(a);if(!h.isBBoxIntersect(u,f))return d?0:[];for(var w=oe.apply(0,i),x=oe.apply(0,a),b=ot(~~(w/5),1),k=ot(~~(x/5),1),N=[],R=[],P={},z=d?0:[],A=0;A<b+1;A++){var V=h.findDotsAtSegment.apply(h,i.concat(A/b));N.push({x:V.x,y:V.y,t:A/b})}for(A=0;A<k+1;A++)V=h.findDotsAtSegment.apply(h,a.concat(A/k)),R.push({x:V.x,y:V.y,t:A/k});for(A=0;A<b;A++)for(var Y=0;Y<k;Y++){var U=N[A],F=N[A+1],tt=R[Y],G=R[Y+1],K=Dt(F.x-U.x)<.001?"y":"x",X=Dt(G.x-tt.x)<.001?"y":"x",ft=Cs(U.x,U.y,F.x,F.y,tt.x,tt.y,G.x,G.y);if(ft){if(P[ft.x.toFixed(4)]==ft.y.toFixed(4))continue;P[ft.x.toFixed(4)]=ft.y.toFixed(4);var lt=U.t+Dt((ft[K]-U[K])/(F[K]-U[K]))*(F.t-U.t),pt=tt.t+Dt((ft[X]-tt[X])/(G[X]-tt[X]))*(G.t-tt.t);lt>=0&&lt<=1.001&&pt>=0&&pt<=1.001&&(d?z++:z.push({x:ft.x,y:ft.y,t1:rt(lt,1),t2:rt(pt,1)}))}}return z}function Ds(i,a,d){i=h._path2curve(i),a=h._path2curve(a);for(var u,f,w,x,b,k,N,R,P,z,A=d?0:[],V=0,Y=i.length;V<Y;V++){var U=i[V];if(U[0]=="M")u=b=U[1],f=k=U[2];else{U[0]=="C"?(P=[u,f].concat(U.slice(1)),u=P[6],f=P[7]):(P=[u,f,u,f,b,k,b,k],u=b,f=k);for(var F=0,tt=a.length;F<tt;F++){var G=a[F];if(G[0]=="M")w=N=G[1],x=R=G[2];else{G[0]=="C"?(z=[w,x].concat(G.slice(1)),w=z[6],x=z[7]):(z=[w,x,w,x,N,R,N,R],w=N,x=R);var K=Je(P,z,d);if(d)A+=K;else{for(var X=0,ft=K.length;X<ft;X++)K[X].segment1=V,K[X].segment2=F,K[X].bez1=P,K[X].bez2=z;A=A.concat(K)}}}}}return A}h.findDotsAtSegment=function(i,a,d,u,f,w,x,b,k){var N=1-k,R=Tt(N,3),P=Tt(N,2),z=k*k,A=z*k,V=R*i+3*P*k*d+3*N*k*k*f+A*x,Y=R*a+3*P*k*u+3*N*k*k*w+A*b,U=i+2*k*(d-i)+z*(f-2*d+i),F=a+2*k*(u-a)+z*(w-2*u+a),tt=d+2*k*(f-d)+z*(x-2*f+d),G=u+2*k*(w-u)+z*(b-2*w+u),K=N*i+k*d,X=N*a+k*u,ft=N*f+k*x,lt=N*w+k*b,pt=90-180*Q.atan2(U-tt,F-G)/Rt;return(U>tt||F<G)&&(pt+=180),{x:V,y:Y,m:{x:U,y:F},n:{x:tt,y:G},start:{x:K,y:X},end:{x:ft,y:lt},alpha:pt}},h.bezierBBox=function(i,a,d,u,f,w,x,b){h.is(i,"array")||(i=[i,a,d,u,f,w,x,b]);var k=Qs.apply(null,i);return{x:k.min.x,y:k.min.y,x2:k.max.x,y2:k.max.y,width:k.max.x-k.min.x,height:k.max.y-k.min.y}},h.isPointInsideBBox=function(i,a,d){return a>=i.x&&a<=i.x2&&d>=i.y&&d<=i.y2},h.isBBoxIntersect=function(i,a){var d=h.isPointInsideBBox;return d(a,i.x,i.y)||d(a,i.x2,i.y)||d(a,i.x,i.y2)||d(a,i.x2,i.y2)||d(i,a.x,a.y)||d(i,a.x2,a.y)||d(i,a.x,a.y2)||d(i,a.x2,a.y2)||(i.x<a.x2&&i.x>a.x||a.x<i.x2&&a.x>i.x)&&(i.y<a.y2&&i.y>a.y||a.y<i.y2&&a.y>i.y)},h.pathIntersection=function(i,a){return Ds(i,a)},h.pathIntersectionNumber=function(i,a){return Ds(i,a,1)},h.isPointInsidePath=function(i,a,d){var u=h.pathBBox(i);return h.isPointInsideBBox(u,a,d)&&Ds(i,[["M",a,d],["H",u.x2+10]],1)%2==1},h._removedFactory=function(i){return function(){o("raphael.log",null,"Raphal: you are calling to method "+i+" of removed object",i)}};var Ee=h.pathBBox=function(i){var a=re(i);if(a.bbox)return Xt(a.bbox);if(!i)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var d,u=0,f=0,w=[],x=[],b=0,k=(i=Ns(i)).length;b<k;b++)if((d=i[b])[0]=="M")u=d[1],f=d[2],w.push(u),x.push(f);else{var N=Qs(u,f,d[1],d[2],d[3],d[4],d[5],d[6]);w=w[H](N.min.x,N.max.x),x=x[H](N.min.y,N.max.y),u=d[5],f=d[6]}var R=rt[Z](0,w),P=rt[Z](0,x),z=ot[Z](0,w),A=ot[Z](0,x),V=z-R,Y=A-P,U={x:R,y:P,x2:z,y2:A,width:V,height:Y,cx:R+V/2,cy:P+Y/2};return a.bbox=Xt(U),U},jt=function(i){var a=Xt(i);return a.toString=h._path2string,a},Oi=h._pathToRelative=function(i){var a=re(i);if(a.rel)return jt(a.rel);h.is(i,bt)&&h.is(i&&i[0],bt)||(i=h.parsePathString(i));var d=[],u=0,f=0,w=0,x=0,b=0;i[0][0]=="M"&&(w=u=i[0][1],x=f=i[0][2],b++,d.push(["M",u,f]));for(var k=b,N=i.length;k<N;k++){var R=d[k]=[],P=i[k];if(P[0]!=ht.call(P[0]))switch(R[0]=ht.call(P[0]),R[0]){case"a":R[1]=P[1],R[2]=P[2],R[3]=P[3],R[4]=P[4],R[5]=P[5],R[6]=+(P[6]-u).toFixed(3),R[7]=+(P[7]-f).toFixed(3);break;case"v":R[1]=+(P[1]-f).toFixed(3);break;case"m":w=P[1],x=P[2];default:for(var z=1,A=P.length;z<A;z++)R[z]=+(P[z]-(z%2?u:f)).toFixed(3)}else{R=d[k]=[],P[0]=="m"&&(w=P[1]+u,x=P[2]+f);for(var V=0,Y=P.length;V<Y;V++)d[k][V]=P[V]}var U=d[k].length;switch(d[k][0]){case"z":u=w,f=x;break;case"h":u+=+d[k][U-1];break;case"v":f+=+d[k][U-1];break;default:u+=+d[k][U-2],f+=+d[k][U-1]}}return d.toString=h._path2string,a.rel=jt(d),d},Ze=h._pathToAbsolute=function(i){var a=re(i);if(a.abs)return jt(a.abs);if(h.is(i,bt)&&h.is(i&&i[0],bt)||(i=h.parsePathString(i)),!i||!i.length)return[["M",0,0]];var d=[],u=0,f=0,w=0,x=0,b=0;i[0][0]=="M"&&(w=u=+i[0][1],x=f=+i[0][2],b++,d[0]=["M",u,f]);for(var k,N,R=i.length==3&&i[0][0]=="M"&&i[1][0].toUpperCase()=="R"&&i[2][0].toUpperCase()=="Z",P=b,z=i.length;P<z;P++){if(d.push(k=[]),(N=i[P])[0]!=T.call(N[0]))switch(k[0]=T.call(N[0]),k[0]){case"A":k[1]=N[1],k[2]=N[2],k[3]=N[3],k[4]=N[4],k[5]=N[5],k[6]=+(N[6]+u),k[7]=+(N[7]+f);break;case"V":k[1]=+N[1]+f;break;case"H":k[1]=+N[1]+u;break;case"R":for(var A=[u,f][H](N.slice(1)),V=2,Y=A.length;V<Y;V++)A[V]=+A[V]+u,A[++V]=+A[V]+f;d.pop(),d=d[H](Ke(A,R));break;case"M":w=+N[1]+u,x=+N[2]+f;default:for(V=1,Y=N.length;V<Y;V++)k[V]=+N[V]+(V%2?u:f)}else if(N[0]=="R")A=[u,f][H](N.slice(1)),d.pop(),d=d[H](Ke(A,R)),k=["R"][H](N.slice(-2));else for(var U=0,F=N.length;U<F;U++)k[U]=N[U];switch(k[0]){case"Z":u=w,f=x;break;case"H":u=k[1];break;case"V":f=k[1];break;case"M":w=k[k.length-2],x=k[k.length-1];default:u=k[k.length-2],f=k[k.length-1]}}return d.toString=h._path2string,a.abs=jt(d),d},Qe=function(i,a,d,u){return[i,a,d,u,d,u]},Ce=function(i,a,d,u,f,w){return[1/3*i+2/3*d,1/3*a+2/3*u,1/3*f+2/3*d,1/3*w+2/3*u,f,w]},Zs=function(i,a,d,u,f,w,x,b,k,N){var R,P=120*Rt/180,z=Rt/180*(+f||0),A=[],V=Yt(function(tn,en,rr){return{x:tn*Q.cos(rr)-en*Q.sin(rr),y:tn*Q.sin(rr)+en*Q.cos(rr)}});if(N)lt=N[0],pt=N[1],X=N[2],ft=N[3];else{i=(R=V(i,a,-z)).x,a=R.y,b=(R=V(b,k,-z)).x,k=R.y;var Y=(i-b)/2,U=(a-k)/2,F=Y*Y/(d*d)+U*U/(u*u);F>1&&(d*=F=Q.sqrt(F),u*=F);var tt=d*d,G=u*u,K=(w==x?-1:1)*Q.sqrt(Dt((tt*G-tt*U*U-G*Y*Y)/(tt*U*U+G*Y*Y))),X=K*d*U/u+(i+b)/2,ft=K*-u*Y/d+(a+k)/2,lt=Q.asin(((a-ft)/u).toFixed(9)),pt=Q.asin(((k-ft)/u).toFixed(9));(lt=i<X?Rt-lt:lt)<0&&(lt=2*Rt+lt),(pt=b<X?Rt-pt:pt)<0&&(pt=2*Rt+pt),x&&lt>pt&&(lt-=2*Rt),!x&&pt>lt&&(pt-=2*Rt)}var es=pt-lt;if(Dt(es)>P){var Is=pt,Kt=b,le=k;pt=lt+P*(x&&pt>lt?1:-1),b=X+d*Q.cos(pt),k=ft+u*Q.sin(pt),A=Zs(b,k,d,u,f,0,x,Kt,le,[pt,Is,X,ft])}es=pt-lt;var ss=Q.cos(lt),rs=Q.sin(lt),er=Q.cos(pt),ye=Q.sin(pt),He=Q.tan(es/4),sr=4/3*d*He,Ki=4/3*u*He,qi=[i,a],is=[i+sr*rs,a-Ki*ss],Ji=[b+sr*ye,k-Ki*er],Zi=[b,k];if(is[0]=2*qi[0]-is[0],is[1]=2*qi[1]-is[1],N)return[is,Ji,Zi][H](A);for(var Qi=[],Ne=0,ga=(A=[is,Ji,Zi][H](A).join()[et](",")).length;Ne<ga;Ne++)Qi[Ne]=Ne%2?V(A[Ne-1],A[Ne],z).y:V(A[Ne],A[Ne+1],z).x;return Qi},Ae=function(i,a,d,u,f,w,x,b,k){var N=1-k;return{x:Tt(N,3)*i+3*Tt(N,2)*k*d+3*N*k*k*f+Tt(k,3)*x,y:Tt(N,3)*a+3*Tt(N,2)*k*u+3*N*k*k*w+Tt(k,3)*b}},Qs=Yt(function(i,a,d,u,f,w,x,b){var k,N=f-2*d+i-(x-2*f+d),R=2*(d-i)-2*(f-d),P=i-d,z=(-R+Q.sqrt(R*R-4*N*P))/2/N,A=(-R-Q.sqrt(R*R-4*N*P))/2/N,V=[a,b],Y=[i,x];return Dt(z)>"1e12"&&(z=.5),Dt(A)>"1e12"&&(A=.5),z>0&&z<1&&(k=Ae(i,a,d,u,f,w,x,b,z),Y.push(k.x),V.push(k.y)),A>0&&A<1&&(k=Ae(i,a,d,u,f,w,x,b,A),Y.push(k.x),V.push(k.y)),N=w-2*u+a-(b-2*w+u),P=a-u,z=(-(R=2*(u-a)-2*(w-u))+Q.sqrt(R*R-4*N*P))/2/N,A=(-R-Q.sqrt(R*R-4*N*P))/2/N,Dt(z)>"1e12"&&(z=.5),Dt(A)>"1e12"&&(A=.5),z>0&&z<1&&(k=Ae(i,a,d,u,f,w,x,b,z),Y.push(k.x),V.push(k.y)),A>0&&A<1&&(k=Ae(i,a,d,u,f,w,x,b,A),Y.push(k.x),V.push(k.y)),{min:{x:rt[Z](0,Y),y:rt[Z](0,V)},max:{x:ot[Z](0,Y),y:ot[Z](0,V)}}}),Ns=h._path2curve=Yt(function(i,a){var d=!a&&re(i);if(!a&&d.curve)return jt(d.curve);for(var u=Ze(i),f=a&&Ze(a),w={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},x={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},b=function(K,X,ft){var lt,pt;if(!K)return["C",X.x,X.y,X.x,X.y,X.x,X.y];switch(!(K[0]in{T:1,Q:1})&&(X.qx=X.qy=null),K[0]){case"M":X.X=K[1],X.Y=K[2];break;case"A":K=["C"][H](Zs[Z](0,[X.x,X.y][H](K.slice(1))));break;case"S":ft=="C"||ft=="S"?(lt=2*X.x-X.bx,pt=2*X.y-X.by):(lt=X.x,pt=X.y),K=["C",lt,pt][H](K.slice(1));break;case"T":ft=="Q"||ft=="T"?(X.qx=2*X.x-X.qx,X.qy=2*X.y-X.qy):(X.qx=X.x,X.qy=X.y),K=["C"][H](Ce(X.x,X.y,X.qx,X.qy,K[1],K[2]));break;case"Q":X.qx=K[1],X.qy=K[2],K=["C"][H](Ce(X.x,X.y,K[1],K[2],K[3],K[4]));break;case"L":K=["C"][H](Qe(X.x,X.y,K[1],K[2]));break;case"H":K=["C"][H](Qe(X.x,X.y,K[1],X.y));break;case"V":K=["C"][H](Qe(X.x,X.y,X.x,K[1]));break;case"Z":K=["C"][H](Qe(X.x,X.y,X.X,X.Y))}return K},k=function(K,X){if(K[X].length>7){K[X].shift();for(var ft=K[X];ft.length;)R[X]="A",f&&(P[X]="A"),K.splice(X++,0,["C"][H](ft.splice(0,6)));K.splice(X,1),Y=ot(u.length,f&&f.length||0)}},N=function(K,X,ft,lt,pt){K&&X&&K[pt][0]=="M"&&X[pt][0]!="M"&&(X.splice(pt,0,["M",lt.x,lt.y]),ft.bx=0,ft.by=0,ft.x=K[pt][1],ft.y=K[pt][2],Y=ot(u.length,f&&f.length||0))},R=[],P=[],z="",A="",V=0,Y=ot(u.length,f&&f.length||0);V<Y;V++){u[V]&&(z=u[V][0]),z!="C"&&(R[V]=z,V&&(A=R[V-1])),u[V]=b(u[V],w,A),R[V]!="A"&&z=="C"&&(R[V]="C"),k(u,V),f&&(f[V]&&(z=f[V][0]),z!="C"&&(P[V]=z,V&&(A=P[V-1])),f[V]=b(f[V],x,A),P[V]!="A"&&z=="C"&&(P[V]="C"),k(f,V)),N(u,f,w,x,V),N(f,u,x,w,V);var U=u[V],F=f&&f[V],tt=U.length,G=f&&F.length;w.x=U[tt-2],w.y=U[tt-1],w.bx=C(U[tt-4])||w.x,w.by=C(U[tt-3])||w.y,x.bx=f&&(C(F[G-4])||x.x),x.by=f&&(C(F[G-3])||x.y),x.x=f&&F[G-2],x.y=f&&F[G-1]}return f||(d.curve=jt(u)),f?[u,f]:u},null,jt),tr=(h._parseDots=Yt(function(i){for(var a=[],d=0,u=i.length;d<u;d++){var f={},w=i[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=h.getRGB(w[1]),f.color.error)return null;f.opacity=f.color.opacity,f.color=f.color.hex,w[2]&&(f.offset=w[2]+"%"),a.push(f)}for(d=1,u=a.length-1;d<u;d++)if(!a[d].offset){for(var x=C(a[d-1].offset||0),b=0,k=d+1;k<u;k++)if(a[k].offset){b=a[k].offset;break}b||(b=100,k=u);for(var N=((b=C(b))-x)/(k-d+1);d<k;d++)x+=N,a[d].offset=x+"%"}return a}),h._tear=function(i,a){i==a.top&&(a.top=i.prev),i==a.bottom&&(a.bottom=i.next),i.next&&(i.next.prev=i.prev),i.prev&&(i.prev.next=i.next)}),aa=(h._tofront=function(i,a){a.top!==i&&(tr(i,a),i.next=null,i.prev=a.top,a.top.next=i,a.top=i)},h._toback=function(i,a){a.bottom!==i&&(tr(i,a),i.next=a.bottom,i.prev=null,a.bottom.prev=i,a.bottom=i)},h._insertafter=function(i,a,d){tr(i,d),a==d.top&&(d.top=i),a.next&&(a.next.prev=i),i.next=a.next,i.prev=a,a.next=i},h._insertbefore=function(i,a,d){tr(i,d),a==d.bottom&&(d.bottom=i),a.prev&&(a.prev.next=i),i.prev=a.prev,a.prev=i,i.next=a},h.toMatrix=function(i,a){var d=Ee(i),u={_:{transform:nt},getBBox:function(){return d}};return Hi(u,a),u.matrix}),Hi=(h.transformPath=function(i,a){return Ft(i,aa(i,a))},h._extractTransform=function(i,a){if(a==null)return i._.transform;a=W(a).replace(/\.{3}|\u2026/g,i._.transform||nt);var d,u,f=h.parseTransformString(a),w=0,x=1,b=1,k=i._,N=new Re;if(k.transform=f||[],f)for(var R=0,P=f.length;R<P;R++){var z,A,V,Y,U,F=f[R],tt=F.length,G=W(F[0]).toLowerCase(),K=F[0]!=G,X=K?N.invert():0;G=="t"&&tt==3?K?(z=X.x(0,0),A=X.y(0,0),V=X.x(F[1],F[2]),Y=X.y(F[1],F[2]),N.translate(V-z,Y-A)):N.translate(F[1],F[2]):G=="r"?tt==2?(U=U||i.getBBox(1),N.rotate(F[1],U.x+U.width/2,U.y+U.height/2),w+=F[1]):tt==4&&(K?(V=X.x(F[2],F[3]),Y=X.y(F[2],F[3]),N.rotate(F[1],V,Y)):N.rotate(F[1],F[2],F[3]),w+=F[1]):G=="s"?tt==2||tt==3?(U=U||i.getBBox(1),N.scale(F[1],F[tt-1],U.x+U.width/2,U.y+U.height/2),x*=F[1],b*=F[tt-1]):tt==5&&(K?(V=X.x(F[3],F[4]),Y=X.y(F[3],F[4]),N.scale(F[1],F[2],V,Y)):N.scale(F[1],F[2],F[3],F[4]),x*=F[1],b*=F[2]):G=="m"&&tt==7&&N.add(F[1],F[2],F[3],F[4],F[5],F[6]),k.dirtyT=1,i.matrix=N}i.matrix=N,k.sx=x,k.sy=b,k.deg=w,k.dx=d=N.e,k.dy=u=N.f,x==1&&b==1&&!w&&k.bbox?(k.bbox.x+=+d,k.bbox.y+=+u):k.dirtyT=1}),Fi=function(i){var a=i[0];switch(a.toLowerCase()){case"t":return[a,0,0];case"m":return[a,1,0,0,1,0,0];case"r":return i.length==4?[a,0,i[2],i[3]]:[a,0];case"s":return i.length==5?[a,1,1,i[3],i[4]]:i.length==3?[a,1,1]:[a,1]}},la=h._equaliseTransform=function(i,a){a=W(a).replace(/\.{3}|\u2026/g,i),i=h.parseTransformString(i)||[],a=h.parseTransformString(a)||[];for(var d,u,f,w,x=ot(i.length,a.length),b=[],k=[],N=0;N<x;N++){if(f=i[N]||Fi(a[N]),w=a[N]||Fi(f),f[0]!=w[0]||f[0].toLowerCase()=="r"&&(f[2]!=w[2]||f[3]!=w[3])||f[0].toLowerCase()=="s"&&(f[3]!=w[3]||f[4]!=w[4]))return;for(b[N]=[],k[N]=[],d=0,u=ot(f.length,w.length);d<u;d++)d in f&&(b[N][d]=f[d]),d in w&&(k[N][d]=w[d])}return{from:b,to:k}};function Re(i,a,d,u,f,w){i!=null?(this.a=+i,this.b=+a,this.c=+d,this.d=+u,this.e=+f,this.f=+w):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}h._getContainer=function(i,a,d,u){var f;if((f=u!=null||h.is(i,"object")?i:O.doc.getElementById(i))!=null)return f.tagName?a==null?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:a,height:d}:{container:1,x:i,y:a,width:d,height:u}},h.pathToRelative=Oi,h._engine={},h.path2curve=Ns,h.matrix=function(i,a,d,u,f,w){return new Re(i,a,d,u,f,w)},function(i){function a(u){return u[0]*u[0]+u[1]*u[1]}function d(u){var f=Q.sqrt(a(u));u[0]&&(u[0]/=f),u[1]&&(u[1]/=f)}i.add=function(u,f,w,x,b,k){var N,R,P,z,A=[[],[],[]],V=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],Y=[[u,w,b],[f,x,k],[0,0,1]];for(u&&u instanceof Re&&(Y=[[u.a,u.c,u.e],[u.b,u.d,u.f],[0,0,1]]),N=0;N<3;N++)for(R=0;R<3;R++){for(z=0,P=0;P<3;P++)z+=V[N][P]*Y[P][R];A[N][R]=z}this.a=A[0][0],this.b=A[1][0],this.c=A[0][1],this.d=A[1][1],this.e=A[0][2],this.f=A[1][2]},i.invert=function(){var u=this,f=u.a*u.d-u.b*u.c;return new Re(u.d/f,-u.b/f,-u.c/f,u.a/f,(u.c*u.f-u.d*u.e)/f,(u.b*u.e-u.a*u.f)/f)},i.clone=function(){return new Re(this.a,this.b,this.c,this.d,this.e,this.f)},i.translate=function(u,f){this.add(1,0,0,1,u,f)},i.scale=function(u,f,w,x){f==null&&(f=u),(w||x)&&this.add(1,0,0,1,w,x),this.add(u,0,0,f,0,0),(w||x)&&this.add(1,0,0,1,-w,-x)},i.rotate=function(u,f,w){u=h.rad(u),f=f||0,w=w||0;var x=+Q.cos(u).toFixed(9),b=+Q.sin(u).toFixed(9);this.add(x,b,-b,x,f,w),this.add(1,0,0,1,-f,-w)},i.x=function(u,f){return u*this.a+f*this.c+this.e},i.y=function(u,f){return u*this.b+f*this.d+this.f},i.get=function(u){return+this[W.fromCharCode(97+u)].toFixed(4)},i.toString=function(){return h.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},i.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},i.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},i.split=function(){var u={};u.dx=this.e,u.dy=this.f;var f=[[this.a,this.c],[this.b,this.d]];u.scalex=Q.sqrt(a(f[0])),d(f[0]),u.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1],f[1]=[f[1][0]-f[0][0]*u.shear,f[1][1]-f[0][1]*u.shear],u.scaley=Q.sqrt(a(f[1])),d(f[1]),u.shear/=u.scaley;var w=-f[0][1],x=f[1][1];return x<0?(u.rotate=h.deg(Q.acos(x)),w<0&&(u.rotate=360-u.rotate)):u.rotate=h.deg(Q.asin(w)),u.isSimple=!(+u.shear.toFixed(9)||u.scalex.toFixed(9)!=u.scaley.toFixed(9)&&u.rotate),u.isSuperSimple=!+u.shear.toFixed(9)&&u.scalex.toFixed(9)==u.scaley.toFixed(9)&&!u.rotate,u.noRotation=!+u.shear.toFixed(9)&&!u.rotate,u},i.toTransformString=function(u){var f=u||this[et]();return f.isSimple?(f.scalex=+f.scalex.toFixed(4),f.scaley=+f.scaley.toFixed(4),f.rotate=+f.rotate.toFixed(4),(f.dx||f.dy?"t"+[f.dx,f.dy]:nt)+(f.scalex!=1||f.scaley!=1?"s"+[f.scalex,f.scaley,0,0]:nt)+(f.rotate?"r"+[f.rotate,0,0]:nt)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(Re.prototype);for(var ha=function(){this.returnValue=!1},ca=function(){return this.originalEvent.preventDefault()},da=function(){this.cancelBubble=!0},ua=function(){return this.originalEvent.stopPropagation()},zi=function(i){var a=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,d=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;return{x:i.clientX+d,y:i.clientY+a}},fa=O.doc.addEventListener?function(i,a,d,u){var f=function(x){var b=zi(x);return d.call(u,x,b.x,b.y)};if(i.addEventListener(a,f,!1),dt&&Et[a]){var w=function(x){for(var b=zi(x),k=x,N=0,R=x.targetTouches&&x.targetTouches.length;N<R;N++)if(x.targetTouches[N].target==i){(x=x.targetTouches[N]).originalEvent=k,x.preventDefault=ca,x.stopPropagation=ua;break}return d.call(u,x,b.x,b.y)};i.addEventListener(Et[a],w,!1)}return function(){return i.removeEventListener(a,f,!1),dt&&Et[a]&&i.removeEventListener(Et[a],w,!1),!0}}:O.doc.attachEvent?function(i,a,d,u){var f=function(w){w=w||O.win.event;var x=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,b=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,k=w.clientX+b,N=w.clientY+x;return w.preventDefault=w.preventDefault||ha,w.stopPropagation=w.stopPropagation||da,d.call(u,w,k,N)};return i.attachEvent("on"+a,f),function(){return i.detachEvent("on"+a,f),!0}}:void 0,De=[],Ar=function(i){for(var a,d=i.clientX,u=i.clientY,f=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,w=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft,x=De.length;x--;){if(a=De[x],dt&&i.touches){for(var b,k=i.touches.length;k--;)if((b=i.touches[k]).identifier==a.el._drag.id){d=b.clientX,u=b.clientY,(i.originalEvent?i.originalEvent:i).preventDefault();break}}else i.preventDefault();var N,R=a.el.node,P=R.nextSibling,z=R.parentNode,A=R.style.display;O.win.opera&&z.removeChild(R),R.style.display="none",N=a.el.paper.getElementByPoint(d,u),R.style.display=A,O.win.opera&&(P?z.insertBefore(R,P):z.appendChild(R)),N&&o("raphael.drag.over."+a.el.id,a.el,N),d+=w,u+=f,o("raphael.drag.move."+a.el.id,a.move_scope||a.el,d-a.el._drag.x,u-a.el._drag.y,d,u,i)}},Rr=function(i){h.unmousemove(Ar).unmouseup(Rr);for(var a,d=De.length;d--;)(a=De[d]).el._drag={},o("raphael.drag.end."+a.el.id,a.end_scope||a.start_scope||a.move_scope||a.el,i);De=[]},Nt=h.el={},Vi=at.length;Vi--;)(function(i){h[i]=Nt[i]=function(a,d){return h.is(a,"function")&&(this.events=this.events||[],this.events.push({name:i,f:a,unbind:fa(this.shape||this.node||O.doc,i,a,d||this)})),this},h["un"+i]=Nt["un"+i]=function(a){for(var d=this.events||[],u=d.length;u--;)d[u].name!=i||!h.is(a,"undefined")&&d[u].f!=a||(d[u].unbind(),d.splice(u,1),!d.length&&delete this.events);return this}})(at[Vi]);Nt.data=function(i,a){var d=Lt[this.id]=Lt[this.id]||{};if(arguments.length==0)return d;if(arguments.length==1){if(h.is(i,"object")){for(var u in i)i[I](u)&&this.data(u,i[u]);return this}return o("raphael.data.get."+this.id,this,d[i],i),d[i]}return d[i]=a,o("raphael.data.set."+this.id,this,a,i),this},Nt.removeData=function(i){return i==null?delete Lt[this.id]:Lt[this.id]&&delete Lt[this.id][i],this},Nt.getData=function(){return Xt(Lt[this.id]||{})},Nt.hover=function(i,a,d,u){return this.mouseover(i,d).mouseout(a,u||d)},Nt.unhover=function(i,a){return this.unmouseover(i).unmouseout(a)};var ts=[];Nt.drag=function(i,a,d,u,f,w){function x(b){(b.originalEvent||b).preventDefault();var k=b.clientX,N=b.clientY,R=O.doc.documentElement.scrollTop||O.doc.body.scrollTop,P=O.doc.documentElement.scrollLeft||O.doc.body.scrollLeft;if(this._drag.id=b.identifier,dt&&b.touches){for(var z,A=b.touches.length;A--;)if(z=b.touches[A],this._drag.id=z.identifier,z.identifier==this._drag.id){k=z.clientX,N=z.clientY;break}}this._drag.x=k+P,this._drag.y=N+R,!De.length&&h.mousemove(Ar).mouseup(Rr),De.push({el:this,move_scope:u,start_scope:f,end_scope:w}),a&&o.on("raphael.drag.start."+this.id,a),i&&o.on("raphael.drag.move."+this.id,i),d&&o.on("raphael.drag.end."+this.id,d),o("raphael.drag.start."+this.id,f||u||this,this._drag.x,this._drag.y,b)}return this._drag={},ts.push({el:this,start:x}),this.mousedown(x),this},Nt.onDragOver=function(i){i?o.on("raphael.drag.over."+this.id,i):o.unbind("raphael.drag.over."+this.id)},Nt.undrag=function(){for(var i=ts.length;i--;)ts[i].el==this&&(this.unmousedown(ts[i].start),ts.splice(i,1),o.unbind("raphael.drag.*."+this.id));!ts.length&&h.unmousemove(Ar).unmouseup(Rr),De=[]},m.circle=function(i,a,d){var u=h._engine.circle(this,i||0,a||0,d||0);return this.__set__&&this.__set__.push(u),u},m.rect=function(i,a,d,u,f){var w=h._engine.rect(this,i||0,a||0,d||0,u||0,f||0);return this.__set__&&this.__set__.push(w),w},m.ellipse=function(i,a,d,u){var f=h._engine.ellipse(this,i||0,a||0,d||0,u||0);return this.__set__&&this.__set__.push(f),f},m.path=function(i){i&&!h.is(i,"string")&&!h.is(i[0],bt)&&(i+=nt);var a=h._engine.path(h.format[Z](h,arguments),this);return this.__set__&&this.__set__.push(a),a},m.image=function(i,a,d,u,f){var w=h._engine.image(this,i||"about:blank",a||0,d||0,u||0,f||0);return this.__set__&&this.__set__.push(w),w},m.text=function(i,a,d){var u=h._engine.text(this,i||0,a||0,W(d));return this.__set__&&this.__set__.push(u),u},m.set=function(i){!h.is(i,"array")&&(i=Array.prototype.splice.call(arguments,0,arguments.length));var a=new Bs(i);return this.__set__&&this.__set__.push(a),a.paper=this,a.type="set",a},m.setStart=function(i){this.__set__=i||this.set()},m.setFinish=function(i){var a=this.__set__;return delete this.__set__,a},m.getSize=function(){var i=this.canvas.parentNode;return{width:i.offsetWidth,height:i.offsetHeight}},m.setSize=function(i,a){return h._engine.setSize.call(this,i,a)},m.setViewBox=function(i,a,d,u,f){return h._engine.setViewBox.call(this,i,a,d,u,f)},m.top=m.bottom=null,m.raphael=h;function Ui(){return this.x+ut+this.y+ut+this.width+"  "+this.height}m.getElementByPoint=function(i,a){var d,u,f,w,x,b,k,N=this.canvas,R=O.doc.elementFromPoint(i,a);if(O.win.opera&&R.tagName=="svg"){var P=(u=(d=N).getBoundingClientRect(),f=d.ownerDocument,w=f.body,x=f.documentElement,b=x.clientTop||w.clientTop||0,k=x.clientLeft||w.clientLeft||0,{y:u.top+(O.win.pageYOffset||x.scrollTop||w.scrollTop)-b,x:u.left+(O.win.pageXOffset||x.scrollLeft||w.scrollLeft)-k}),z=N.createSVGRect();z.x=i-P.x,z.y=a-P.y,z.width=z.height=1;var A=N.getIntersectionList(z,null);A.length&&(R=A[A.length-1])}if(!R)return null;for(;R.parentNode&&R!=N.parentNode&&!R.raphael;)R=R.parentNode;return R==this.canvas.parentNode&&(R=N),R=R&&R.raphael?this.getById(R.raphaelid):null},m.getElementsByBBox=function(i){var a=this.set();return this.forEach(function(d){h.isBBoxIntersect(d.getBBox(),i)&&a.push(d)}),a},m.getById=function(i){for(var a=this.bottom;a;){if(a.id==i)return a;a=a.next}return null},m.forEach=function(i,a){for(var d=this.bottom;d;){if(i.call(a,d)===!1)return this;d=d.next}return this},m.getElementsByPoint=function(i,a){var d=this.set();return this.forEach(function(u){u.isPointInside(i,a)&&d.push(u)}),d},Nt.isPointInside=function(i,a){var d=this.realPath=Ot[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=h.transformPath(d,this.attr("transform"))),h.isPointInsidePath(d,i,a)},Nt.getBBox=function(i){if(this.removed)return{};var a=this._;return i?(!a.dirty&&a.bboxwt||(this.realPath=Ot[this.type](this),a.bboxwt=Ee(this.realPath),a.bboxwt.toString=Ui,a.dirty=0),a.bboxwt):((a.dirty||a.dirtyT||!a.bbox)&&(!a.dirty&&this.realPath||(a.bboxwt=0,this.realPath=Ot[this.type](this)),a.bbox=Ee(Ft(this.realPath,this.matrix)),a.bbox.toString=Ui,a.dirty=a.dirtyT=0),a.bbox)},Nt.clone=function(){if(this.removed)return null;var i=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(i),i},Nt.glow=function(i){if(this.type=="text")return null;var a={width:((i=i||{}).width||10)+(+this.attr("stroke-width")||1),fill:i.fill||!1,opacity:i.opacity==null?.5:i.opacity,offsetx:i.offsetx||0,offsety:i.offsety||0,color:i.color||"#000"},d=a.width/2,u=this.paper,f=u.set(),w=this.realPath||Ot[this.type](this);w=this.matrix?Ft(w,this.matrix):w;for(var x=1;x<d+1;x++)f.push(u.path(w).attr({stroke:a.color,fill:a.fill?a.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(a.width/d*x).toFixed(3),opacity:+(a.opacity/d).toFixed(3)}));return f.insertBefore(this).translate(a.offsetx,a.offsety)};var Or=function(i,a,d,u,f,w,x,b,k){return k==null?oe(i,a,d,u,f,w,x,b):h.findDotsAtSegment(i,a,d,u,f,w,x,b,function(N,R,P,z,A,V,Y,U,F){if(!(F<0||oe(N,R,P,z,A,V,Y,U)<F)){var tt,G=.5,K=1-G;for(tt=oe(N,R,P,z,A,V,Y,U,K);Dt(tt-F)>.01;)tt=oe(N,R,P,z,A,V,Y,U,K+=(tt<F?1:-1)*(G/=2));return K}}(i,a,d,u,f,w,x,b,k))},Hr=function(i,a){return function(d,u,f){for(var w,x,b,k,N,R="",P={},z=0,A=0,V=(d=Ns(d)).length;A<V;A++){if((b=d[A])[0]=="M")w=+b[1],x=+b[2];else{if(z+(k=Or(w,x,b[1],b[2],b[3],b[4],b[5],b[6]))>u){if(a&&!P.start){if(R+=["C"+(N=Or(w,x,b[1],b[2],b[3],b[4],b[5],b[6],u-z)).start.x,N.start.y,N.m.x,N.m.y,N.x,N.y],f)return R;P.start=R,R=["M"+N.x,N.y+"C"+N.n.x,N.n.y,N.end.x,N.end.y,b[5],b[6]].join(),z+=k,w=+b[5],x=+b[6];continue}if(!i&&!a)return{x:(N=Or(w,x,b[1],b[2],b[3],b[4],b[5],b[6],u-z)).x,y:N.y,alpha:N.alpha}}z+=k,w=+b[5],x=+b[6]}R+=b.shift()+b}return P.end=R,(N=i?z:a?P:h.findDotsAtSegment(w,x,b[0],b[1],b[2],b[3],b[4],b[5],1)).alpha&&(N={x:N.x,y:N.y,alpha:N.alpha}),N}},$i=Hr(1),Pi=Hr(),Fr=Hr(0,1);h.getTotalLength=$i,h.getPointAtLength=Pi,h.getSubpath=function(i,a,d){if(this.getTotalLength(i)-d<1e-6)return Fr(i,a).end;var u=Fr(i,d,1);return a?Fr(u,a).end:u},Nt.getTotalLength=function(){var i=this.getPath();if(i)return this.node.getTotalLength?this.node.getTotalLength():$i(i)},Nt.getPointAtLength=function(i){var a=this.getPath();if(a)return Pi(a,i)},Nt.getPath=function(){var i,a=h._getPath[this.type];if(this.type!="text"&&this.type!="set")return a&&(i=a(this)),i},Nt.getSubpath=function(i,a){var d=this.getPath();if(d)return h.getSubpath(d,i,a)};var Zt=h.easing_formulas={linear:function(i){return i},"<":function(i){return Tt(i,1.7)},">":function(i){return Tt(i,.48)},"<>":function(i){var a=.48-i/1.04,d=Q.sqrt(.1734+a*a),u=d-a,f=-d-a,w=Tt(Dt(u),1/3)*(u<0?-1:1)+Tt(Dt(f),1/3)*(f<0?-1:1)+.5;return 3*(1-w)*w*w+w*w*w},backIn:function(i){var a=1.70158;return i*i*((a+1)*i-a)},backOut:function(i){var a=1.70158;return(i-=1)*i*((a+1)*i+a)+1},elastic:function(i){return i==!!i?i:Tt(2,-10*i)*Q.sin(2*Rt*(i-.075)/.3)+1},bounce:function(i){var a=7.5625,d=2.75;return i<1/d?a*i*i:i<2/d?a*(i-=1.5/d)*i+.75:i<2.5/d?a*(i-=2.25/d)*i+.9375:a*(i-=2.625/d)*i+.984375}};Zt.easeIn=Zt["ease-in"]=Zt["<"],Zt.easeOut=Zt["ease-out"]=Zt[">"],Zt.easeInOut=Zt["ease-in-out"]=Zt["<>"],Zt["back-in"]=Zt.backIn,Zt["back-out"]=Zt.backOut;var kt=[],Yi=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){setTimeout(i,16)},zr=function(){for(var i=+new Date,a=0;a<kt.length;a++){var d=kt[a];if(!d.el.removed&&!d.paused){var u,f,w=i-d.start,x=d.ms,b=d.easing,k=d.from,N=d.diff,R=d.to,P=(d.t,d.el),z={},A={};if(d.initstatus?(w=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*x,d.status=d.initstatus,delete d.initstatus,d.stop&&kt.splice(a--,1)):d.status=(d.prev+(d.percent-d.prev)*(w/x))/d.anim.top,!(w<0))if(w<x){var V=b(w/x);for(var Y in k)if(k[I](Y)){switch(M[Y]){case gt:u=+k[Y]+V*x*N[Y];break;case"colour":u="rgb("+[Vr(S(k[Y].r+V*x*N[Y].r)),Vr(S(k[Y].g+V*x*N[Y].g)),Vr(S(k[Y].b+V*x*N[Y].b))].join(",")+")";break;case"path":u=[];for(var U=0,F=k[Y].length;U<F;U++){u[U]=[k[Y][U][0]];for(var tt=1,G=k[Y][U].length;tt<G;tt++)u[U][tt]=+k[Y][U][tt]+V*x*N[Y][U][tt];u[U]=u[U].join(ut)}u=u.join(ut);break;case"transform":if(N[Y].real)for(u=[],U=0,F=k[Y].length;U<F;U++)for(u[U]=[k[Y][U][0]],tt=1,G=k[Y][U].length;tt<G;tt++)u[U][tt]=k[Y][U][tt]+V*x*N[Y][U][tt];else{var K=function(ft){return+k[Y][ft]+V*x*N[Y][ft]};u=[["m",K(0),K(1),K(2),K(3),K(4),K(5)]]}break;case"csv":if(Y=="clip-rect")for(u=[],U=4;U--;)u[U]=+k[Y][U]+V*x*N[Y][U];break;default:var X=[][H](k[Y]);for(u=[],U=P.paper.customAttributes[Y].length;U--;)u[U]=+X[U]+V*x*N[Y][U]}z[Y]=u}P.attr(z),function(ft,lt,pt){setTimeout(function(){o("raphael.anim.frame."+ft,lt,pt)})}(P.id,P,d.anim)}else{if(function(ft,lt,pt){setTimeout(function(){o("raphael.anim.frame."+lt.id,lt,pt),o("raphael.anim.finish."+lt.id,lt,pt),h.is(ft,"function")&&ft.call(lt)})}(d.callback,P,d.anim),P.attr(R),kt.splice(a--,1),d.repeat>1&&!d.next){for(f in R)R[I](f)&&(A[f]=d.totalOrigin[f]);d.el.attr(A),Ls(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&Ls(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}kt.length&&Yi(zr)},Vr=function(i){return i>255?255:i<0?0:i};function pa(i,a,d,u,f,w){var x=3*a,b=3*(u-a)-x,k=1-x-b,N=3*d,R=3*(f-d)-N,P=1-N-R;function z(A){return((k*A+b)*A+x)*A}return function(A,V){var Y=function(U,F){var tt,G,K,X,ft,lt;for(K=U,lt=0;lt<8;lt++){if(X=z(K)-U,Dt(X)<F)return K;if(Dt(ft=(3*k*K+2*b)*K+x)<1e-6)break;K-=X/ft}if(G=1,(K=U)<(tt=0))return tt;if(K>G)return G;for(;tt<G;){if(X=z(K),Dt(X-U)<F)return K;U>X?tt=K:G=K,K=(G-tt)/2+tt}return K}(A,V);return((P*Y+R)*Y+N)*Y}(i,1/(200*w))}function me(i,a){var d=[],u={};if(this.ms=a,this.times=1,i){for(var f in i)i[I](f)&&(u[C(f)]=i[f],d.push(C(f)));d.sort(Bt)}this.anim=u,this.top=d[d.length-1],this.percents=d}function Ls(i,a,d,u,f,w){d=C(d);var x,b,k,N,R,P,z=i.ms,A={},V={},Y={};if(u)for(F=0,tt=kt.length;F<tt;F++){var U=kt[F];if(U.el.id==a.id&&U.anim==i){U.percent!=d?(kt.splice(F,1),k=1):b=U,a.attr(U.totalOrigin);break}}else u=+V;for(var F=0,tt=i.percents.length;F<tt;F++){if(i.percents[F]==d||i.percents[F]>u*i.top){d=i.percents[F],R=i.percents[F-1]||0,z=z/i.top*(d-R),N=i.percents[F+1],x=i.anim[d];break}u&&a.attr(i.anim[i.percents[F]])}if(x){if(b)b.initstatus=u,b.start=new Date-b.ms*u;else{for(var G in x)if(x[I](G)&&(M[I](G)||a.paper.customAttributes[I](G)))switch(A[G]=a.attr(G),A[G]==null&&(A[G]=$[G]),V[G]=x[G],M[G]){case gt:Y[G]=(V[G]-A[G])/z;break;case"colour":A[G]=h.getRGB(A[G]);var K=h.getRGB(V[G]);Y[G]={r:(K.r-A[G].r)/z,g:(K.g-A[G].g)/z,b:(K.b-A[G].b)/z};break;case"path":var X=Ns(A[G],V[G]),ft=X[1];for(A[G]=X[0],Y[G]=[],F=0,tt=A[G].length;F<tt;F++){Y[G][F]=[0];for(var lt=1,pt=A[G][F].length;lt<pt;lt++)Y[G][F][lt]=(ft[F][lt]-A[G][F][lt])/z}break;case"transform":var es=a._,Is=la(es[G],V[G]);if(Is)for(A[G]=Is.from,V[G]=Is.to,Y[G]=[],Y[G].real=!0,F=0,tt=A[G].length;F<tt;F++)for(Y[G][F]=[A[G][F][0]],lt=1,pt=A[G][F].length;lt<pt;lt++)Y[G][F][lt]=(V[G][F][lt]-A[G][F][lt])/z;else{var Kt=a.matrix||new Re,le={_:{transform:es.transform},getBBox:function(){return a.getBBox(1)}};A[G]=[Kt.a,Kt.b,Kt.c,Kt.d,Kt.e,Kt.f],Hi(le,V[G]),V[G]=le._.transform,Y[G]=[(le.matrix.a-Kt.a)/z,(le.matrix.b-Kt.b)/z,(le.matrix.c-Kt.c)/z,(le.matrix.d-Kt.d)/z,(le.matrix.e-Kt.e)/z,(le.matrix.f-Kt.f)/z]}break;case"csv":var ss=W(x[G])[et](E),rs=W(A[G])[et](E);if(G=="clip-rect")for(A[G]=rs,Y[G]=[],F=rs.length;F--;)Y[G][F]=(ss[F]-A[G][F])/z;V[G]=ss;break;default:for(ss=[][H](x[G]),rs=[][H](A[G]),Y[G]=[],F=a.paper.customAttributes[G].length;F--;)Y[G][F]=((ss[F]||0)-(rs[F]||0))/z}var er=x.easing,ye=h.easing_formulas[er];if(!ye)if((ye=W(er).match(p))&&ye.length==5){var He=ye;ye=function(sr){return pa(sr,+He[1],+He[2],+He[3],+He[4],z)}}else ye=Ct;if(U={anim:i,percent:d,timestamp:P=x.start||i.start||+new Date,start:P+(i.del||0),status:0,initstatus:u||0,stop:!1,ms:z,easing:ye,from:A,diff:Y,to:V,el:a,callback:x.callback,prev:R,next:N,repeat:w||i.times,origin:a.attr(),totalOrigin:f},kt.push(U),u&&!b&&!k&&(U.stop=!0,U.start=new Date-z*u,kt.length==1))return zr();k&&(U.start=new Date-U.ms*u),kt.length==1&&Yi(zr)}o("raphael.anim.start."+a.id,a,i)}}function Gi(i){for(var a=0;a<kt.length;a++)kt[a].el.paper==i&&kt.splice(a--,1)}Nt.animateWith=function(i,a,d,u,f,w){if(this.removed)return w&&w.call(this),this;var x=d instanceof me?d:h.animation(d,u,f,w);Ls(x,this,x.percents[0],null,this.attr());for(var b=0,k=kt.length;b<k;b++)if(kt[b].anim==a&&kt[b].el==i){kt[k-1].start=kt[b].start;break}return this},Nt.onAnimation=function(i){return i?o.on("raphael.anim.frame."+this.id,i):o.unbind("raphael.anim.frame."+this.id),this},me.prototype.delay=function(i){var a=new me(this.anim,this.ms);return a.times=this.times,a.del=+i||0,a},me.prototype.repeat=function(i){var a=new me(this.anim,this.ms);return a.del=this.del,a.times=Q.floor(ot(i,0))||1,a},h.animation=function(i,a,d,u){if(i instanceof me)return i;!h.is(d,"function")&&d||(u=u||d||null,d=null),i=Object(i),a=+a||0;var f,w,x={};for(w in i)i[I](w)&&C(w)!=w&&C(w)+"%"!=w&&(f=!0,x[w]=i[w]);if(f)return d&&(x.easing=d),u&&(x.callback=u),new me({100:x},a);if(u){var b=0;for(var k in i){var N=B(k);i[I](k)&&N>b&&(b=N)}!i[b+="%"].callback&&(i[b].callback=u)}return new me(i,a)},Nt.animate=function(i,a,d,u){if(this.removed)return u&&u.call(this),this;var f=i instanceof me?i:h.animation(i,a,d,u);return Ls(f,this,f.percents[0],null,this.attr()),this},Nt.setTime=function(i,a){return i&&a!=null&&this.status(i,rt(a,i.ms)/i.ms),this},Nt.status=function(i,a){var d,u,f=[],w=0;if(a!=null)return Ls(i,this,-1,rt(a,1)),this;for(d=kt.length;w<d;w++)if((u=kt[w]).el.id==this.id&&(!i||u.anim==i)){if(i)return u.status;f.push({anim:u.anim,status:u.status})}return i?0:f},Nt.pause=function(i){for(var a=0;a<kt.length;a++)kt[a].el.id!=this.id||i&&kt[a].anim!=i||o("raphael.anim.pause."+this.id,this,kt[a].anim)!==!1&&(kt[a].paused=!0);return this},Nt.resume=function(i){for(var a=0;a<kt.length;a++)if(kt[a].el.id==this.id&&(!i||kt[a].anim==i)){var d=kt[a];o("raphael.anim.resume."+this.id,this,d.anim)!==!1&&(delete d.paused,this.status(d.anim,d.status))}return this},Nt.stop=function(i){for(var a=0;a<kt.length;a++)kt[a].el.id!=this.id||i&&kt[a].anim!=i||o("raphael.anim.stop."+this.id,this,kt[a].anim)!==!1&&kt.splice(a--,1);return this},o.on("raphael.remove",Gi),o.on("raphael.clear",Gi),Nt.toString=function(){return"Raphals object"};var Xi,Wi,Oe,ji,Bs=function(i){if(this.items=[],this.length=0,this.type="set",i)for(var a=0,d=i.length;a<d;a++)!i[a]||i[a].constructor!=Nt.constructor&&i[a].constructor!=Bs||(this[this.items.length]=this.items[this.items.length]=i[a],this.length++)},Gt=Bs.prototype;for(var Ur in Gt.push=function(){for(var i,a,d=0,u=arguments.length;d<u;d++)!(i=arguments[d])||i.constructor!=Nt.constructor&&i.constructor!=Bs||(this[a=this.items.length]=this.items[a]=i,this.length++);return this},Gt.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},Gt.forEach=function(i,a){for(var d=0,u=this.items.length;d<u;d++)if(i.call(a,this.items[d],d)===!1)return this;return this},Nt)Nt[I](Ur)&&(Gt[Ur]=function(i){return function(){var a=arguments;return this.forEach(function(d){d[i][Z](d,a)})}}(Ur));return Gt.attr=function(i,a){if(i&&h.is(i,bt)&&h.is(i[0],"object"))for(var d=0,u=i.length;d<u;d++)this.items[d].attr(i[d]);else for(var f=0,w=this.items.length;f<w;f++)this.items[f].attr(i,a);return this},Gt.clear=function(){for(;this.length;)this.pop()},Gt.splice=function(i,a,d){i=i<0?ot(this.length+i,0):i,a=ot(0,rt(this.length-i,a));var u,f=[],w=[],x=[];for(u=2;u<arguments.length;u++)x.push(arguments[u]);for(u=0;u<a;u++)w.push(this[i+u]);for(;u<this.length-i;u++)f.push(this[i+u]);var b=x.length;for(u=0;u<b+f.length;u++)this.items[i+u]=this[i+u]=u<b?x[u]:f[u-b];for(u=this.items.length=this.length-=a-b;this[u];)delete this[u++];return new Bs(w)},Gt.exclude=function(i){for(var a=0,d=this.length;a<d;a++)if(this[a]==i)return this.splice(a,1),!0},Gt.animate=function(i,a,d,u){(h.is(d,"function")||!d)&&(u=d||null);var f,w,x=this.items.length,b=x,k=this;if(!x)return this;u&&(w=function(){!--x&&u.call(k)}),d=h.is(d,"string")?d:w;var N=h.animation(i,a,d,w);for(f=this.items[--b].animate(N);b--;)this.items[b]&&!this.items[b].removed&&this.items[b].animateWith(f,N,N),this.items[b]&&!this.items[b].removed||x--;return this},Gt.insertAfter=function(i){for(var a=this.items.length;a--;)this.items[a].insertAfter(i);return this},Gt.getBBox=function(){for(var i=[],a=[],d=[],u=[],f=this.items.length;f--;)if(!this.items[f].removed){var w=this.items[f].getBBox();i.push(w.x),a.push(w.y),d.push(w.x+w.width),u.push(w.y+w.height)}return{x:i=rt[Z](0,i),y:a=rt[Z](0,a),x2:d=ot[Z](0,d),y2:u=ot[Z](0,u),width:d-i,height:u-a}},Gt.clone=function(i){i=this.paper.set();for(var a=0,d=this.items.length;a<d;a++)i.push(this.items[a].clone());return i},Gt.toString=function(){return"Raphals set"},Gt.glow=function(i){var a=this.paper.set();return this.forEach(function(d,u){var f=d.glow(i);f!=null&&f.forEach(function(w,x){a.push(w)})}),a},Gt.isPointInside=function(i,a){var d=!1;return this.forEach(function(u){if(u.isPointInside(i,a))return d=!0,!1}),d},h.registerFont=function(i){if(!i.face)return i;this.fonts=this.fonts||{};var a={w:i.w,face:{},glyphs:{}},d=i.face["font-family"];for(var u in i.face)i.face[I](u)&&(a.face[u]=i.face[u]);if(this.fonts[d]?this.fonts[d].push(a):this.fonts[d]=[a],!i.svg){for(var f in a.face["units-per-em"]=B(i.face["units-per-em"],10),i.glyphs)if(i.glyphs[I](f)){var w=i.glyphs[f];if(a.glyphs[f]={w:w.w,k:{},d:w.d&&"M"+w.d.replace(/[mlcxtrv]/g,function(b){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[b]||"M"})+"z"},w.k)for(var x in w.k)w[I](x)&&(a.glyphs[f].k[x]=w.k[x])}}return i},m.getFont=function(i,a,d,u){if(u=u||"normal",d=d||"normal",a=+a||{normal:400,bold:700,lighter:300,bolder:800}[a]||400,h.fonts){var f,w=h.fonts[i];if(!w){var x=new RegExp("(^|\\s)"+i.replace(/[^\w\d\s+!~.:_-]/g,nt)+"(\\s|$)","i");for(var b in h.fonts)if(h.fonts[I](b)&&x.test(b)){w=h.fonts[b];break}}if(w)for(var k=0,N=w.length;k<N&&((f=w[k]).face["font-weight"]!=a||f.face["font-style"]!=d&&f.face["font-style"]||f.face["font-stretch"]!=u);k++);return f}},m.print=function(i,a,d,u,f,w,x,b){w=w||"middle",x=ot(rt(x||0,1),-1),b=ot(rt(b||1,3),1);var k,N=W(d)[et](nt),R=0,P=0,z=nt;if(h.is(u,"string")&&(u=this.getFont(u)),u){k=(f||16)/u.face["units-per-em"];for(var A=u.face.bbox[et](E),V=+A[0],Y=A[3]-A[1],U=0,F=+A[1]+(w=="baseline"?Y+ +u.face.descent:Y/2),tt=0,G=N.length;tt<G;tt++){if(N[tt]==`
`)R=0,X=0,P=0,U+=Y*b;else{var K=P&&u.glyphs[N[tt-1]]||{},X=u.glyphs[N[tt]];R+=P?(K.w||u.w)+(K.k&&K.k[N[tt]]||0)+u.w*x:0,P=1}X&&X.d&&(z+=h.transformPath(X.d,["t",R*k,U*k,"s",k,k,V,F,"t",(i-V)/k,(a-F)/k]))}}return this.path(z).attr({fill:"#000",stroke:"none"})},m.add=function(i){if(h.is(i,"array"))for(var a,d=this.set(),u=0,f=i.length;u<f;u++)a=i[u]||{},D[I](a.type)&&d.push(this[a.type]().attr(a));return d},h.format=function(i,a){var d=h.is(a,bt)?[0][H](a):arguments;return i&&h.is(i,"string")&&d.length-1&&(i=i.replace(L,function(u,f){return d[++f]==null?nt:d[f]})),i||nt},h.fullfill=(Xi=/\{([^\}]+)\}/g,Wi=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(i,a){return String(i).replace(Xi,function(d,u){return function(f,w,x){var b=x;return w.replace(Wi,function(k,N,R,P,z){N=N||P,b&&(N in b&&(b=b[N]),typeof b=="function"&&z&&(b=b()))}),b=(b==null||b==x?f:b)+""}(d,u,a)})}),h.ninja=function(){if(q.was)O.win.Raphael=q.is;else{window.Raphael=void 0;try{delete window.Raphael}catch{}}return h},h.st=Gt,o.on("raphael.DOMload",function(){g=!0}),(Oe=document).readyState==null&&Oe.addEventListener&&(Oe.addEventListener("DOMContentLoaded",ji=function(){Oe.removeEventListener("DOMContentLoaded",ji,!1),Oe.readyState="complete"},!1),Oe.readyState="loading"),function i(){/in/.test(Oe.readyState)?setTimeout(i,9):h.eve("raphael.DOMload")}(),h}.apply(s,l))===void 0||(e.exports=c)},function(e,s,n){var l,c;l=[n(0),n(3),n(4)],(c=function(o){return o}.apply(s,l))===void 0||(e.exports=c)},function(e,s,n){var l,c,o,h,g,m,E,D,L,I,O,q,it,Z;h="hasOwnProperty",g=/[\.\/]/,m=/\s*,\s*/,E=function(H,dt){return H-dt},D={n:{}},L=function(){for(var H=0,dt=this.length;H<dt;H++)if(this[H]!==void 0)return this[H]},I=function(){for(var H=this.length;--H;)if(this[H]!==void 0)return this[H]},O=Object.prototype.toString,q=String,it=Array.isArray||function(H){return H instanceof Array||O.call(H)=="[object Array]"},(Z=function(H,dt){var nt,ut=o,W=Array.prototype.slice.call(arguments,2),et=Z.listeners(H),at=0,Et=[],ht={},Q=[],ot=c;Q.firstDefined=L,Q.lastDefined=I,c=H,o=0;for(var rt=0,Dt=et.length;rt<Dt;rt++)"zIndex"in et[rt]&&(Et.push(et[rt].zIndex),et[rt].zIndex<0&&(ht[et[rt].zIndex]=et[rt]));for(Et.sort(E);Et[at]<0;)if(nt=ht[Et[at++]],Q.push(nt.apply(dt,W)),o)return o=ut,Q;for(rt=0;rt<Dt;rt++)if("zIndex"in(nt=et[rt]))if(nt.zIndex==Et[at]){if(Q.push(nt.apply(dt,W)),o)break;do if((nt=ht[Et[++at]])&&Q.push(nt.apply(dt,W)),o)break;while(nt)}else ht[nt.zIndex]=nt;else if(Q.push(nt.apply(dt,W)),o)break;return o=ut,c=ot,Q})._events=D,Z.listeners=function(H){var dt,nt,ut,W,et,at,Et,ht,Q=it(H)?H:H.split(g),ot=D,rt=[ot],Dt=[];for(W=0,et=Q.length;W<et;W++){for(ht=[],at=0,Et=rt.length;at<Et;at++)for(nt=[(ot=rt[at].n)[Q[W]],ot["*"]],ut=2;ut--;)(dt=nt[ut])&&(ht.push(dt),Dt=Dt.concat(dt.f||[]));rt=ht}return Dt},Z.separator=function(H){H?(H="["+(H=q(H).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",g=new RegExp(H)):g=/[\.\/]/},Z.on=function(H,dt){if(typeof dt!="function")return function(){};for(var nt=it(H)?it(H[0])?H:[H]:q(H).split(m),ut=0,W=nt.length;ut<W;ut++)(function(et){for(var at,Et=it(et)?et:q(et).split(g),ht=D,Q=0,ot=Et.length;Q<ot;Q++)ht=(ht=ht.n).hasOwnProperty(Et[Q])&&ht[Et[Q]]||(ht[Et[Q]]={n:{}});for(ht.f=ht.f||[],Q=0,ot=ht.f.length;Q<ot;Q++)if(ht.f[Q]==dt){at=!0;break}!at&&ht.f.push(dt)})(nt[ut]);return function(et){+et==+et&&(dt.zIndex=+et)}},Z.f=function(H){var dt=[].slice.call(arguments,1);return function(){Z.apply(null,[H,null].concat(dt).concat([].slice.call(arguments,0)))}},Z.stop=function(){o=1},Z.nt=function(H){var dt=it(c)?c.join("."):c;return H?new RegExp("(?:\\.|\\/|^)"+H+"(?:\\.|\\/|$)").test(dt):dt},Z.nts=function(){return it(c)?c:c.split(g)},Z.off=Z.unbind=function(H,dt){if(H){var nt=it(H)?it(H[0])?H:[H]:q(H).split(m);if(nt.length>1)for(var ut=0,W=nt.length;ut<W;ut++)Z.off(nt[ut],dt);else{nt=it(H)?H:q(H).split(g);var et,at,Et,ht,Q,ot=[D];for(ut=0,W=nt.length;ut<W;ut++)for(ht=0;ht<ot.length;ht+=Et.length-2){if(Et=[ht,1],et=ot[ht].n,nt[ut]!="*")et[nt[ut]]&&Et.push(et[nt[ut]]);else for(at in et)et[h](at)&&Et.push(et[at]);ot.splice.apply(ot,Et)}for(ut=0,W=ot.length;ut<W;ut++)for(et=ot[ut];et.n;){if(dt){if(et.f){for(ht=0,Q=et.f.length;ht<Q;ht++)if(et.f[ht]==dt){et.f.splice(ht,1);break}!et.f.length&&delete et.f}for(at in et.n)if(et.n[h](at)&&et.n[at].f){var rt=et.n[at].f;for(ht=0,Q=rt.length;ht<Q;ht++)if(rt[ht]==dt){rt.splice(ht,1);break}!rt.length&&delete et.n[at].f}}else for(at in delete et.f,et.n)et.n[h](at)&&et.n[at].f&&delete et.n[at].f;et=et.n}}}else Z._events=D={n:{}}},Z.once=function(H,dt){var nt=function(){return Z.off(H,nt),dt.apply(this,arguments)};return Z.on(H,nt)},Z.version="0.5.0",Z.toString=function(){return"You are running Eve 0.5.0"},e.exports?e.exports=Z:(l=function(){return Z}.apply(s,[]))===void 0||(e.exports=l)},function(e,s,n){var l,c;l=[n(0)],(c=function(o){if(!o||o.svg){var h="hasOwnProperty",g=String,m=parseFloat,E=parseInt,D=Math,L=D.max,I=D.abs,O=D.pow,q=/[, ]+/,it=o.eve,Z="",H=" ",dt="http://www.w3.org/1999/xlink",nt={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},ut={};o.toString=function(){return`Your browser supports SVG.
You are running Raphal `+this.version};var W=function(v,y){if(y)for(var p in typeof v=="string"&&(v=W(v)),y)y[h](p)&&(p.substring(0,6)=="xlink:"?v.setAttributeNS(dt,p.substring(6),g(y[p])):v.setAttribute(p,g(y[p])));else(v=o._g.doc.createElementNS("http://www.w3.org/2000/svg",v)).style&&(v.style.webkitTapHighlightColor="rgba(0,0,0,0)");return v},et=function(v,y){var p="linear",S=v.id+y,C=.5,B=.5,T=v.node,$=v.paper,M=T.style,j=o._g.doc.getElementById(S);if(!j){if(y=(y=g(y).replace(o._radial_gradient,function(Bt,Ct,ct){if(p="radial",Ct&&ct){C=m(Ct);var Ht=2*((B=m(ct))>.5)-1;O(C-.5,2)+O(B-.5,2)>.25&&(B=D.sqrt(.25-O(C-.5,2))*Ht+.5)&&B!=.5&&(B=B.toFixed(5)-1e-5*Ht)}return Z})).split(/\s*\-\s*/),p=="linear"){var J=y.shift();if(J=-m(J),isNaN(J))return null;var st=[0,0,D.cos(o.rad(J)),D.sin(o.rad(J))],mt=1/(L(I(st[2]),I(st[3]))||1);st[2]*=mt,st[3]*=mt,st[2]<0&&(st[0]=-st[2],st[2]=0),st[3]<0&&(st[1]=-st[3],st[3]=0)}var xt=o._parseDots(y);if(!xt)return null;if(S=S.replace(/[\(\)\s,\xb0#]/g,"_"),v.gradient&&S!=v.gradient.id&&($.defs.removeChild(v.gradient),delete v.gradient),!v.gradient){j=W(p+"Gradient",{id:S}),v.gradient=j,W(j,p=="radial"?{fx:C,fy:B}:{x1:st[0],y1:st[1],x2:st[2],y2:st[3],gradientTransform:v.matrix.invert()}),$.defs.appendChild(j);for(var yt=0,Lt=xt.length;yt<Lt;yt++)j.appendChild(W("stop",{offset:xt[yt].offset?xt[yt].offset:yt?"100%":"0%","stop-color":xt[yt].color||"#fff","stop-opacity":isFinite(xt[yt].opacity)?xt[yt].opacity:1}))}}return W(T,{fill:at(S),opacity:1,"fill-opacity":1}),M.fill=Z,M.opacity=1,M.fillOpacity=1,1},at=function(v){if((y=document.documentMode)&&(y===9||y===10))return"url('#"+v+"')";var y,p=document.location;return"url('"+(p.protocol+"//"+p.host+p.pathname+p.search)+"#"+v+"')"},Et=function(v){var y=v.getBBox(1);W(v.pattern,{patternTransform:v.matrix.invert()+" translate("+y.x+","+y.y+")"})},ht=function(v,y,p){if(v.type=="path"){for(var S,C,B,T,$,M=g(y).toLowerCase().split("-"),j=v.paper,J=p?"end":"start",st=v.node,mt=v.attrs,xt=mt["stroke-width"],yt=M.length,Lt="classic",Bt=3,Ct=3,ct=5;yt--;)switch(M[yt]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":Lt=M[yt];break;case"wide":Ct=5;break;case"narrow":Ct=2;break;case"long":Bt=5;break;case"short":Bt=2}if(Lt=="open"?(Bt+=2,Ct+=2,ct+=2,B=1,T=p?4:1,$={fill:"none",stroke:mt.stroke}):(T=B=Bt/2,$={fill:mt.stroke,stroke:"none"}),v._.arrows?p?(v._.arrows.endPath&&ut[v._.arrows.endPath]--,v._.arrows.endMarker&&ut[v._.arrows.endMarker]--):(v._.arrows.startPath&&ut[v._.arrows.startPath]--,v._.arrows.startMarker&&ut[v._.arrows.startMarker]--):v._.arrows={},Lt!="none"){var Ht="raphael-marker-"+Lt,Ot="raphael-marker-"+J+Lt+Bt+Ct+"-obj"+v.id;o._g.doc.getElementById(Ht)?ut[Ht]++:(j.defs.appendChild(W(W("path"),{"stroke-linecap":"round",d:nt[Lt],id:Ht})),ut[Ht]=1);var Ft,It=o._g.doc.getElementById(Ot);It?(ut[Ot]++,Ft=It.getElementsByTagName("use")[0]):(It=W(W("marker"),{id:Ot,markerHeight:Ct,markerWidth:Bt,orient:"auto",refX:T,refY:Ct/2}),Ft=W(W("use"),{"xlink:href":"#"+Ht,transform:(p?"rotate(180 "+Bt/2+" "+Ct/2+") ":Z)+"scale("+Bt/ct+","+Ct/ct+")","stroke-width":(1/((Bt/ct+Ct/ct)/2)).toFixed(4)}),It.appendChild(Ft),j.defs.appendChild(It),ut[Ot]=1),W(Ft,$);var Jt=B*(Lt!="diamond"&&Lt!="oval");p?(S=v._.arrows.startdx*xt||0,C=o.getTotalLength(mt.path)-Jt*xt):(S=Jt*xt,C=o.getTotalLength(mt.path)-(v._.arrows.enddx*xt||0)),($={})["marker-"+J]="url(#"+Ot+")",(C||S)&&($.d=o.getSubpath(mt.path,S,C)),W(st,$),v._.arrows[J+"Path"]=Ht,v._.arrows[J+"Marker"]=Ot,v._.arrows[J+"dx"]=Jt,v._.arrows[J+"Type"]=Lt,v._.arrows[J+"String"]=y}else p?(S=v._.arrows.startdx*xt||0,C=o.getTotalLength(mt.path)-S):(S=0,C=o.getTotalLength(mt.path)-(v._.arrows.enddx*xt||0)),v._.arrows[J+"Path"]&&W(st,{d:o.getSubpath(mt.path,S,C)}),delete v._.arrows[J+"Path"],delete v._.arrows[J+"Marker"],delete v._.arrows[J+"dx"],delete v._.arrows[J+"Type"],delete v._.arrows[J+"String"];for($ in ut)if(ut[h]($)&&!ut[$]){var Xt=o._g.doc.getElementById($);Xt&&Xt.parentNode.removeChild(Xt)}}},Q={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},ot=function(v,y,p){if(y=Q[g(y).toLowerCase()]){for(var S=v.attrs["stroke-width"]||"1",C={round:S,square:S,butt:0}[v.attrs["stroke-linecap"]||p["stroke-linecap"]]||0,B=[],T=y.length;T--;)B[T]=y[T]*S+(T%2?1:-1)*C;W(v.node,{"stroke-dasharray":B.join(",")})}else W(v.node,{"stroke-dasharray":"none"})},rt=function(v,y){var p=v.node,S=v.attrs,C=p.style.visibility;for(var B in p.style.visibility="hidden",y)if(y[h](B)){if(!o._availableAttrs[h](B))continue;var T=y[B];switch(S[B]=T,B){case"blur":v.blur(T);break;case"title":var $=p.getElementsByTagName("title");if($.length&&($=$[0]))$.firstChild.nodeValue=T;else{$=W("title");var M=o._g.doc.createTextNode(T);$.appendChild(M),p.appendChild($)}break;case"href":case"target":var j=p.parentNode;if(j.tagName.toLowerCase()!="a"){var J=W("a");j.insertBefore(J,p),J.appendChild(p),j=J}B=="target"?j.setAttributeNS(dt,"show",T=="blank"?"new":T):j.setAttributeNS(dt,B,T);break;case"cursor":p.style.cursor=T;break;case"transform":v.transform(T);break;case"arrow-start":ht(v,T);break;case"arrow-end":ht(v,T,1);break;case"clip-rect":var st=g(T).split(q);if(st.length==4){v.clip&&v.clip.parentNode.parentNode.removeChild(v.clip.parentNode);var mt=W("clipPath"),xt=W("rect");mt.id=o.createUUID(),W(xt,{x:st[0],y:st[1],width:st[2],height:st[3]}),mt.appendChild(xt),v.paper.defs.appendChild(mt),W(p,{"clip-path":"url(#"+mt.id+")"}),v.clip=xt}if(!T){var yt=p.getAttribute("clip-path");if(yt){var Lt=o._g.doc.getElementById(yt.replace(/(^url\(#|\)$)/g,Z));Lt&&Lt.parentNode.removeChild(Lt),W(p,{"clip-path":Z}),delete v.clip}}break;case"path":v.type=="path"&&(W(p,{d:T?S.path=o._pathToAbsolute(T):"M0,0"}),v._.dirty=1,v._.arrows&&("startString"in v._.arrows&&ht(v,v._.arrows.startString),"endString"in v._.arrows&&ht(v,v._.arrows.endString,1)));break;case"width":if(p.setAttribute(B,T),v._.dirty=1,!S.fx)break;B="x",T=S.x;case"x":S.fx&&(T=-S.x-(S.width||0));case"rx":if(B=="rx"&&v.type=="rect")break;case"cx":p.setAttribute(B,T),v.pattern&&Et(v),v._.dirty=1;break;case"height":if(p.setAttribute(B,T),v._.dirty=1,!S.fy)break;B="y",T=S.y;case"y":S.fy&&(T=-S.y-(S.height||0));case"ry":if(B=="ry"&&v.type=="rect")break;case"cy":p.setAttribute(B,T),v.pattern&&Et(v),v._.dirty=1;break;case"r":v.type=="rect"?W(p,{rx:T,ry:T}):p.setAttribute(B,T),v._.dirty=1;break;case"src":v.type=="image"&&p.setAttributeNS(dt,"href",T);break;case"stroke-width":v._.sx==1&&v._.sy==1||(T/=L(I(v._.sx),I(v._.sy))||1),p.setAttribute(B,T),S["stroke-dasharray"]&&ot(v,S["stroke-dasharray"],y),v._.arrows&&("startString"in v._.arrows&&ht(v,v._.arrows.startString),"endString"in v._.arrows&&ht(v,v._.arrows.endString,1));break;case"stroke-dasharray":ot(v,T,y);break;case"fill":var Bt=g(T).match(o._ISURL);if(Bt){mt=W("pattern");var Ct=W("image");mt.id=o.createUUID(),W(mt,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),W(Ct,{x:0,y:0,"xlink:href":Bt[1]}),mt.appendChild(Ct),function(It){o._preload(Bt[1],function(){var Jt=this.offsetWidth,Xt=this.offsetHeight;W(It,{width:Jt,height:Xt}),W(Ct,{width:Jt,height:Xt})})}(mt),v.paper.defs.appendChild(mt),W(p,{fill:"url(#"+mt.id+")"}),v.pattern=mt,v.pattern&&Et(v);break}var ct=o.getRGB(T);if(ct.error){if((v.type=="circle"||v.type=="ellipse"||g(T).charAt()!="r")&&et(v,T)){if("opacity"in S||"fill-opacity"in S){var Ht=o._g.doc.getElementById(p.getAttribute("fill").replace(/^url\(#|\)$/g,Z));if(Ht){var Ot=Ht.getElementsByTagName("stop");W(Ot[Ot.length-1],{"stop-opacity":("opacity"in S?S.opacity:1)*("fill-opacity"in S?S["fill-opacity"]:1)})}}S.gradient=T,S.fill="none";break}}else delete y.gradient,delete S.gradient,!o.is(S.opacity,"undefined")&&o.is(y.opacity,"undefined")&&W(p,{opacity:S.opacity}),!o.is(S["fill-opacity"],"undefined")&&o.is(y["fill-opacity"],"undefined")&&W(p,{"fill-opacity":S["fill-opacity"]});ct[h]("opacity")&&W(p,{"fill-opacity":ct.opacity>1?ct.opacity/100:ct.opacity});case"stroke":ct=o.getRGB(T),p.setAttribute(B,ct.hex),B=="stroke"&&ct[h]("opacity")&&W(p,{"stroke-opacity":ct.opacity>1?ct.opacity/100:ct.opacity}),B=="stroke"&&v._.arrows&&("startString"in v._.arrows&&ht(v,v._.arrows.startString),"endString"in v._.arrows&&ht(v,v._.arrows.endString,1));break;case"gradient":(v.type=="circle"||v.type=="ellipse"||g(T).charAt()!="r")&&et(v,T);break;case"opacity":S.gradient&&!S[h]("stroke-opacity")&&W(p,{"stroke-opacity":T>1?T/100:T});case"fill-opacity":if(S.gradient){(Ht=o._g.doc.getElementById(p.getAttribute("fill").replace(/^url\(#|\)$/g,Z)))&&(Ot=Ht.getElementsByTagName("stop"),W(Ot[Ot.length-1],{"stop-opacity":T}));break}default:B=="font-size"&&(T=E(T,10)+"px");var Ft=B.replace(/(\-.)/g,function(It){return It.substring(1).toUpperCase()});p.style[Ft]=T,v._.dirty=1,p.setAttribute(B,T)}}Dt(v,y),p.style.visibility=C},Dt=function(v,y){if(v.type=="text"&&(y[h]("text")||y[h]("font")||y[h]("font-size")||y[h]("x")||y[h]("y"))){var p=v.attrs,S=v.node,C=S.firstChild?E(o._g.doc.defaultView.getComputedStyle(S.firstChild,Z).getPropertyValue("font-size"),10):10;if(y[h]("text")){for(p.text=y.text;S.firstChild;)S.removeChild(S.firstChild);for(var B,T=g(y.text).split(`
`),$=[],M=0,j=T.length;M<j;M++)B=W("tspan"),M&&W(B,{dy:1.2*C,x:p.x}),B.appendChild(o._g.doc.createTextNode(T[M])),S.appendChild(B),$[M]=B}else for(M=0,j=($=S.getElementsByTagName("tspan")).length;M<j;M++)M?W($[M],{dy:1.2*C,x:p.x}):W($[0],{dy:0});W(S,{x:p.x,y:p.y}),v._.dirty=1;var J=v._getBBox(),st=p.y-(J.y+J.height/2);st&&o.is(st,"finite")&&W($[0],{dy:st})}},Tt=function(v){return v.parentNode&&v.parentNode.tagName.toLowerCase()==="a"?v.parentNode:v},Rt=function(v,y){this[0]=this.node=v,v.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),v.raphaelid=this.id,this.matrix=o.matrix(),this.realPath=null,this.paper=y,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!y.bottom&&(y.bottom=this),this.prev=y.top,y.top&&(y.top.next=this),y.top=this,this.next=null},gt=o.el;Rt.prototype=gt,gt.constructor=Rt,o._engine.path=function(v,y){var p=W("path");y.canvas&&y.canvas.appendChild(p);var S=new Rt(p,y);return S.type="path",rt(S,{fill:"none",stroke:"#000",path:v}),S},gt.rotate=function(v,y,p){if(this.removed)return this;if((v=g(v).split(q)).length-1&&(y=m(v[1]),p=m(v[2])),v=m(v[0]),p==null&&(y=p),y==null||p==null){var S=this.getBBox(1);y=S.x+S.width/2,p=S.y+S.height/2}return this.transform(this._.transform.concat([["r",v,y,p]])),this},gt.scale=function(v,y,p,S){if(this.removed)return this;if((v=g(v).split(q)).length-1&&(y=m(v[1]),p=m(v[2]),S=m(v[3])),v=m(v[0]),y==null&&(y=v),S==null&&(p=S),p==null||S==null)var C=this.getBBox(1);return p=p??C.x+C.width/2,S=S??C.y+C.height/2,this.transform(this._.transform.concat([["s",v,y,p,S]])),this},gt.translate=function(v,y){return this.removed?this:((v=g(v).split(q)).length-1&&(y=m(v[1])),v=m(v[0])||0,y=+y||0,this.transform(this._.transform.concat([["t",v,y]])),this)},gt.transform=function(v){var y=this._;if(v==null)return y.transform;if(o._extractTransform(this,v),this.clip&&W(this.clip,{transform:this.matrix.invert()}),this.pattern&&Et(this),this.node&&W(this.node,{transform:this.matrix}),y.sx!=1||y.sy!=1){var p=this.attrs[h]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":p})}return this},gt.hide=function(){return this.removed||(this.node.style.display="none"),this},gt.show=function(){return this.removed||(this.node.style.display=""),this},gt.remove=function(){var v=Tt(this.node);if(!this.removed&&v.parentNode){var y=this.paper;for(var p in y.__set__&&y.__set__.exclude(this),it.unbind("raphael.*.*."+this.id),this.gradient&&y.defs.removeChild(this.gradient),o._tear(this,y),v.parentNode.removeChild(v),this.removeData(),this)this[p]=typeof this[p]=="function"?o._removedFactory(p):null;this.removed=!0}},gt._getBBox=function(){if(this.node.style.display=="none"){this.show();var v=!0}var y,p=!1;this.paper.canvas.parentElement?y=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(y=this.paper.canvas.parentNode.style),y&&y.display=="none"&&(p=!0,y.display="");var S={};try{S=this.node.getBBox()}catch{S={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{S=S||{},p&&(y.display="none")}return v&&this.hide(),S},gt.attr=function(v,y){if(this.removed)return this;if(v==null){var p={};for(var S in this.attrs)this.attrs[h](S)&&(p[S]=this.attrs[S]);return p.gradient&&p.fill=="none"&&(p.fill=p.gradient)&&delete p.gradient,p.transform=this._.transform,p}if(y==null&&o.is(v,"string")){if(v=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;if(v=="transform")return this._.transform;for(var C=v.split(q),B={},T=0,$=C.length;T<$;T++)(v=C[T])in this.attrs?B[v]=this.attrs[v]:o.is(this.paper.customAttributes[v],"function")?B[v]=this.paper.customAttributes[v].def:B[v]=o._availableAttrs[v];return $-1?B:B[C[0]]}if(y==null&&o.is(v,"array")){for(B={},T=0,$=v.length;T<$;T++)B[v[T]]=this.attr(v[T]);return B}if(y!=null){var M={};M[v]=y}else v!=null&&o.is(v,"object")&&(M=v);for(var j in M)it("raphael.attr."+j+"."+this.id,this,M[j]);for(j in this.paper.customAttributes)if(this.paper.customAttributes[h](j)&&M[h](j)&&o.is(this.paper.customAttributes[j],"function")){var J=this.paper.customAttributes[j].apply(this,[].concat(M[j]));for(var st in this.attrs[j]=M[j],J)J[h](st)&&(M[st]=J[st])}return rt(this,M),this},gt.toFront=function(){if(this.removed)return this;var v=Tt(this.node);v.parentNode.appendChild(v);var y=this.paper;return y.top!=this&&o._tofront(this,y),this},gt.toBack=function(){if(this.removed)return this;var v=Tt(this.node),y=v.parentNode;return y.insertBefore(v,y.firstChild),o._toback(this,this.paper),this.paper,this},gt.insertAfter=function(v){if(this.removed||!v)return this;var y=Tt(this.node),p=Tt(v.node||v[v.length-1].node);return p.nextSibling?p.parentNode.insertBefore(y,p.nextSibling):p.parentNode.appendChild(y),o._insertafter(this,v,this.paper),this},gt.insertBefore=function(v){if(this.removed||!v)return this;var y=Tt(this.node),p=Tt(v.node||v[0].node);return p.parentNode.insertBefore(y,p),o._insertbefore(this,v,this.paper),this},gt.blur=function(v){var y=this;if(+v!=0){var p=W("filter"),S=W("feGaussianBlur");y.attrs.blur=v,p.id=o.createUUID(),W(S,{stdDeviation:+v||1.5}),p.appendChild(S),y.paper.defs.appendChild(p),y._blur=p,W(y.node,{filter:"url(#"+p.id+")"})}else y._blur&&(y._blur.parentNode.removeChild(y._blur),delete y._blur,delete y.attrs.blur),y.node.removeAttribute("filter");return y},o._engine.circle=function(v,y,p,S){var C=W("circle");v.canvas&&v.canvas.appendChild(C);var B=new Rt(C,v);return B.attrs={cx:y,cy:p,r:S,fill:"none",stroke:"#000"},B.type="circle",W(C,B.attrs),B},o._engine.rect=function(v,y,p,S,C,B){var T=W("rect");v.canvas&&v.canvas.appendChild(T);var $=new Rt(T,v);return $.attrs={x:y,y:p,width:S,height:C,rx:B||0,ry:B||0,fill:"none",stroke:"#000"},$.type="rect",W(T,$.attrs),$},o._engine.ellipse=function(v,y,p,S,C){var B=W("ellipse");v.canvas&&v.canvas.appendChild(B);var T=new Rt(B,v);return T.attrs={cx:y,cy:p,rx:S,ry:C,fill:"none",stroke:"#000"},T.type="ellipse",W(B,T.attrs),T},o._engine.image=function(v,y,p,S,C,B){var T=W("image");W(T,{x:p,y:S,width:C,height:B,preserveAspectRatio:"none"}),T.setAttributeNS(dt,"href",y),v.canvas&&v.canvas.appendChild(T);var $=new Rt(T,v);return $.attrs={x:p,y:S,width:C,height:B,src:y},$.type="image",$},o._engine.text=function(v,y,p,S){var C=W("text");v.canvas&&v.canvas.appendChild(C);var B=new Rt(C,v);return B.attrs={x:y,y:p,"text-anchor":"middle",text:S,"font-family":o._availableAttrs["font-family"],"font-size":o._availableAttrs["font-size"],stroke:"none",fill:"#000"},B.type="text",rt(B,B.attrs),B},o._engine.setSize=function(v,y){return this.width=v||this.width,this.height=y||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},o._engine.create=function(){var v=o._getContainer.apply(0,arguments),y=v&&v.container;if(!y)throw new Error("SVG container not found.");var p,S=v.x,C=v.y,B=v.width,T=v.height,$=W("svg"),M="overflow:hidden;";return S=S||0,C=C||0,W($,{height:T=T||342,version:1.1,width:B=B||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),y==1?($.style.cssText=M+"position:absolute;left:"+S+"px;top:"+C+"px",o._g.doc.body.appendChild($),p=1):($.style.cssText=M+"position:relative",y.firstChild?y.insertBefore($,y.firstChild):y.appendChild($)),(y=new o._Paper).width=B,y.height=T,y.canvas=$,y.clear(),y._left=y._top=0,p&&(y.renderfix=function(){}),y.renderfix(),y},o._engine.setViewBox=function(v,y,p,S,C){it("raphael.setViewBox",this,this._viewBox,[v,y,p,S,C]);var B,T,$=this.getSize(),M=L(p/$.width,S/$.height),j=this.top,J=C?"xMidYMid meet":"xMinYMin";for(v==null?(this._vbSize&&(M=1),delete this._vbSize,B="0 0 "+this.width+H+this.height):(this._vbSize=M,B=v+H+y+H+p+H+S),W(this.canvas,{viewBox:B,preserveAspectRatio:J});M&&j;)T="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":T}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[v,y,p,S,!!C],this},o.prototype.renderfix=function(){var v,y=this.canvas,p=y.style;try{v=y.getScreenCTM()||y.createSVGMatrix()}catch{v=y.createSVGMatrix()}var S=-v.e%1,C=-v.f%1;(S||C)&&(S&&(this._left=(this._left+S)%1,p.left=this._left+"px"),C&&(this._top=(this._top+C)%1,p.top=this._top+"px"))},o.prototype.clear=function(){o.eve("raphael.clear",this);for(var v=this.canvas;v.firstChild;)v.removeChild(v.firstChild);this.bottom=this.top=null,(this.desc=W("desc")).appendChild(o._g.doc.createTextNode("Created with Raphal "+o.version)),v.appendChild(this.desc),v.appendChild(this.defs=W("defs"))},o.prototype.remove=function(){for(var v in it("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[v]=typeof this[v]=="function"?o._removedFactory(v):null};var bt=o.st;for(var ge in gt)gt[h](ge)&&!bt[h](ge)&&(bt[ge]=function(v){return function(){var y=arguments;return this.forEach(function(p){p[v].apply(p,y)})}}(ge))}}.apply(s,l))===void 0||(e.exports=c)},function(e,s,n){var l,c;l=[n(0)],(c=function(o){if(!o||o.vml){var h="hasOwnProperty",g=String,m=parseFloat,E=Math,D=E.round,L=E.max,I=E.min,O=E.abs,q=/[, ]+/,it=o.eve,Z=" ",H="",dt={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},nt=/([clmz]),?([^clmz]*)/gi,ut=/ progid:\S+Blur\([^\)]+\)/g,W=/-?[^,\s-]+/g,et="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",at=21600,Et={path:1,rect:1,image:1},ht={circle:1,ellipse:1},Q=function(y,p,S){var C=o.matrix();return C.rotate(-y,.5,.5),{dx:C.x(p,S),dy:C.y(p,S)}},ot=function(y,p,S,C,B,T){var $=y._,M=y.matrix,j=$.fillpos,J=y.node,st=J.style,mt=1,xt="",yt=at/p,Lt=at/S;if(st.visibility="hidden",p&&S){if(J.coordsize=O(yt)+Z+O(Lt),st.rotation=T*(p*S<0?-1:1),T){var Bt=Q(T,C,B);C=Bt.dx,B=Bt.dy}if(p<0&&(xt+="x"),S<0&&(xt+=" y")&&(mt=-1),st.flip=xt,J.coordorigin=C*-yt+Z+B*-Lt,j||$.fillsize){var Ct=J.getElementsByTagName("fill");Ct=Ct&&Ct[0],J.removeChild(Ct),j&&(Bt=Q(T,M.x(j[0],j[1]),M.y(j[0],j[1])),Ct.position=Bt.dx*mt+Z+Bt.dy*mt),$.fillsize&&(Ct.size=$.fillsize[0]*O(p)+Z+$.fillsize[1]*O(S)),J.appendChild(Ct)}st.visibility="visible"}};o.toString=function(){return`Your browser doesnt support SVG. Falling down to VML.
You are running Raphal `+this.version};var rt,Dt=function(y,p,S){for(var C=g(p).toLowerCase().split("-"),B=S?"end":"start",T=C.length,$="classic",M="medium",j="medium";T--;)switch(C[T]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":$=C[T];break;case"wide":case"narrow":j=C[T];break;case"long":case"short":M=C[T]}var J=y.node.getElementsByTagName("stroke")[0];J[B+"arrow"]=$,J[B+"arrowlength"]=M,J[B+"arrowwidth"]=j},Tt=function(y,p){y.attrs=y.attrs||{};var S=y.node,C=y.attrs,B=S.style,T=Et[y.type]&&(p.x!=C.x||p.y!=C.y||p.width!=C.width||p.height!=C.height||p.cx!=C.cx||p.cy!=C.cy||p.rx!=C.rx||p.ry!=C.ry||p.r!=C.r),$=ht[y.type]&&(C.cx!=p.cx||C.cy!=p.cy||C.r!=p.r||C.rx!=p.rx||C.ry!=p.ry),M=y;for(var j in p)p[h](j)&&(C[j]=p[j]);if(T&&(C.path=o._getPath[y.type](y),y._.dirty=1),p.href&&(S.href=p.href),p.title&&(S.title=p.title),p.target&&(S.target=p.target),p.cursor&&(B.cursor=p.cursor),"blur"in p&&y.blur(p.blur),(p.path&&y.type=="path"||T)&&(S.path=function(Yt){var _e=/[ahqstv]/gi,Ke=o._pathToAbsolute;if(g(Yt).match(_e)&&(Ke=o._path2curve),_e=/[clmz]/g,Ke==o._pathToAbsolute&&!g(Yt).match(_e)){var re=g(Yt).replace(nt,function(Oi,Ze,Qe){var Ce=[],Zs=Ze.toLowerCase()=="m",Ae=dt[Ze];return Qe.replace(W,function(Qs){Zs&&Ce.length==2&&(Ae+=Ce+dt[Ze=="m"?"l":"L"],Ce=[]),Ce.push(D(Qs*at))}),Ae+Ce});return re}var qe,oe,Cs=Ke(Yt);re=[];for(var Je=0,Ds=Cs.length;Je<Ds;Je++){qe=Cs[Je],(oe=Cs[Je][0].toLowerCase())=="z"&&(oe="x");for(var Ee=1,jt=qe.length;Ee<jt;Ee++)oe+=D(qe[Ee]*at)+(Ee!=jt-1?",":H);re.push(oe)}return re.join(Z)}(~g(C.path).toLowerCase().indexOf("r")?o._pathToAbsolute(C.path):C.path),y._.dirty=1,y.type=="image"&&(y._.fillpos=[C.x,C.y],y._.fillsize=[C.width,C.height],ot(y,1,1,0,0,0))),"transform"in p&&y.transform(p.transform),$){var J=+C.cx,st=+C.cy,mt=+C.rx||+C.r||0,xt=+C.ry||+C.r||0;S.path=o.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",D((J-mt)*at),D((st-xt)*at),D((J+mt)*at),D((st+xt)*at),D(J*at)),y._.dirty=1}if("clip-rect"in p){var yt=g(p["clip-rect"]).split(q);if(yt.length==4){yt[2]=+yt[2]+ +yt[0],yt[3]=+yt[3]+ +yt[1];var Lt=S.clipRect||o._g.doc.createElement("div"),Bt=Lt.style;Bt.clip=o.format("rect({1}px {2}px {3}px {0}px)",yt),S.clipRect||(Bt.position="absolute",Bt.top=0,Bt.left=0,Bt.width=y.paper.width+"px",Bt.height=y.paper.height+"px",S.parentNode.insertBefore(Lt,S),Lt.appendChild(S),S.clipRect=Lt)}p["clip-rect"]||S.clipRect&&(S.clipRect.style.clip="auto")}if(y.textpath){var Ct=y.textpath.style;p.font&&(Ct.font=p.font),p["font-family"]&&(Ct.fontFamily='"'+p["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,H)+'"'),p["font-size"]&&(Ct.fontSize=p["font-size"]),p["font-weight"]&&(Ct.fontWeight=p["font-weight"]),p["font-style"]&&(Ct.fontStyle=p["font-style"])}if("arrow-start"in p&&Dt(M,p["arrow-start"]),"arrow-end"in p&&Dt(M,p["arrow-end"],1),p.opacity!=null||p.fill!=null||p.src!=null||p.stroke!=null||p["stroke-width"]!=null||p["stroke-opacity"]!=null||p["fill-opacity"]!=null||p["stroke-dasharray"]!=null||p["stroke-miterlimit"]!=null||p["stroke-linejoin"]!=null||p["stroke-linecap"]!=null){var ct=S.getElementsByTagName("fill");if(!(ct=ct&&ct[0])&&(ct=rt("fill")),y.type=="image"&&p.src&&(ct.src=p.src),p.fill&&(ct.on=!0),ct.on!=null&&p.fill!="none"&&p.fill!==null||(ct.on=!1),ct.on&&p.fill){var Ht=g(p.fill).match(o._ISURL);if(Ht){ct.parentNode==S&&S.removeChild(ct),ct.rotate=!0,ct.src=Ht[1],ct.type="tile";var Ot=y.getBBox(1);ct.position=Ot.x+Z+Ot.y,y._.fillpos=[Ot.x,Ot.y],o._preload(Ht[1],function(){y._.fillsize=[this.offsetWidth,this.offsetHeight]})}else ct.color=o.getRGB(p.fill).hex,ct.src=H,ct.type="solid",o.getRGB(p.fill).error&&(M.type in{circle:1,ellipse:1}||g(p.fill).charAt()!="r")&&Rt(M,p.fill,ct)&&(C.fill="none",C.gradient=p.fill,ct.rotate=!1)}if("fill-opacity"in p||"opacity"in p){var Ft=((+C["fill-opacity"]+1||2)-1)*((+C.opacity+1||2)-1)*((+o.getRGB(p.fill).o+1||2)-1);Ft=I(L(Ft,0),1),ct.opacity=Ft,ct.src&&(ct.color="none")}S.appendChild(ct);var It=S.getElementsByTagName("stroke")&&S.getElementsByTagName("stroke")[0],Jt=!1;!It&&(Jt=It=rt("stroke")),(p.stroke&&p.stroke!="none"||p["stroke-width"]||p["stroke-opacity"]!=null||p["stroke-dasharray"]||p["stroke-miterlimit"]||p["stroke-linejoin"]||p["stroke-linecap"])&&(It.on=!0),(p.stroke=="none"||p.stroke===null||It.on==null||p.stroke==0||p["stroke-width"]==0)&&(It.on=!1);var Xt=o.getRGB(p.stroke);It.on&&p.stroke&&(It.color=Xt.hex),Ft=((+C["stroke-opacity"]+1||2)-1)*((+C.opacity+1||2)-1)*((+Xt.o+1||2)-1);var Se=.75*(m(p["stroke-width"])||1);if(Ft=I(L(Ft,0),1),p["stroke-width"]==null&&(Se=C["stroke-width"]),p["stroke-width"]&&(It.weight=Se),Se&&Se<1&&(Ft*=Se)&&(It.weight=1),It.opacity=Ft,p["stroke-linejoin"]&&(It.joinstyle=p["stroke-linejoin"]||"miter"),It.miterlimit=p["stroke-miterlimit"]||8,p["stroke-linecap"]&&(It.endcap=p["stroke-linecap"]=="butt"?"flat":p["stroke-linecap"]=="square"?"square":"round"),"stroke-dasharray"in p){var _s={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};It.dashstyle=_s[h](p["stroke-dasharray"])?_s[p["stroke-dasharray"]]:H}Jt&&S.appendChild(It)}if(M.type=="text"){M.paper.canvas.style.display=H;var ke=M.paper.span,Xe=C.font&&C.font.match(/\d+(?:\.\d*)?(?=px)/);B=ke.style,C.font&&(B.font=C.font),C["font-family"]&&(B.fontFamily=C["font-family"]),C["font-weight"]&&(B.fontWeight=C["font-weight"]),C["font-style"]&&(B.fontStyle=C["font-style"]),Xe=m(C["font-size"]||Xe&&Xe[0])||10,B.fontSize=100*Xe+"px",M.textpath.string&&(ke.innerHTML=g(M.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var We=ke.getBoundingClientRect();M.W=C.w=(We.right-We.left)/100,M.H=C.h=(We.bottom-We.top)/100,M.X=C.x,M.Y=C.y+M.H/2,("x"in p||"y"in p)&&(M.path.v=o.format("m{0},{1}l{2},{1}",D(C.x*at),D(C.y*at),D(C.x*at)+1));for(var Es=["x","y","text","font","font-family","font-weight","font-style","font-size"],je=0,Js=Es.length;je<Js;je++)if(Es[je]in p){M._.dirty=1;break}switch(C["text-anchor"]){case"start":M.textpath.style["v-text-align"]="left",M.bbx=M.W/2;break;case"end":M.textpath.style["v-text-align"]="right",M.bbx=-M.W/2;break;default:M.textpath.style["v-text-align"]="center",M.bbx=0}M.textpath.style["v-text-kern"]=!0}},Rt=function(y,p,S){y.attrs=y.attrs||{},y.attrs;var C=Math.pow,B="linear",T=".5 .5";if(y.attrs.gradient=p,p=(p=g(p).replace(o._radial_gradient,function(mt,xt,yt){return B="radial",xt&&yt&&(xt=m(xt),yt=m(yt),C(xt-.5,2)+C(yt-.5,2)>.25&&(yt=E.sqrt(.25-C(xt-.5,2))*(2*(yt>.5)-1)+.5),T=xt+Z+yt),H})).split(/\s*\-\s*/),B=="linear"){var $=p.shift();if($=-m($),isNaN($))return null}var M=o._parseDots(p);if(!M)return null;if(y=y.shape||y.node,M.length){y.removeChild(S),S.on=!0,S.method="none",S.color=M[0].color,S.color2=M[M.length-1].color;for(var j=[],J=0,st=M.length;J<st;J++)M[J].offset&&j.push(M[J].offset+Z+M[J].color);S.colors=j.length?j.join():"0% "+S.color,B=="radial"?(S.type="gradientTitle",S.focus="100%",S.focussize="0 0",S.focusposition=T,S.angle=0):(S.type="gradient",S.angle=(270-$)%360),y.appendChild(S)}return 1},gt=function(y,p){this[0]=this.node=y,y.raphael=!0,this.id=o._oid++,y.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=p,this.matrix=o.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!p.bottom&&(p.bottom=this),this.prev=p.top,p.top&&(p.top.next=this),p.top=this,this.next=null},bt=o.el;gt.prototype=bt,bt.constructor=gt,bt.transform=function(y){if(y==null)return this._.transform;var p,S=this.paper._viewBoxShift,C=S?"s"+[S.scale,S.scale]+"-1-1t"+[S.dx,S.dy]:H;S&&(p=y=g(y).replace(/\.{3}|\u2026/g,this._.transform||H)),o._extractTransform(this,C+y);var B,T=this.matrix.clone(),$=this.skew,M=this.node,j=~g(this.attrs.fill).indexOf("-"),J=!g(this.attrs.fill).indexOf("url(");if(T.translate(1,1),J||j||this.type=="image")if($.matrix="1 0 0 1",$.offset="0 0",B=T.split(),j&&B.noRotation||!B.isSimple){M.style.filter=T.toFilter();var st=this.getBBox(),mt=this.getBBox(1),xt=st.x-mt.x,yt=st.y-mt.y;M.coordorigin=xt*-at+Z+yt*-at,ot(this,1,1,xt,yt,0)}else M.style.filter=H,ot(this,B.scalex,B.scaley,B.dx,B.dy,B.rotate);else M.style.filter=H,$.matrix=g(T),$.offset=T.offset();return p!==null&&(this._.transform=p,o._extractTransform(this,p)),this},bt.rotate=function(y,p,S){if(this.removed)return this;if(y!=null){if((y=g(y).split(q)).length-1&&(p=m(y[1]),S=m(y[2])),y=m(y[0]),S==null&&(p=S),p==null||S==null){var C=this.getBBox(1);p=C.x+C.width/2,S=C.y+C.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",y,p,S]])),this}},bt.translate=function(y,p){return this.removed?this:((y=g(y).split(q)).length-1&&(p=m(y[1])),y=m(y[0])||0,p=+p||0,this._.bbox&&(this._.bbox.x+=y,this._.bbox.y+=p),this.transform(this._.transform.concat([["t",y,p]])),this)},bt.scale=function(y,p,S,C){if(this.removed)return this;if((y=g(y).split(q)).length-1&&(p=m(y[1]),S=m(y[2]),C=m(y[3]),isNaN(S)&&(S=null),isNaN(C)&&(C=null)),y=m(y[0]),p==null&&(p=y),C==null&&(S=C),S==null||C==null)var B=this.getBBox(1);return S=S??B.x+B.width/2,C=C??B.y+B.height/2,this.transform(this._.transform.concat([["s",y,p,S,C]])),this._.dirtyT=1,this},bt.hide=function(){return!this.removed&&(this.node.style.display="none"),this},bt.show=function(){return!this.removed&&(this.node.style.display=H),this},bt.auxGetBBox=o.el.getBBox,bt.getBBox=function(){var y=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var p={},S=1/this.paper._viewBoxShift.scale;return p.x=y.x-this.paper._viewBoxShift.dx,p.x*=S,p.y=y.y-this.paper._viewBoxShift.dy,p.y*=S,p.width=y.width*S,p.height=y.height*S,p.x2=p.x+p.width,p.y2=p.y+p.height,p}return y},bt._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},bt.remove=function(){if(!this.removed&&this.node.parentNode){for(var y in this.paper.__set__&&this.paper.__set__.exclude(this),o.eve.unbind("raphael.*.*."+this.id),o._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[y]=typeof this[y]=="function"?o._removedFactory(y):null;this.removed=!0}},bt.attr=function(y,p){if(this.removed)return this;if(y==null){var S={};for(var C in this.attrs)this.attrs[h](C)&&(S[C]=this.attrs[C]);return S.gradient&&S.fill=="none"&&(S.fill=S.gradient)&&delete S.gradient,S.transform=this._.transform,S}if(p==null&&o.is(y,"string")){if(y=="fill"&&this.attrs.fill=="none"&&this.attrs.gradient)return this.attrs.gradient;for(var B=y.split(q),T={},$=0,M=B.length;$<M;$++)(y=B[$])in this.attrs?T[y]=this.attrs[y]:o.is(this.paper.customAttributes[y],"function")?T[y]=this.paper.customAttributes[y].def:T[y]=o._availableAttrs[y];return M-1?T:T[B[0]]}if(this.attrs&&p==null&&o.is(y,"array")){for(T={},$=0,M=y.length;$<M;$++)T[y[$]]=this.attr(y[$]);return T}var j;for(var J in p!=null&&((j={})[y]=p),p==null&&o.is(y,"object")&&(j=y),j)it("raphael.attr."+J+"."+this.id,this,j[J]);if(j){for(J in this.paper.customAttributes)if(this.paper.customAttributes[h](J)&&j[h](J)&&o.is(this.paper.customAttributes[J],"function")){var st=this.paper.customAttributes[J].apply(this,[].concat(j[J]));for(var mt in this.attrs[J]=j[J],st)st[h](mt)&&(j[mt]=st[mt])}j.text&&this.type=="text"&&(this.textpath.string=j.text),Tt(this,j)}return this},bt.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&o._tofront(this,this.paper),this},bt.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),o._toback(this,this.paper)),this)},bt.insertAfter=function(y){return this.removed?this:(y.constructor==o.st.constructor&&(y=y[y.length-1]),y.node.nextSibling?y.node.parentNode.insertBefore(this.node,y.node.nextSibling):y.node.parentNode.appendChild(this.node),o._insertafter(this,y,this.paper),this)},bt.insertBefore=function(y){return this.removed?this:(y.constructor==o.st.constructor&&(y=y[0]),y.node.parentNode.insertBefore(this.node,y.node),o._insertbefore(this,y,this.paper),this)},bt.blur=function(y){var p=this.node.runtimeStyle,S=p.filter;return S=S.replace(ut,H),+y!=0?(this.attrs.blur=y,p.filter=S+Z+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+y||1.5)+")",p.margin=o.format("-{0}px 0 0 -{0}px",D(+y||1.5))):(p.filter=S,p.margin=0,delete this.attrs.blur),this},o._engine.path=function(y,p){var S=rt("shape");S.style.cssText=et,S.coordsize=at+Z+at,S.coordorigin=p.coordorigin;var C=new gt(S,p),B={fill:"none",stroke:"#000"};y&&(B.path=y),C.type="path",C.path=[],C.Path=H,Tt(C,B),p.canvas&&p.canvas.appendChild(S);var T=rt("skew");return T.on=!0,S.appendChild(T),C.skew=T,C.transform(H),C},o._engine.rect=function(y,p,S,C,B,T){var $=o._rectPath(p,S,C,B,T),M=y.path($),j=M.attrs;return M.X=j.x=p,M.Y=j.y=S,M.W=j.width=C,M.H=j.height=B,j.r=T,j.path=$,M.type="rect",M},o._engine.ellipse=function(y,p,S,C,B){var T=y.path();return T.attrs,T.X=p-C,T.Y=S-B,T.W=2*C,T.H=2*B,T.type="ellipse",Tt(T,{cx:p,cy:S,rx:C,ry:B}),T},o._engine.circle=function(y,p,S,C){var B=y.path();return B.attrs,B.X=p-C,B.Y=S-C,B.W=B.H=2*C,B.type="circle",Tt(B,{cx:p,cy:S,r:C}),B},o._engine.image=function(y,p,S,C,B,T){var $=o._rectPath(S,C,B,T),M=y.path($).attr({stroke:"none"}),j=M.attrs,J=M.node,st=J.getElementsByTagName("fill")[0];return j.src=p,M.X=j.x=S,M.Y=j.y=C,M.W=j.width=B,M.H=j.height=T,j.path=$,M.type="image",st.parentNode==J&&J.removeChild(st),st.rotate=!0,st.src=p,st.type="tile",M._.fillpos=[S,C],M._.fillsize=[B,T],J.appendChild(st),ot(M,1,1,0,0,0),M},o._engine.text=function(y,p,S,C){var B=rt("shape"),T=rt("path"),$=rt("textpath");p=p||0,S=S||0,C=C||"",T.v=o.format("m{0},{1}l{2},{1}",D(p*at),D(S*at),D(p*at)+1),T.textpathok=!0,$.string=g(C),$.on=!0,B.style.cssText=et,B.coordsize=at+Z+at,B.coordorigin="0 0";var M=new gt(B,y),j={fill:"#000",stroke:"none",font:o._availableAttrs.font,text:C};M.shape=B,M.path=T,M.textpath=$,M.type="text",M.attrs.text=g(C),M.attrs.x=p,M.attrs.y=S,M.attrs.w=1,M.attrs.h=1,Tt(M,j),B.appendChild($),B.appendChild(T),y.canvas.appendChild(B);var J=rt("skew");return J.on=!0,B.appendChild(J),M.skew=J,M.transform(H),M},o._engine.setSize=function(y,p){var S=this.canvas.style;return this.width=y,this.height=p,y==+y&&(y+="px"),p==+p&&(p+="px"),S.width=y,S.height=p,S.clip="rect(0 "+y+" "+p+" 0)",this._viewBox&&o._engine.setViewBox.apply(this,this._viewBox),this},o._engine.setViewBox=function(y,p,S,C,B){o.eve("raphael.setViewBox",this,this._viewBox,[y,p,S,C,B]);var T,$,M=this.getSize(),j=M.width,J=M.height;return B&&(S*(T=J/C)<j&&(y-=(j-S*T)/2/T),C*($=j/S)<J&&(p-=(J-C*$)/2/$)),this._viewBox=[y,p,S,C,!!B],this._viewBoxShift={dx:-y,dy:-p,scale:M},this.forEach(function(st){st.transform("...")}),this},o._engine.initWin=function(y){var p=y.document;p.styleSheets.length<31?p.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):p.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!p.namespaces.rvml&&p.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),rt=function(S){return p.createElement("<rvml:"+S+' class="rvml">')}}catch{rt=function(C){return p.createElement("<"+C+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},o._engine.initWin(o._g.win),o._engine.create=function(){var y=o._getContainer.apply(0,arguments),p=y.container,S=y.height,C=y.width,B=y.x,T=y.y;if(!p)throw new Error("VML container not found.");var $=new o._Paper,M=$.canvas=o._g.doc.createElement("div"),j=M.style;return B=B||0,T=T||0,C=C||512,S=S||342,$.width=C,$.height=S,C==+C&&(C+="px"),S==+S&&(S+="px"),$.coordsize=216e5+Z+216e5,$.coordorigin="0 0",$.span=o._g.doc.createElement("span"),$.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",M.appendChild($.span),j.cssText=o.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",C,S),p==1?(o._g.doc.body.appendChild(M),j.left=B+"px",j.top=T+"px",j.position="absolute"):p.firstChild?p.insertBefore(M,p.firstChild):p.appendChild(M),$.renderfix=function(){},$},o.prototype.clear=function(){o.eve("raphael.clear",this),this.canvas.innerHTML=H,this.span=o._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},o.prototype.remove=function(){for(var y in o.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[y]=typeof this[y]=="function"?o._removedFactory(y):null;return!0};var ge=o.st;for(var v in bt)bt[h](v)&&!ge[h](v)&&(ge[v]=function(y){return function(){var p=arguments;return this.forEach(function(S){S[y].apply(S,p)})}}(v))}}.apply(s,l))===void 0||(e.exports=c)}])})})(jo);var Gh=jo.exports;const Ko=Wo(Gh);var Wt=(r=>(r[r.root=0]="root",r[r.firstLevel=1]="firstLevel",r[r.grandchild=2]="grandchild",r))(Wt||{});function Ys(r){return r===0?0:r===1?1:2}function ci(){function r(){return((1+Math.random())*65536|0).toString(16).substring(1)}return`${r()}${r()}-${r()}${r()}${r()}`}const Xh=function(){let r=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(r=!0)}(navigator.userAgent||navigator.vendor||window.opera),r},Pt=Xh(),Wh=()=>navigator.platform.indexOf("Win")>-1,qo="mindmap-graph";class jh{constructor(t){_(this,"containerDom");_(this,"wrapperDom");_(this,"svgDom");_(this,"paper");const e=this.initGraphElement(t);this.containerDom=e.containerDom,this.wrapperDom=e.wrapperDom;const{clientWidth:s,clientHeight:n}=this.wrapperDom;this.paper=new Ko(this.wrapperDom,s,n),this.svgDom=document.querySelector("svg")||null}getPaper(){return this.paper}getWrapperDom(){return this.wrapperDom}getContainerDom(){return this.containerDom}getSvgDom(){return this.svgDom}getSize(){return{width:this.wrapperDom.clientWidth,height:this.wrapperDom.clientHeight}}clear(){this.paper.clear(),this.wrapperDom.remove()}initGraphElement(t){const e=typeof t=="string"?document.querySelector(t):t;if(!e)throw new Error("container is not exist");if(e.clientWidth===0||e.clientHeight===0)throw new Error("The width or height of Container is not more than 0");const s=document.createElement("div");s.className="mindmap-graph-background";const n=document.createElement("div");return n.className=`${qo}${Pt?" mobile":""}`,e.appendChild(n),e.appendChild(s),{containerDom:e,wrapperDom:n}}}var _t=(r=>(r[r.LEFT=-1]="LEFT",r[r.NONE=0]="NONE",r[r.RIGHT=1]="RIGHT",r))(_t||{});const Kh=40,qh=25,Jh=24,Zh=15;function Ri(r){return Ys(r)===Wt.firstLevel?qh:Zh}function Jo(r){return Ys(r)===Wt.firstLevel?Kh:Jh}class Qh{constructor(){_(this,"areaHeightMap",{})}getAreaHeight(t,e){const s=t.getBBox().height;if(!t.isExpand)return s;const n=`${t.id}_${e}`;if(this.areaHeightMap[n])return this.areaHeightMap[n];let l=0;const c=t.getDirectionChildren(e);return c.length===0?l=s:(l=this.getChildrenAreaHeight(c,e),l=Math.max(l,s)),this.areaHeightMap[t.id]=l,l}getChildrenAreaHeight(t,e){if(t.length===0)return 0;const s=t.reduce((l,c)=>{const o=this.getAreaHeight(c,e);return l+o},0),n=Ri(t[0].depth+1);return s+(t.length-1)*n}}class tc{constructor(t){_(this,"root");this.root=t===void 0?null:t}init(t){this.root=t}reset(t){if(!this.root)throw new Error("Position is called without root.");const e=new Qh;t===_t.LEFT||t===_t.RIGHT?this.resetInner({node:this.root,direction:t,areaHeightHandler:e}):(this.resetInner({node:this.root,direction:_t.LEFT,areaHeightHandler:e}),this.resetInner({node:this.root,direction:_t.RIGHT,areaHeightHandler:e}))}resetInner({node:t,direction:e,areaHeightHandler:s}){if(!t.isExpand)return;const n=t.depth+1,l=Ri(n),c=t.getDirectionChildren(e),o=t.getBBox(),h=s.getChildrenAreaHeight(c,e);let g=o.cy-h/2;c.forEach(m=>{const E=s.getAreaHeight(m,e),D=m.getBBox(),L=Jo(n),I=e===_t.RIGHT?o.x2+L:o.x-L-D.width,O=g+E/2-D.height/2;m.translateTo(I,O),this.resetInner({node:m,direction:e,areaHeightHandler:s}),g+=E+l})}}class ec{constructor({root:t,position:e,createNode:s}){_(this,"root");_(this,"position");_(this,"createNode");this.root=t,this.position=e,this.createNode=s}render(t){t&&(this.renderWithRelativeNode({nodeDataMap:t,sourceId:this.root.id,relativeNode:this.root,depth:0}),this.position.reset())}renderWithRelativeNode({nodeDataMap:t,sourceId:e,relativeNode:s,depth:n}){const l=s,c=t[e];c.label!==l.label&&l.setLabel(c.label),c.isExpand!==l.isExpand&&l.changeExpand(c.isExpand),c.direction!==l.direction&&l.changeDirection(c.direction);const o=l.children;return l.clearChild(),c.children.forEach(h=>{if(!t[h])return;const m=o.findIndex(L=>L.id===h);let E=null;m>-1&&(E=o.splice(m,1)[0]);const D=E!==null?this.renderWithRelativeNode({nodeDataMap:t,sourceId:h,relativeNode:E,depth:n+1}):this.renderNew({nodeDataMap:t,sourceId:h,depth:n+1,father:l});l.pushChild(D)}),o.forEach(h=>{h.remove()}),l}renderNew({nodeDataMap:t,sourceId:e,depth:s,father:n}){const l=t[e],c=this.createNode({id:e,depth:s,label:l.label,direction:l.direction,father:n,isExpand:l.isExpand,imageData:l.imageData,link:l.link});return l.children.forEach(o=>{if(!t[o])return;const g=this.renderNew({nodeDataMap:t,sourceId:o,depth:s+1,father:c});c.pushChild(g)}),c}}class sc{constructor({data:t,viewport:e,nodeCreator:s}){_(this,"root");_(this,"position");_(this,"treeRenderer");_(this,"nodeCreator");this.nodeCreator=s,this.root=this.createRoot(t,e),this.position=new tc(this.root),this.treeRenderer=new ec({root:this.root,position:this.position,createNode:s.createNode}),this.render(t)}getRoot(){return this.root}clear(){this.root.remove()}render(t){this.treeRenderer.render(t)}createRoot(t={},e){let s=Object.keys(t).find(E=>t[E].isRoot===!0);const n=t[s],l=this.nodeCreator.createNode({id:s,depth:0,label:n.label,direction:n.direction}),{width:c,height:o}=e.getViewbox(),h=l.getBBox(),g=(c-h.width)/2,m=(o-h.height)/2;return l.translateTo(g,m),l}}var Zo={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function n(h,g,m){this.fn=h,this.context=g,this.once=m||!1}function l(h,g,m,E,D){if(typeof m!="function")throw new TypeError("The listener must be a function");var L=new n(m,E||h,D),I=e?e+g:g;return h._events[I]?h._events[I].fn?h._events[I]=[h._events[I],L]:h._events[I].push(L):(h._events[I]=L,h._eventsCount++),h}function c(h,g){--h._eventsCount===0?h._events=new s:delete h._events[g]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var g=[],m,E;if(this._eventsCount===0)return g;for(E in m=this._events)t.call(m,E)&&g.push(e?E.slice(1):E);return Object.getOwnPropertySymbols?g.concat(Object.getOwnPropertySymbols(m)):g},o.prototype.listeners=function(g){var m=e?e+g:g,E=this._events[m];if(!E)return[];if(E.fn)return[E.fn];for(var D=0,L=E.length,I=new Array(L);D<L;D++)I[D]=E[D].fn;return I},o.prototype.listenerCount=function(g){var m=e?e+g:g,E=this._events[m];return E?E.fn?1:E.length:0},o.prototype.emit=function(g,m,E,D,L,I){var O=e?e+g:g;if(!this._events[O])return!1;var q=this._events[O],it=arguments.length,Z,H;if(q.fn){switch(q.once&&this.removeListener(g,q.fn,void 0,!0),it){case 1:return q.fn.call(q.context),!0;case 2:return q.fn.call(q.context,m),!0;case 3:return q.fn.call(q.context,m,E),!0;case 4:return q.fn.call(q.context,m,E,D),!0;case 5:return q.fn.call(q.context,m,E,D,L),!0;case 6:return q.fn.call(q.context,m,E,D,L,I),!0}for(H=1,Z=new Array(it-1);H<it;H++)Z[H-1]=arguments[H];q.fn.apply(q.context,Z)}else{var dt=q.length,nt;for(H=0;H<dt;H++)switch(q[H].once&&this.removeListener(g,q[H].fn,void 0,!0),it){case 1:q[H].fn.call(q[H].context);break;case 2:q[H].fn.call(q[H].context,m);break;case 3:q[H].fn.call(q[H].context,m,E);break;case 4:q[H].fn.call(q[H].context,m,E,D);break;default:if(!Z)for(nt=1,Z=new Array(it-1);nt<it;nt++)Z[nt-1]=arguments[nt];q[H].fn.apply(q[H].context,Z)}}return!0},o.prototype.on=function(g,m,E){return l(this,g,m,E,!1)},o.prototype.once=function(g,m,E){return l(this,g,m,E,!0)},o.prototype.removeListener=function(g,m,E,D){var L=e?e+g:g;if(!this._events[L])return this;if(!m)return c(this,L),this;var I=this._events[L];if(I.fn)I.fn===m&&(!D||I.once)&&(!E||I.context===E)&&c(this,L);else{for(var O=0,q=[],it=I.length;O<it;O++)(I[O].fn!==m||D&&!I[O].once||E&&I[O].context!==E)&&q.push(I[O]);q.length?this._events[L]=q.length===1?q[0]:q:c(this,L)}return this},o.prototype.removeAllListeners=function(g){var m;return g?(m=e?e+g:g,this._events[m]&&c(this,m)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,r.exports=o})(Zo);var rc=Zo.exports;const ks=Wo(rc);class Qo{constructor(t){_(this,"eventArgs",{});this.shape=t}on(t,...e){t&&(this.eventArgs[t]===void 0&&(this.eventArgs[t]=[]),this.eventArgs[t].push(e),this.shape[t](...e))}removeAllListeners(){Object.keys(this.eventArgs).forEach(e=>{const s=this.eventArgs[e];s==null||s.forEach(n=>{this.shape[`un${e}`](...n)})})}}const As=Pt?7:5,ar=As*.6,di=Pt?3:2,Ln=As*2+di+3;class ic{constructor({paper:t,nodeBBox:e,isExpand:s,direction:n}){_(this,"paper");_(this,"circleShape");_(this,"horizontalShape");_(this,"verticalShape");_(this,"shapeSet");_(this,"shapeEventEmitter");_(this,"isExpand");this.paper=t,this.isExpand=s,this.shapeSet=t.set();const{x:l,y:c}=this.getPosition(e,n);this.circleShape=t.circle(l,c,As),this.circleShape.attr({fill:"#fff","fill-opacity":1}),this.circleShape.node.style.cursor="pointer";const{cx:o,cy:h}=this.circleShape.getBBox();this.horizontalShape=t.path([`M${o-ar} ${h}`,`L${o+ar} ${h}`].join(" ")),this.verticalShape=this.paper.path([`M${o} ${h-ar}`,`L${o} ${h+ar}`].join(" ")),this.shapeSet.push(this.circleShape).push(this.horizontalShape).push(this.verticalShape),s&&this.verticalShape.hide(),this.shapeSet.attr({stroke:"#000","stroke-opacity":.7}),this.shapeSet.toFront(),this.shapeEventEmitter=new Qo(this.shapeSet),this.initHover()}on(t,...e){this.shapeEventEmitter.on(t,...e)}changeExpand(t){this.isExpand!==t&&(t?this.verticalShape.hide():this.verticalShape.show(),this.isExpand=t)}translateTo(t,e){const{x:s,y:n}=this.getPosition(t,e),{cx:l,cy:c}=this.getBBox(),o=s-l,h=n-c;o===0&&h===0||this.shapeSet.translate(o,h)}getBBox(){return this.circleShape.getBBox()}remove(){this.shapeSet.remove(),this.shapeEventEmitter.removeAllListeners()}setStyle(t){switch(t){case"disable":{this.setStyle("base"),this.shapeSet.attr({opacity:.4});break}case"hover":{this.setStyle("base"),this.circleShape.attr({fill:"#E7E7E7","fill-opacity":1});break}case"base":default:{this.shapeSet.attr({opacity:1}),this.circleShape.attr({fill:"#fff","fill-opacity":1});break}}}getPosition(t,e){let s=0;const n=t.cy;return e===_t.RIGHT?s=t.x2+As+di:s=t.x-As-di,{x:s,y:n}}initHover(){this.shapeEventEmitter.on("hover",()=>{this.setStyle("hover")},()=>{this.setStyle("base")})}}class nc{constructor({paper:t,node:e,nodeShape:s,isExpand:n,traverse:l}){_(this,"paper");_(this,"node");_(this,"nodeShape");_(this,"eventEmitter");_(this,"traverse");_(this,"expanderShape",null);_(this,"isExpand");this.paper=t,this.node=e,this.nodeShape=s,this.isExpand=n,this.traverse=l,this.eventEmitter=new ks}getIsExpand(){return this.isExpand}changeExpand(t){var e;if(this.isExpand!==t){if(this.node.children.length===0){this.remove();return}(e=this.expanderShape)==null||e.changeExpand(t),this.isExpand=t,t||this.node.children.forEach(s=>{this.traverse(s,this.hideNode)})}}create(){this.createShape(),this.translateShape()}remove(){var t;(t=this.expanderShape)==null||t.remove(),this.expanderShape=null,this.eventEmitter.removeAllListeners()}on(t,e){this.eventEmitter.on(t,e)}setStyle(t){var e;(e=this.expanderShape)==null||e.setStyle(t)}createShape(){var e;if(this.node.isRoot()||this.expanderShape!==null||this.node.children.length===0||this.nodeShape.getIsHide())return;this.expanderShape=new ic({paper:this.paper,nodeBBox:this.node.getBBox(),isExpand:this.isExpand,direction:this.node.direction});const t=Pt?"touchstart":"mousedown";(e=this.expanderShape)==null||e.on(t,s=>{s.stopPropagation();const n=!this.isExpand;this.changeExpand(n),this.eventEmitter.emit("mousedownExpander",n)})}translateShape(){var t;(t=this.expanderShape)==null||t.translateTo(this.node.getBBox(),this.node.direction)}hideNode({nodeShape:t,expander:e,removeEdgeShape:s}){t.hide(),e.remove(),s()}}const ta=({paper:r,sourceBBox:t,targetBBox:e,direction:s})=>{const n=t.cx,l=t.cy,c=s===_t.LEFT?e.x2:e.x,o=e.cy,h=.8,g=.2,m=c-h*(c-n),E=o-g*(o-l);return r.path(`M${n} ${l}Q${m} ${E} ${c} ${o}`)},ea=({paper:r,sourceBBox:t,targetBBox:e,direction:s,targetDepth:n,hasUnder:l=!1})=>{let c=0,o=0,h=0,g=0,m=0,E=0,D=0,L=0;s===_t.RIGHT?(c=t.x2,h=c+Ln,m=e.x,D=e.x2):(c=t.x,h=c-Ln,m=e.x2,D=e.x),n===2?o=t.cy:o=t.y2,g=o,E=l?e.y2:e.cy,L=E;const I=oc(h,g,m,E);let O=`M${c} ${o} L${h} ${g} ${I}`;return l&&(O+=` M ${m} ${E} L${D} ${L}`),r.path(O)},oc=(r,t,e,s)=>{const c=r+.3*(e-r),o=t+.76*(s-t),h=.5,g=0,m=e-h*(e-r),E=s-g*(s-t);return`M${r} ${t}C${c} ${o} ${m} ${E} ${e} ${s}`},ac=55,lc=14,Zr=50,Bn=13,In=3;class Tn{constructor({paper:t,sourceBBox:e,targetBBox1:s,targetBBox2:n,targetDepth:l,direction:c}){_(this,"paper");_(this,"shapeSet");this.paper=t;const o=s||n,h=l===1?ac:lc;let g=0;if(o!==null)g=c===_t.RIGHT?o.x:o.x2-Zr;else{const I=Jo(l);g=c===_t.RIGHT?e.x2+I:e.x-I-Zr}let m=0;s!==null&&n!==null?m=(n.y+s.y2)/2:s!==null&&n===null?(m=s.y2+h,l>1&&(m+=In)):s===null&&n!==null?(m=n.y-h,l>1&&(m+=In)):m=e.cy;const E=m-Bn/2,D=this.drawRect({x:g,y:E}),L=this.drawPath({sourceBBox:e,targetBBox:D.getBBox(),targetDepth:l,direction:c});this.shapeSet=t.set().push(D).push(L)}remove(){this.shapeSet.remove()}drawRect({x:t,y:e}){const s=this.paper.rect(t,e,Zr,Bn,6);return s.attr({fill:"#E74C3C","stroke-opacity":0,opacity:.8}),s}drawPath({sourceBBox:t,targetBBox:e,targetDepth:s,direction:n}){const l=s===1?ta({paper:this.paper,sourceBBox:t,targetBBox:e,direction:n}):ea({paper:this.paper,sourceBBox:t,targetBBox:e,direction:n,targetDepth:s});return l.attr({stroke:"#E74C3C","stroke-width":2,opacity:.6}),l}}class hc{constructor(t,e){_(this,"shape",null);this.paper=t,this.node=e}draw(t){var e,s,n;if((e=this.shape)==null||e.remove(),t===null)this.shape=null;else{const{father:l,childIndex:c,isOwnArea:o,direction:h}=t,g=this.node.getBBox(),m=l.getBBox();if(o)this.shape=new Tn({paper:this.paper,sourceBBox:m,targetBBox1:g,targetBBox2:g,targetDepth:l.depth+1,direction:h});else{const E=l.getDirectionChildren(h);let D=((s=E[c-1])==null?void 0:s.getBBox())||null,L=((n=E[c])==null?void 0:n.getBBox())||null;l.isExpand||(D=null,L=null),this.shape=new Tn({paper:this.paper,sourceBBox:m,targetBBox1:D,targetBBox2:L,targetDepth:l.depth+1,direction:h})}l.isRoot()&&l.nodeShapeToFront()}}clear(){var t;(t=this.shape)==null||t.remove(),this.shape=null}}let ui={isDebug:!1};const cc=r=>{ui={...ui,...r}},Mn=()=>ui;class dc{constructor(t){_(this,"shapeSet",null);this.paper=t}draw(t){const{isDebug:e}=Mn();e&&(this.shapeSet=this.paper.set(),t.forEach(({node:s,areaBox:n,childrenYList:l})=>{var D,L;let c="green";s.children.length===0?c="red":s.depth===0&&(c="orange");const{x:o,y:h,x2:g,y2:m}=n,E=this.paper.rect(o,h,g-o,m-h).attr({"stroke-opacity":0,fill:c,opacity:.2});(D=this.shapeSet)==null||D.push(E),l==null||l.forEach(I=>{var q;const O=this.paper.path(`M${o} ${I}L${g} ${I}`).attr({stroke:c,opacity:.6});(q=this.shapeSet)==null||q.push(O)}),(L=this.shapeSet)==null||L.toBack()}))}clear(){var e;const{isDebug:t}=Mn();t&&((e=this.shapeSet)==null||e.remove())}}const uc=80,An=100;class fc{constructor(t,e){_(this,"root");_(this,"drawDragArea",null);_(this,"dragTemp");_(this,"areaList",[]);_(this,"hitArea",null);this.node=e,this.dragTemp=new hc(t,e),this.drawDragArea=new dc(t),this.root=e.getRoot()}drawTemp(t,e){const s=this.getHitArea(t,e);this.isSameHitArea(this.hitArea,s)||(this.dragTemp.draw(s),this.hitArea=s)}init(){var t;this.areaList=this.getAreaList(this.root),(t=this.drawDragArea)==null||t.draw(this.areaList)}clear(){var t;this.areaList=[],(t=this.drawDragArea)==null||t.clear(),this.dragTemp.clear()}getCurrentHitArea(){return this.hitArea}getHitArea(t,e){for(let s=0;s<this.areaList.length;s++){const{node:n,areaBox:l,childrenYList:c,direction:o}=this.areaList[s];if(t>=l.x&&t<=l.x2&&e>=l.y&&e<=l.y2){if(!c||c.length===0||n.isExpand===!1)return{father:n,childIndex:0,isOwnArea:this.isOwnArea(n,0,o),direction:o};for(let h=0;h<c.length-1;h++)if(e>=c[h]&&e<c[h+1])return{father:n,childIndex:h,isOwnArea:this.isOwnArea(n,h,o),direction:o}}}return null}isOwnArea(t,e,s){var c,o;const n=(c=this.node.father)==null?void 0:c.getDirectionChildren(s),l=n==null?void 0:n.findIndex(h=>h.id===this.node.id);return(t==null?void 0:t.id)===((o=this.node.father)==null?void 0:o.id)&&l!==void 0&&l>-1&&(e===l||e===l+1)}isSameHitArea(t,e){return(t==null?void 0:t.father.id)===(e==null?void 0:e.father.id)&&(t==null?void 0:t.childIndex)===(e==null?void 0:e.childIndex)&&(t==null?void 0:t.direction)===(e==null?void 0:e.direction)}getAreaList(t){var n;const e=[],s=[{node:t,direction:_t.RIGHT},{node:t,direction:_t.LEFT}];for(;s.length>0;){const l=s.length;for(let c=0;c<l;c++){const{node:o,direction:h}=s.shift();if(this.node.id===o.id||((n=o.father)==null?void 0:n.isExpand)===!1)continue;const g=this.getArea(o,h);e.unshift(g),o.getDirectionChildren(h).forEach(m=>s.push({node:m,direction:h}))}}return e}getArea(t,e){const s={x:0,y:0,x2:0,y2:0},n=t.getBBox(),l=t.getDirectionChildren(e);let c=0,o=0;if(l.length===0||!t.isExpand)c=n.y,o=n.y2;else{const E=l[0],D=l[l.length-1];c=E.getBBox().y,o=D.getBBox().y2}const h=this.getNodeYGap(t);c-=h,o+=h;const g=this.getChildBoundaryX(t,e);s.y=c,s.y2=o,t.isRoot()?(s.x=e===_t.RIGHT?n.cx:g,s.x2=e===_t.RIGHT?g:n.cx):(s.x=e===_t.RIGHT?n.x2:g,s.x2=e===_t.RIGHT?g:n.x);const m=this.getChildrenYList(l,s);return{node:t,areaBox:s,direction:e,childrenYList:m}}getChildrenYList(t,e){const s=[e.y];return t.forEach(n=>{const l=n.getBBox();s.push(l.cy)}),s.push(e.y2),s}getNodeYGap(t){const e=t.isRoot()?uc:0;return(Ri(t.depth)+e)/2}getChildBoundaryX(t,e){const s=t.getDirectionChildren(e);if(s.length===0||t.isExpand===!1){const o=t.getBBox();return e===_t.RIGHT?o.x2+An:o.x-An}let n=s[0],l=n.getBBox().width;for(let o=1;o<s.length;o++){const h=s[o],g=h.getBBox();g.width>l&&(l=g.width,n=h)}const c=n.getBBox();return e===_t.RIGHT?c.x2:c.x}}class pc{constructor(t){_(this,"clonedNodeShape",null);this.originNodeShape=t}init(){this.clonedNodeShape=this.originNodeShape.clone(),this.clonedNodeShape.setStyle("disable")}translate(t,e){var s;(s=this.clonedNodeShape)==null||s.translate(t,e)}clear(){var t;(t=this.clonedNodeShape)==null||t.remove()}}const Rn=2;class gc{constructor({paper:t,node:e,nodeShape:s,viewport:n,traverse:l}){_(this,"node");_(this,"viewport");_(this,"paper");_(this,"dragArea");_(this,"dragClonedNode");_(this,"eventEmitter");_(this,"hitFather",null);_(this,"traverse");_(this,"isStart",!1);_(this,"isMoveInited",!1);_(this,"startX",0);_(this,"startY",0);_(this,"lastDx",0);_(this,"lastDy",0);_(this,"styleTypeMap",{});_(this,"start",(t,e,s)=>{s.stopPropagation(),this.isStart=!0;const n=this.viewport.getViewportPosition(t,e);this.startX=n.x,this.startY=n.y});_(this,"move",(t,e)=>{var c,o;const s=this.viewport.getScale(),n=t/s,l=e/s;if(this.isStart){if(!this.isMoveInited&&(Math.abs(t)>Rn||Math.abs(e)>Rn)&&(this.dragArea.init(),this.dragClonedNode.init(),this.dragClonedNode.translate(this.lastDx,this.lastDy),this.traverse(this.node,({node:h,nodeShape:g,expander:m,edgeShape:E})=>{this.styleTypeMap[h.id]=g.getStyle(),g.setStyle("disable"),m.setStyle("disable"),E==null||E.setStyle("disable")}),document.body.style.cursor="grabbing",this.isMoveInited=!0),this.isMoveInited){const h=this.startX+n,g=this.startY+l;this.dragArea.drawTemp(h,g);const m=n-this.lastDx,E=l-this.lastDy;this.dragClonedNode.translate(m,E);const D=this.dragArea.getCurrentHitArea();(D==null?void 0:D.father.id)!==((c=this.hitFather)==null?void 0:c.id)&&(D==null||D.father.setStyle("overlay"),(o=this.hitFather)==null||o.setStyle("base")),this.hitFather=(D==null?void 0:D.father)||null}this.lastDx=n,this.lastDy=l}});_(this,"end",()=>{var e;if(this.isStart=!1,this.startX=0,this.startY=0,!this.isMoveInited)return;this.isMoveInited=!1,this.lastDx=0,this.lastDy=0,(e=this.hitFather)==null||e.setStyle("base"),this.hitFather=null;const t=this.dragArea.getCurrentHitArea();this.eventEmitter.emit("dragEnd",t),this.dragArea.clear(),this.dragClonedNode.clear(),document.body.style.cursor="default",this.traverse(this.node,({node:s,nodeShape:n,expander:l,edgeShape:c})=>{const o=this.styleTypeMap[s.id];n.setStyle(o),l.setStyle("base"),c==null||c.setStyle("base")}),this.styleTypeMap={}});this.paper=t,this.node=e,this.viewport=n,this.traverse=l,this.dragArea=new fc(this.paper,e),this.dragClonedNode=new pc(s),this.eventEmitter=new ks,Pt||s.on("drag",this.move,this.start,this.end)}clear(){this.eventEmitter.removeAllListeners()}on(t,e){this.eventEmitter.on(t,e)}}const mc=20,yc=12,ns=6,wc=2;class vc{constructor({paper:t,nodeBBox:e,name:s,color:n}){_(this,"labelShape");_(this,"rectShape");_(this,"borderShape");_(this,"shapeSet");this.rectShape=t.rect(e.x,e.y,0,0),this.labelShape=t.text(e.x,e.y,s),this.borderShape=t.rect(e.x,e.y,0,0,4),this.shapeSet=t.set().push(this.labelShape,this.rectShape,this.borderShape),this.shapeSet.toBack(),this.labelShape.attr({stroke:"#fff"}),this.rectShape.attr({fill:n,"stroke-opacity":0}),this.borderShape.attr({stroke:n,"stroke-width":wc,"fill-opacity":0}),this.setPosition(e)}remove(){this.shapeSet.remove()}setPosition(t){const e=this.labelShape.getBBox(),s=e.width+mc,n=e.height+yc;this.rectShape.attr({width:s,height:n}),this.borderShape.attr({width:t.width+ns,height:t.height+ns});const l=this.rectShape.getBBox(),c=t.x-ns/2,o=t.y-l.height-ns/2,h=c+(l.width-e.width)/2,g=o+(l.height-e.height)/2,m=t.x-ns/2,E=t.y-ns/2;this.shapeTranslateTo(this.labelShape,h,g),this.shapeTranslateTo(this.rectShape,c,o),this.shapeTranslateTo(this.borderShape,m,E)}shapeTranslateTo(t,e,s){const{x:n,y:l}=t.getBBox(),c=e-n,o=s-l;c===0&&o===0||t.translate(c,o)}}const bc={"font-size":16,fill:"#000",opacity:1},xc={"fill-opacity":0,stroke:"#808080","stroke-opacity":1,opacity:1},Sc={stroke:"#fff","stroke-width":2,fill:"#fff","fill-opacity":0,opacity:0};class kc{constructor({shapeSet:t,labelShape:e,borderShape:s,rectShape:n,labelBaseAttr:l,rectBaseAttr:c,borderBaseAttr:o}){_(this,"shapeSet");_(this,"borderShape");_(this,"labelShape");_(this,"rectShape");_(this,"labelBaseAttr");_(this,"rectBaseAttr");_(this,"borderBaseAttr");_(this,"collaborateStyle",null);_(this,"styleType","base");this.shapeSet=t,this.labelShape=e,this.borderShape=s,this.rectShape=n,this.labelBaseAttr={...bc,...l},this.rectBaseAttr={...xc,...c},this.borderBaseAttr={...Sc,...o}}setBaseStyle(){this.labelShape.attr(this.labelBaseAttr),this.borderShape.attr(this.borderBaseAttr),this.rectShape.attr(this.rectBaseAttr)}setStyle(t){switch(t){case"select":{this.setBaseStyle(),this.borderShape.attr({stroke:"#3498DB",opacity:1});break}case"overlay":{this.setBaseStyle(),this.borderShape.attr({stroke:"#E74C3C",opacity:.8});break}case"disable":{this.shapeSet.attr({opacity:.4});break}case"hover":{this.setBaseStyle(),this.borderShape.attr({stroke:"#3498DB",opacity:.5});break}case"base":default:{this.setBaseStyle();break}}this.styleType=t}getStyle(){return this.styleType}getBaseAttr(){return{labelBaseAttr:this.labelBaseAttr,borderBaseAttr:this.borderBaseAttr,rectBaseAttr:this.rectBaseAttr}}}const On=-999999,Hn=-999999,_c=40,Ec=37,lr=6;class qs{constructor({paper:t,x:e,y:s,label:n,paddingWidth:l=_c,rectHeight:c=Ec,labelBaseAttr:o,rectBaseAttr:h,borderBaseAttr:g,imageData:m,link:E}){_(this,"paper");_(this,"shapeSet");_(this,"borderShape");_(this,"labelShape");_(this,"rectShape");_(this,"imageShape",null);_(this,"paddingWidth");_(this,"rectHeight");_(this,"shapeEventEmitter");_(this,"nodeShapeStyle");_(this,"imageData",null);_(this,"label");_(this,"isHide",!1);_(this,"isHoverInCalled",!1);this.paper=t,this.label=n,this.paddingWidth=l,this.rectHeight=c;const D=e!==void 0&&s!==void 0,L=D?e:On,I=D?s:Hn;if(this.labelShape=t.text(L,I,n),this.borderShape=t.rect(L,I,0,0,4),this.rectShape=t.rect(L,I,0,0,4),this.shapeSet=t.set().push(this.labelShape).push(this.borderShape).push(this.rectShape),m&&(this.imageShape=t.image(m.src,L,I,m.width,m.height),this.shapeSet.push(this.imageShape)),this.imageData=m||null,E){const O=Pt?"touchstart":"mousedown";this.labelShape[O](()=>{window.location.href=E}),this.labelShape.attr({stroke:"#3498DB"}),this.labelShape.node.style.cursor="pointer"}this.nodeShapeStyle=new kc({shapeSet:this.shapeSet,labelShape:this.labelShape,borderShape:this.borderShape,rectShape:this.rectShape,labelBaseAttr:o,rectBaseAttr:h,borderBaseAttr:g}),this.nodeShapeStyle.setBaseStyle(),this.labelShape.toFront(),this.labelShape.node.style["user-select"]="none",this.setPosition(L,I),this.shapeEventEmitter=new Qo(this.shapeSet),D||this.hide(),this.initHover()}getBBox(){return this.rectShape.getBBox()}getLabelBBox(){return this.labelShape.getBBox()}setLabel(t,e){const s=this.labelShape.getBBox();this.labelShape.attr({text:t});const n=this.labelShape.getBBox(),l=this.getBBox(),c=n.width-s.width;this.setPosition(l.x,l.y),e!==_t.RIGHT&&e!==_t.LEFT&&this.shapeSet.translate(-c/2,0),this.label=t}translateTo(t,e){const{x:s,y:n}=this.getBBox(),l=t-s,c=e-n;this.show(),!(l===0&&c===0)&&this.shapeSet.translate(l,c)}translate(t,e){this.shapeSet.translate(t,e)}setStyle(t){this.nodeShapeStyle.setStyle(t)}getStyle(){return this.nodeShapeStyle.getStyle()}clone(){const{x:t,y:e}=this.getBBox();return new qs({paper:this.paper,x:t,y:e,label:this.label,paddingWidth:this.paddingWidth,rectHeight:this.rectHeight,...this.nodeShapeStyle.getBaseAttr()})}remove(){this.shapeSet.remove(),this.shapeEventEmitter.removeAllListeners()}on(t,...e){this.shapeEventEmitter.on(t,...e)}show(){this.shapeSet.show(),this.isHide=!1}hide(){this.shapeSet.hide(),this.isHide=!0}getIsHide(){return this.isHide}toFront(){this.borderShape.toFront(),this.rectShape.toFront(),this.labelShape.toFront()}isInvisible(){const t=this.getBBox();return t.x===On&&t.y===Hn}shapeTranslateTo(t,e,s){const{x:n,y:l}=t.getBBox(),c=e-n,o=s-l;c===0&&o===0||t.translate(c,o)}setPosition(t,e){const{labelShape:s,borderShape:n,rectShape:l,imageShape:c,paddingWidth:o,rectHeight:h,imageData:g}=this,m=s.getBBox(),E=h-m.height,D=(g==null?void 0:g.toward)==="right"?s:c,L=(g==null?void 0:g.toward)==="right"?c:s,I={x:0,y:0,width:0,height:0},O=(D==null?void 0:D.getBBox())||I,q=(L==null?void 0:L.getBBox())||I;let it=0;c&&(it=(g==null?void 0:g.gap)!==void 0&&(g==null?void 0:g.gap)>=0?g==null?void 0:g.gap:8);const Z=O.width+q.width+o+it,H=E+Math.max(O.height,q.height);l.attr({width:Z,height:H}),n.attr({width:Z+lr,height:H+lr});const dt=t+o/2,nt=e+(H-O.height)/2,ut=dt+O.width+it,W=e+(H-q.height)/2;this.shapeTranslateTo(n,t-lr/2,e-lr/2),D&&this.shapeTranslateTo(D,dt,nt),L&&this.shapeTranslateTo(L,ut,W)}initHover(){Pt||this.shapeEventEmitter.on("hover",()=>{const t=this.nodeShapeStyle.getStyle();t!=="select"&&t!=="disable"&&(this.nodeShapeStyle.setStyle("hover"),this.isHoverInCalled=!0)},()=>{const t=this.nodeShapeStyle.getStyle();this.isHoverInCalled&&t!=="select"&&t!=="disable"&&(this.nodeShapeStyle.setStyle("base"),this.isHoverInCalled=!1)})}}const sa=16,Cc=40,Dc=37;function Nc(r){return new qs({...r,labelBaseAttr:{"font-size":sa},rectBaseAttr:{fill:"#eee","fill-opacity":1,stroke:"#808080","stroke-opacity":0},paddingWidth:Cc,rectHeight:Dc})}const ra=13,Lc=20,Bc=21;function Ic(r){return new qs({...r,labelBaseAttr:{"font-size":ra},rectBaseAttr:{"stroke-opacity":0},paddingWidth:Lc,rectHeight:Bc})}const ia=25,Tc=42,Mc=52;function Ac(r){return new qs({...r,labelBaseAttr:{"font-size":ia,fill:"#fff","fill-opacity":1},rectBaseAttr:{fill:"#3F89DE","fill-opacity":1,"stroke-opacity":0},paddingWidth:Tc,rectHeight:Mc})}class Rc{constructor({paper:t,sourceBBox:e,targetBBox:s,direction:n}){_(this,"shape");this.shape=ta({paper:t,sourceBBox:e,targetBBox:s,direction:n}),this.shape.attr({stroke:"#000","stroke-width":2}),this.shape.toBack()}setStyle(t){switch(t){case"disable":{this.shape.attr({opacity:.4});break}case"base":default:{this.shape.attr({opacity:1});break}}}remove(){this.shape.remove()}}function Oc(r){return new Rc(r)}class Hc{constructor({paper:t,sourceBBox:e,targetBBox:s,direction:n,targetDepth:l}){_(this,"shape");this.shape=ea({paper:t,sourceBBox:e,targetBBox:s,direction:n,targetDepth:l,hasUnder:!0}),this.shape.attr({stroke:"#000","stroke-width":1.5}),this.shape.toBack()}setStyle(t){switch(t){case"disable":{this.shape.attr({opacity:.4});break}case"base":default:{this.shape.attr({opacity:1});break}}}remove(){this.shape.remove()}}function Fc(r){return new Hc(r)}class zc{constructor({paper:t,depth:e,label:s,direction:n,father:l,imageData:c,link:o}){_(this,"paper");_(this,"depth");_(this,"label");_(this,"father",null);_(this,"imageData",null);_(this,"link","");_(this,"direction");this.paper=t,this.depth=e,this.label=s,this.father=l,this.direction=n,this.imageData=c||null,this.link=o||""}createNode(t,e){const{paper:s,depth:n,label:l,imageData:c,link:o}=this,h={paper:s,x:t,y:e,label:l,imageData:c,link:o},g=Ys(n);return g===Wt.root?Ac(h):g===Wt.firstLevel?Nc(h):Ic(h)}createEdge(t){const{father:e,direction:s,depth:n}=this;if(!e||!s)return null;const l=Ys(n);return l===Wt.firstLevel?Oc({paper:this.paper,sourceBBox:e.getBBox(),targetBBox:t.getBBox(),direction:s}):l===Wt.grandchild?Fc({paper:this.paper,sourceBBox:e.getBBox(),targetBBox:t.getBBox(),direction:s,targetDepth:this.depth}):null}changeDirection(t){this.direction=t}}class Vc{constructor({paper:t,id:e,depth:s,label:n,direction:l,x:c,y:o,father:h=null,isExpand:g,viewport:m,imageData:E,link:D}){_(this,"paper");_(this,"shapeGenerator");_(this,"_id");_(this,"_depth");_(this,"_father",null);_(this,"nodeShape");_(this,"expander");_(this,"drag",null);_(this,"_imageData",null);_(this,"_link","");_(this,"_label");_(this,"_direction");_(this,"_children");_(this,"edgeShape",null);_(this,"collaborateShape",null);_(this,"removeEdgeShape",()=>{var t;(t=this.edgeShape)==null||t.remove(),this.edgeShape=null});this.paper=t,this._id=e,this._depth=s,this._direction=l,this._father=h||null,this._label=n,this._children=[],this._imageData=E||null,this._link=D||"",this.shapeGenerator=new zc({paper:t,depth:s,label:n,direction:l,father:h,imageData:E,link:D}),this.nodeShape=this.shapeGenerator.createNode(c,o),(c!==void 0||o!==void 0)&&(this.edgeShape=this.shapeGenerator.createEdge(this.nodeShape)),this.isRoot()||(this.drag=new gc({paper:t,node:this,viewport:m,nodeShape:this.nodeShape,traverse:this.traverse})),this.expander=new nc({paper:t,node:this,nodeShape:this.nodeShape,isExpand:g===void 0?!0:g,traverse:this.traverse})}get id(){return this._id}get depth(){return this._depth}get direction(){return this._direction}get father(){return this._father}get label(){return this._label}get children(){return this._children}get isExpand(){return this.expander.getIsExpand()}get imageData(){return this._imageData}get link(){return this._link}getDirectionChildren(t){var e;return((e=this.children)==null?void 0:e.filter(s=>s.direction===t))||[]}getBBox(){return this.nodeShape.getBBox()}getLabelBBox(){return this.nodeShape.getLabelBBox()}getDepthType(){return Ys(this.depth)}getRoot(){let t=this;for(;t&&t.getDepthType()!==Wt.root;)t=t.father;return t}isRoot(){return this.getDepthType()===Wt.root}on(t,...e){var c;const s=["mousedown","click","dblclick","drag","touchstart"],n=["mousedownExpander"],l=["dragEnd"];if(s.includes(t)){if(t==="drag"&&!this.isRoot())return;this.nodeShape.on(t,...e)}else n.includes(t)?this.expander.on(t,...e):l.includes(t)&&((c=this.drag)==null||c.on(t,...e))}clearChild(){this._children=[]}pushChild(t){this.children.push(t)}changeExpand(t){t!==void 0&&this.expander.changeExpand(t)}changeDirection(t){this._direction=t,this.shapeGenerator.changeDirection(t)}translateTo(t,e){var s;this.nodeShape.translateTo(t,e),this.removeEdgeShape(),this.edgeShape=this.shapeGenerator.createEdge(this.nodeShape),(s=this.father)==null||s.expander.create(),this.expander.create()}remove(){var t,e;if(!this.isRoot()){const s=(t=this.father)==null?void 0:t.children;if(!s)return;const n=s==null?void 0:s.findIndex(l=>this.id===l.id);n>-1&&s.splice(n,1),s.length===0&&((e=this.father)==null||e.expander.remove())}this.traverse(this,({node:s})=>{var n,l;s.nodeShape.remove(),s.removeEdgeShape(),s.expander.remove(),(n=s.drag)==null||n.clear(),(l=s.collaborateShape)==null||l.remove()})}setLabel(t){var e;this._label=t,this.nodeShape.setLabel(t,this.direction),(e=this.collaborateShape)==null||e.setPosition(this.getBBox())}setStyle(t){this.nodeShape.setStyle(t)}nodeShapeToFront(){this.nodeShape.toFront()}isInvisible(){return this.nodeShape.isInvisible()}setCollaborateStyle(t){var e;t?this.collaborateShape=new vc({paper:this.paper,nodeBBox:this.getBBox(),name:t.name,color:t.color}):(e=this.collaborateShape)==null||e.remove()}traverse(t,e){e({node:t,nodeShape:t.nodeShape,expander:t.expander,edgeShape:t.edgeShape,removeEdgeShape:t.removeEdgeShape}),t.children.forEach(s=>this.traverse(s,e))}}const Uc=["mousedown","click","dblclick","touchstart","mousedownExpander","dragEnd"];class $c{constructor({paper:t,viewport:e}){_(this,"paper");_(this,"viewport");_(this,"eventEmitter");_(this,"createNode",({id:t,depth:e,label:s,direction:n,x:l,y:c,father:o,isExpand:h,imageData:g,link:m})=>{const E=new Vc({paper:this.paper,id:t||ci(),depth:e,label:s,direction:n,x:l,y:c,father:o,isExpand:h,viewport:this.viewport,imageData:g,link:m});return Uc.forEach(D=>{E.on(D,(...L)=>{this.eventEmitter.emit(D,E,...L)})}),E});this.paper=t,this.viewport=e,this.eventEmitter=new ks}on(t,e){this.eventEmitter.on(t,e)}clear(){this.eventEmitter.removeAllListeners()}}class Pc{constructor({nodeCreator:t,selection:e,textEditor:s,dataHandler:n}){const l=Pt?"touchstart":"mousedown";t.on(l,(c,o)=>{o.stopPropagation(),e.selectSingle(c)}),t.on("dblclick",()=>{s.showBySelectionLabel()}),t.on("dragEnd",(c,o)=>{o!==null&&!o.isOwnArea&&n.changeFather({selectionId:c.id,newFatherId:o.father.id,direction:o.direction,childIndex:o.childIndex})}),t.on("mousedownExpander",(c,o)=>{n.update(c.id,{isExpand:o}),e.select([c])})}}const hr=3,cr=.25;class Yc{constructor(t,e){_(this,"paper");_(this,"eventEmitter");_(this,"viewbox",{x:0,y:0,width:0,height:0});_(this,"wrapperWidth");_(this,"wrapperHeight");_(this,"scale",1);this.paperWrapper=t,e&&Number.isFinite(e)&&(this.scale=e),this.paper=this.paperWrapper.getPaper();const s=this.paperWrapper.getSize();this.wrapperWidth=s.width,this.wrapperHeight=s.height,this.eventEmitter=new ks,this.scale>hr?this.scale=hr:this.scale<cr&&(this.scale=cr),this.setScale(this.scale)}getViewbox(){return this.viewbox}getScale(){return this.scale}setScale(t){t>hr?t=hr:t<cr&&(t=cr);const e=this.viewbox;e.width=this.wrapperWidth/t,e.height=this.wrapperHeight/t,e.x=this.getScalePosition(this.scale,t,e.x,this.wrapperWidth),e.y=this.getScalePosition(this.scale,t,e.y,this.wrapperHeight),this.scale=t,this.setViewBox(),this.eventEmitter.emit("changeScale",this.scale)}addScale(t){const e=this.scale+t;this.setScale(e)}on(t,e){this.eventEmitter.on(t,e)}translate(t,e){const s=this.viewbox;s.x=s.x+t/this.scale,s.y=s.y+e/this.scale,this.setViewBox()}translateTo(t,e){const s=this.viewbox;s.x=t,s.y=e,this.setViewBox()}resize(t,e){const s=this.viewbox;s.width=t/this.wrapperWidth*s.width,s.height=e/this.wrapperHeight*s.height,this.setViewBox(),this.wrapperWidth=t,this.wrapperHeight=e}getViewportPosition(t,e){const n=this.paperWrapper.getWrapperDom().getBoundingClientRect();return{x:this.viewbox.x+(t-n.x)/this.scale,y:this.viewbox.y+(e-n.y)/this.scale}}getOffsetPosition(t,e){return{offsetX:(t-this.viewbox.x)*this.scale,offsetY:(e-this.viewbox.y)*this.scale}}getScalePosition(t,e,s,n){return s+n*(1/t-1/e)/2}setViewBox(){const t=this.viewbox;this.paper.setViewBox(t.x,t.y,t.width,t.height,!0)}}const Fn=2;class Gc{constructor(t){_(this,"isStart",!1);_(this,"lastClientX",0);_(this,"lastClientY",0);_(this,"isMoveInited",!1);_(this,"handleMousedown",(t,e)=>{this.isStart=!0,this.lastClientX=t,this.lastClientY=e});_(this,"handleMousemove",(t,e)=>{if(!this.isStart)return;const s=this.lastClientX-t,n=this.lastClientY-e;!this.isMoveInited&&(Math.abs(s)>Fn||Math.abs(n)>Fn)&&(document.body.style.cursor="grabbing",this.isMoveInited=!0),this.isMoveInited&&this.viewport.translate(s,n),this.lastClientX=t,this.lastClientY=e});_(this,"handleMouseup",()=>{this.isStart=!1,this.isMoveInited=!1,this.lastClientX=0,this.lastClientY=0,document.body.style.cursor="default"});this.viewport=t}}class Xc{constructor(t,e){_(this,"isStart",!1);_(this,"start",(t,e,s)=>{s.stopPropagation(),this.isStart=!0,this.dragViewportHandler.handleMousedown.call(this.dragViewportHandler,t,e)});_(this,"move",(t,e,s,n)=>{this.isStart&&this.dragViewportHandler.handleMousemove.call(this.dragViewportHandler,s,n)});_(this,"end",()=>{this.isStart=!1,this.dragViewportHandler.handleMouseup.call(this.dragViewportHandler)});this.root=t,this.dragViewportHandler=e,t.on("drag",this.move,this.start,this.end),this.dragViewportHandler=e}}class Wc{constructor(t,e,s){_(this,"handleMousedown",t=>{if(!this.able)return;let e=0,s=0;if(Pt){const n=t;e=n.touches[0].clientX,s=n.touches[0].clientY,t.preventDefault()}else{const n=t;e=n.clientX,s=n.clientY}this.dragViewportHandler.handleMousedown(e,s)});_(this,"handleMousemove",t=>{let e=0,s=0;if(Pt){const n=t;e=n.touches[0].clientX,s=n.touches[0].clientY}else{const n=t;e=n.clientX,s=n.clientY}this.dragViewportHandler.handleMousemove(e,s)});_(this,"handleMouseup",()=>{this.dragViewportHandler.handleMouseup()});var n,l,c,o,h,g;this.svgDom=t,this.dragViewportHandler=e,this.able=s,this.svgDom=t,Pt?((n=this.svgDom)==null||n.addEventListener("touchstart",this.handleMousedown),(l=this.svgDom)==null||l.addEventListener("touchmove",this.handleMousemove),(c=this.svgDom)==null||c.addEventListener("touchend",this.handleMouseup)):((o=this.svgDom)==null||o.addEventListener("mousedown",this.handleMousedown),(h=this.svgDom)==null||h.addEventListener("mousemove",this.handleMousemove),(g=this.svgDom)==null||g.addEventListener("mouseup",this.handleMouseup))}disable(){this.able=!1}enable(){this.able=!0}clear(){var t,e,s;(t=this.svgDom)==null||t.removeEventListener("mousedown",this.handleMousedown),(e=this.svgDom)==null||e.removeEventListener("mousemove",this.handleMousemove),(s=this.svgDom)==null||s.removeEventListener("mouseup",this.handleMouseup)}}class jc{constructor(t,e){_(this,"isMoveZoom",!1);_(this,"wheelCallback",t=>{if(t.preventDefault(),t.stopPropagation(),t.ctrlKey||this.isMoveZoom){const s=-Math.floor(t.deltaY)*.02;this.viewport.addScale(s)}else{const s=t.deltaX*.6,n=t.deltaY*.6;this.viewport.translate(s,n)}});this.viewport=t,this.wrapperDom=e,e.addEventListener("wheel",this.wheelCallback)}clear(){this.wrapperDom.removeEventListener("wheel",this.wheelCallback)}enableMoveScale(){this.isMoveZoom=!0}disableMoveScale(){this.isMoveZoom=!1}}class Kc{constructor(t,e){_(this,"resizeObserver");_(this,"wrapperDom");const s=t.getWrapperDom(),n=t.getSvgDom();this.wrapperDom=s,this.resizeObserver=new ResizeObserver(l=>{for(const c of l)if(c.target.className.includes(qo)){const{clientWidth:o,clientHeight:h}=c.target;n==null||n.setAttribute("width",`${o}`),n==null||n.setAttribute("height",`${h}`),e.resize(o,h);break}}),this.resizeObserver.observe(s)}clear(){this.resizeObserver.unobserve(this.wrapperDom)}}const zn=.25;class qc{constructor(t){_(this,"viewport");_(this,"root");_(this,"dragBackground");_(this,"viewportWheel");_(this,"viewportResize");_(this,"disableBackgroundDrag",()=>this.dragBackground.disable());_(this,"enableBackgroundDrag",()=>this.dragBackground.enable());_(this,"enableMoveScale",()=>this.viewportWheel.enableMoveScale());_(this,"disableMoveScale",()=>this.viewportWheel.disableMoveScale());const{paperWrapper:e,viewport:s,root:n}=t;this.viewport=s,this.root=n;const l=this.initDrag(t);this.dragBackground=l.dragBackground;const c=e.getWrapperDom();this.viewportWheel=new jc(s,c),this.viewportResize=new Kc(e,s)}zoomIn(){this.viewport.addScale(zn)}zoomOut(){this.viewport.addScale(-zn)}translateToCenter(){const t=this.root.getBBox(),e=this.viewport.getViewbox(),s=t.cx-e.width/2,n=t.cy-e.height/2;this.viewport.translateTo(s,n)}clear(){this.dragBackground.clear(),this.viewportWheel.clear(),this.viewportResize.clear()}initDrag({paperWrapper:t,viewport:e,root:s}){const n=new Gc(e),l=t.getSvgDom(),c=new Xc(s,n),o=new Wc(l,n,Pt);return{dragRoot:c,dragBackground:o}}}const Vn={[Wt.root]:ia,[Wt.firstLevel]:sa,[Wt.grandchild]:ra};class Jc{constructor({viewport:t,selection:e,dataHandler:s,paperWrapper:n}){_(this,"editorWrapperDom");_(this,"editorDom");_(this,"viewport");_(this,"dataHandler");_(this,"node",null);_(this,"isShow",!1);_(this,"isComposition",!1);this.viewport=t,this.dataHandler=s;const l=this.initTextEditorElement(n);this.editorWrapperDom=l.editorWrapperDom,this.editorDom=l.editorDom,!Pt&&(e.on("select",()=>{var o;const c=e.getSelectNodes();c.length===1&&((o=this.node)==null?void 0:o.id)!==c[0].id?(this.setLabel(),this.editorDom.focus(),this.hide(),this.node=c[0],this.translate()):this.node!==null&&(c.length!==1||c[0].id!==this.node.id)&&(this.setLabel(),this.editorDom.blur(),this.hide(),this.node=null)}),this.editorDom.addEventListener("compositionstart",()=>{this.isShow||this.show(),this.isComposition=!0}),this.editorDom.addEventListener("compositionend",()=>{this.isComposition=!1}),this.editorDom.addEventListener("input",c=>{const o=c.data;this.isShow||(/\s/.test(o)?this.showBySelectionLabel():this.isEditableKey(o)?this.show():this.editorDom.innerText="")}))}showBySelectionLabel(){var t;this.show(),this.editorDom.innerText=((t=this.node)==null?void 0:t.label)||"",document.execCommand("selectAll",!1,null),document.getSelection().collapseToEnd()}isShowing(){return this.isShow}finishEdit(){this.isComposition||(this.setLabel(),this.hide())}hide(){this.editorWrapperDom.style.zIndex="-9999",this.editorDom.innerText="",this.isShow=!1}show(){if(this.node===null)return;const t=this.viewport.getScale(),e=Vn[this.node.getDepthType()]*t;this.editorWrapperDom.style.zIndex="3",this.editorDom.style.fontSize=`${e}px`,this.translate(),this.editorDom.focus(),this.isShow=!0}initTextEditorElement(t){const e=document.createElement("div");e.className="node-edit-text-wrapper";const s=document.createElement("div");s.className="node-edit-text",s.setAttribute("contenteditable","true");const n=t.getContainerDom();return e.appendChild(s),n.appendChild(e),{editorWrapperDom:e,editorDom:s}}isEditableKey(t){const e=["`","-","=","[","]","\\",";","'",",",".","/"];return/^[\w]$/.test(t)||e.includes(t)}translate(){if(this.node===null)return;const{cx:t,cy:e}=this.node.getLabelBBox(),{offsetX:s,offsetY:n}=this.viewport.getOffsetPosition(t,e),l=this.viewport.getScale(),o=(1.4*Vn[this.node.getDepthType()]+6)*l;this.editorWrapperDom.style.left=`${s-300}px`,this.editorWrapperDom.style.top=`${n-o/2}px`}setLabel(){const t=this.editorDom.innerText;this.node!==null&&this.isShow&&t!==this.node.label&&this.dataHandler.update(this.node.id,{label:t})}}class Zc{constructor(){}getArrowNextNode(t,e){let s=null;switch(e){case"ArrowUp":{s=this.getVeriticalNext(t,!0);break}case"ArrowRight":{s=this.getHorizontal(t,_t.RIGHT);break}case"ArrowDown":{s=this.getVeriticalNext(t,!1);break}case"ArrowLeft":{s=this.getHorizontal(t,_t.LEFT);break}}return s}getHorizontal(t,e){if(t.direction!==_t.NONE&&t.direction!==e)return t.father;const n=t.getDirectionChildren(e),l=Math.floor((n.length-1)/2);return n[l]||null}getVeriticalNext(t,e){if(t.isRoot()){const c=t.getDirectionChildren(_t.RIGHT),o=t.getDirectionChildren(_t.LEFT),h=c.length>0?c:o,g=h[0]||null,m=h[h.length-1]||null;return e?g:m}let s=0,n=t,l=null;for(;n!==null&&!(n!=null&&n.isRoot());){const c=this.getNextBrothers(n,e);for(let o=0;o<c.length;o++){const h=this.findTargetDepthNode(c[o],s,0,e);if(h){l=h;break}}if(l)break;n=n==null?void 0:n.father,s+=1}return l}findTargetDepthNode(t,e,s,n){if(e===s)return t;let l=null,c=t.getDirectionChildren(t.direction);n&&(c=c.reverse());for(let o=0;o<c.length;o++){const h=c[o],g=this.findTargetDepthNode(h,e,s+1,n);if(g){l=g;break}}return l}getNextBrothers(t,e){var c;const s=[];let n=((c=t==null?void 0:t.father)==null?void 0:c.getDirectionChildren(t.direction))||[];e&&(n=n.reverse());let l=!1;for(let o=0;o<n.length;o++)l&&s.push(n[o]),n[o].id===t.id&&(l=!0);return s}}class Qc{constructor(){}getRemoveNextNode(t){if(t.length===0)return null;for(let e=t.length-1;e>=0;e--){const s=t[e],n=this.getTopNode(s,t);if(n.isRoot())return null;const l=n.father.getDirectionChildren(n.direction),c=l.findIndex(D=>D.id===n.id);let o=c-1,h=l[o];for(;t.includes(h)&&h;)o-=1,h=l[o];if(h)return h;let g=c+1,m=l[g];for(;t.includes(m)&&m;)g+=1,m=l[g];if(m)return m;if(n.getDepthType()===Wt.firstLevel){const D=n.direction===_t.RIGHT?_t.LEFT:_t.RIGHT,L=n.father.getDirectionChildren(D),I=L[L.length-1];if(I&&!t.includes(I))return I}const E=n.father;if(!E.isRoot())return E}return null}getTopNode(t,e){let s=t,n=t;for(;n!==null;)e.includes(n)&&(s=n),n=n.father;return s}}class td{constructor(t){_(this,"selectNodes",[]);_(this,"selectionArrowNext");_(this,"selectionRemoveNext");_(this,"eventEmitter");_(this,"isMultiClickMode",!1);_(this,"getNodeMap",()=>{const t={};return this.getNodeMapInner(this.root,t),t});_(this,"getNodeMapInner",(t,e)=>{var s;t&&(e[t.id]=t,(s=t.children)==null||s.forEach(n=>{this.getNodeMapInner(n,e)}))});this.root=t,this.selectionArrowNext=new Zc,this.selectionRemoveNext=new Qc,this.eventEmitter=new ks}setIsMultiClickMode(t){this.isMultiClickMode=t}select(t){const e=[...t];this.selectNodes.forEach(s=>s.setStyle("base")),e.forEach(s=>s.setStyle("select")),this.selectNodes=e,this.eventEmitter.emit("select",this.selectNodes)}selectSingle(t){if(!this.isMultiClickMode){this.select([t]);return}const e=this.selectNodes.findIndex(s=>s.id===t.id);e>=0?(t.setStyle("base"),this.selectNodes.splice(e,1)):(t.setStyle("select"),this.selectNodes.push(t)),this.eventEmitter.emit("select",this.selectNodes)}selectArrowNext(t){const e=this.selectNodes[this.selectNodes.length-1];if(!e)return;const s=this.selectionArrowNext.getArrowNextNode(e,t);s&&this.select([s])}empty(){this.select([])}on(t,e){this.eventEmitter.on(t,e)}getSelectNodes(){return this.selectNodes}getSingleSelectNode(){return this.selectNodes.length!==1?null:this.selectNodes[0]}getRemoveNextNode(){return this.selectionRemoveNext.getRemoveNextNode(this.selectNodes)}selectByIds(t){const e=this.getNodeMap(),s=t.map(n=>e[n]).filter(n=>!!n)||[];this.select(s)}}class ed{constructor(t){_(this,"startX",0);_(this,"startY",0);_(this,"isInit",!1);_(this,"rectShape",null);this.paper=t}init(t,e){this.startX=t,this.startY=e,this.isInit=!0}resize(t,e){if(!this.isInit)return;const{startX:s,startY:n}=this,l=s<t?s:t,c=n<e?n:e,o=Math.abs(s-t),h=Math.abs(n-e);this.rectShape===null?(this.rectShape=this.paper.rect(l,c,o,h),this.rectShape.attr({stroke:"#73a1bf",fill:"rgba(153,124,255,0.1)",opacity:.8})):this.rectShape.attr({x:l,y:c,width:o,height:h})}hide(){var t;this.isInit=!1,(t=this.rectShape)==null||t.remove(),this.rectShape=null}getBBox(){var t;return(t=this.rectShape)==null?void 0:t.getBBox()}}const Un=2;class sd{constructor({paperWrapper:t,viewport:e,toolOperation:s,selection:n}){_(this,"multiSelectShape");_(this,"viewport");_(this,"selection");_(this,"svgDom");_(this,"toolOperation");_(this,"allNodes",[]);_(this,"preSelectNodes",[]);_(this,"able",!0);_(this,"isStart",!1);_(this,"isMoveInited",!1);_(this,"lastClientX",0);_(this,"lastClientY",0);_(this,"handleTouchstart",()=>{this.selection.empty()});_(this,"handleMousedown",t=>{this.able&&(this.isStart=!0,this.lastClientX=t.clientX,this.lastClientY=t.clientY,this.selection.empty())});_(this,"handleMousemove",t=>{if(!this.isStart)return;const{clientX:e,clientY:s}=t,n=this.lastClientX-e,l=this.lastClientY-s;if(!this.isMoveInited&&(Math.abs(n)>Un||Math.abs(l)>Un)){const c=this.viewport.getViewportPosition(t.clientX,t.clientY);this.multiSelectShape.init(c.x,c.y);const o=this.toolOperation.getNodeMap();this.allNodes=Object.keys(o).map(h=>o[h]),this.isMoveInited=!0}if(this.isMoveInited){const c=this.viewport.getViewportPosition(t.clientX,t.clientY);this.multiSelectShape.resize(c.x,c.y);const o=this.allNodes.filter(g=>Ko.isBBoxIntersect(this.multiSelectShape.getBBox(),g.getBBox()))||[],h=[];for(let g=0;g<this.preSelectNodes.length;g++)o.includes(this.preSelectNodes[g])&&h.push(this.preSelectNodes[g]);for(let g=0;g<o.length;g++)h.includes(o[g])||h.push(o[g]);this.selection.select(h),this.preSelectNodes=h}this.lastClientX=e,this.lastClientY=s});_(this,"handleMouseup",()=>{this.isStart&&(this.multiSelectShape.hide(),this.allNodes=[],this.preSelectNodes=[],this.isStart=!1,this.isMoveInited=!1,this.lastClientX=0,this.lastClientY=0)});var c,o,h,g;const l=t.getPaper();this.svgDom=t.getSvgDom(),this.multiSelectShape=new ed(l),this.viewport=e,this.selection=n,this.toolOperation=s,Pt?(c=this.svgDom)==null||c.addEventListener("touchstart",this.handleTouchstart,!1):((o=this.svgDom)==null||o.addEventListener("mousedown",this.handleMousedown),(h=this.svgDom)==null||h.addEventListener("mousemove",this.handleMousemove),(g=this.svgDom)==null||g.addEventListener("mouseup",this.handleMouseup))}disable(){this.able=!1}enable(){this.able=!0}clear(){var t,e,s,n;Pt?(t=this.svgDom)==null||t.removeEventListener("touchstart",this.handleTouchstart,!1):((e=this.svgDom)==null||e.removeEventListener("mousedown",this.handleMousedown),(s=this.svgDom)==null||s.removeEventListener("mousemove",this.handleMousemove),(n=this.svgDom)==null||n.removeEventListener("mouseup",this.handleMouseup))}}class rd{constructor(){_(this,"allKeydownCallback");_(this,"allKeyupCallback");_(this,"allKeypressCallback");_(this,"keydownCallbacks",[]);_(this,"keyupCallbacks",[]);_(this,"keypressCallbacks",[]);this.allKeydownCallback=t=>{this.keydownCallbacks.forEach(e=>e(t))},document.addEventListener("keydown",this.allKeydownCallback),this.allKeyupCallback=t=>{this.keyupCallbacks.forEach(e=>e(t))},document.addEventListener("keyup",this.allKeyupCallback),this.allKeypressCallback=t=>{this.keypressCallbacks.forEach(e=>e(t))},document.addEventListener("keypress",this.allKeypressCallback)}on(t,e){t==="keydown"?this.keydownCallbacks.push(e):t==="keyup"?this.keyupCallbacks.push(e):t==="keypress"&&this.keypressCallbacks.push(e)}off(t,e){t==="keydown"?this.removeCallback(this.keydownCallbacks,e):t==="keyup"?this.removeCallback(this.keyupCallbacks,e):t==="keypress"&&this.removeCallback(this.keypressCallbacks,e)}clear(){document.removeEventListener("keydown",this.allKeydownCallback),document.removeEventListener("keyup",this.allKeyupCallback),document.removeEventListener("keypress",this.allKeypressCallback)}removeCallback(t,e){const s=t.findIndex(n=>n===e);s>-1&&t.splice(s,1)}}class id{constructor(t){_(this,"keyboardEvents");_(this,"handleKeydown",(t,{toolOperation:e,textEditor:s,selection:n,multiSelect:l,viewportInteraction:c})=>{const{key:o,ctrlKey:h,shiftKey:g,metaKey:m}=t;if(s.isShowing()){switch(o){case"Escape":{s.hide();break}case"Tab":case"Enter":{s.finishEdit();break}}return}const E=Wh()?h:m;if(E&&g)switch(o){case"z":{e.redo();break}}else if(E&&!g)switch(o){case"z":{e.undo();break}case"=":{t.preventDefault(),c.zoomIn();break}case"-":{t.preventDefault(),c.zoomOut();break}case"Meta":case"Alt":{n.setIsMultiClickMode(!0),l.disable(),c.enableBackgroundDrag(),c.enableMoveScale();break}}else if(!m&&!g&&!h)switch(o){case"Enter":{e.addBrotherNode();break}case"Tab":{n.getSelectNodes().length>0&&t.preventDefault(),e.addChildNode();break}case"Backspace":{e.removeNode();break}case"ArrowUp":case"ArrowRight":case"ArrowDown":case"ArrowLeft":{n.selectArrowNext(o);break}}});_(this,"handleKeyup",(t,{selection:e,multiSelect:s,viewportInteraction:n})=>{switch(t.key){case"Meta":case"Alt":{e.setIsMultiClickMode(!1),s.enable(),n.disableBackgroundDrag(),n.disableMoveScale();break}}});this.keyboardEvents=new rd,this.keyboardEvents.on("keydown",e=>{this.handleKeydown(e,t)}),this.keyboardEvents.on("keyup",e=>{this.handleKeyup(e,t)})}clear(){this.keyboardEvents.clear()}}class nd{constructor({root:t,tree:e,selection:s,dataHandler:n}){_(this,"root");_(this,"tree");_(this,"selection");_(this,"dataHandler");this.root=t,this.tree=e,this.selection=s,this.dataHandler=n}undo(){this.dataHandler.undo()}redo(){this.dataHandler.redo()}addChildNode(){const t=this.selection.getSingleSelectNode();t&&this.dataHandler.addChildNode(t.id,t.depth+1)}addBrotherNode(){const t=this.selection.getSingleSelectNode();t&&this.dataHandler.addBrotherNode(t.id,t.depth)}removeNode(){const t=this.selection.getSelectNodes();if(!t||t.length===0)return;const e=t.map(s=>s.id);this.dataHandler.removeNode(e)}getNodeMap(){const t={};return this.setNodeMapInner(this.root,t),t}setNodeMapInner(t,e){e[t.id]=t,t.children.forEach(s=>this.setNodeMapInner(s,e))}}class od{constructor(t,e=""){_(this,"dom");typeof t=="string"?(this.dom=document.createElement(t),this.dom.className=e):this.dom=t}getDom(){return this.dom}setChildren(...t){return t.forEach(e=>this.setChild(e)),this}setChild(t){const e=typeof t=="string"?document.createTextNode(t):t.dom;return this.dom.appendChild(e),this}setClassName(t){return this.dom.className=t,this}addClass(t){return this.dom.classList.add(t),this}hasClass(t){return this.dom.classList.contains(t)}removeClass(t){return this.dom.classList.remove(t),this}setHtml(t){return this.dom.innerHTML=t,this}setCss(t){return Object.keys(t).forEach(e=>{this.dom.style[e]=t[e]}),this}addEventListener(...t){this.dom.addEventListener(...t)}removeEventListener(...t){this.dom.removeEventListener(...t)}}const ee=(r,t="")=>new od(r,t),Ge=({iconName:r,tipLabel:t,isDisabled:e=!0})=>{const s=ee("div",`toolbar-btn${e?" disabled":""}`).setChild(ee("div",`toolbar-icon ${r}-icon`));return{el:ee("div","toolbar-item").setChildren(s,ee("div","toolbar-tip").setChild(t)),btnEl:s}};class ad{constructor({dataHandler:t,toolOperation:e}){_(this,"el");_(this,"btnEl");_(this,"toolOperation");_(this,"dataHandler");this.dataHandler=t,this.toolOperation=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.dataHandler.canUndo()?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"undo",tipLabel:"Undo"});return e.addEventListener("click",()=>{this.toolOperation.undo()},!1),{el:t,btnEl:e}}}class ld{constructor({toolOperation:t,dataHandler:e}){_(this,"el");_(this,"btnEl");_(this,"dataHandler");_(this,"toolOperation");this.toolOperation=t,this.dataHandler=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.dataHandler.canRedo()?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"redo",tipLabel:"Redo"});return e.addEventListener("click",()=>{this.toolOperation.redo()},!1),{el:t,btnEl:e}}}let hd=class{constructor({toolOperation:t,selection:e}){_(this,"el");_(this,"btnEl");_(this,"toolOperation");_(this,"selection");this.toolOperation=t,this.selection=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.selection.getSelectNodes().length===1?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"add-child",tipLabel:"Add Subtopic"});return e.addEventListener("click",()=>{this.toolOperation.addChildNode()},!1),{el:t,btnEl:e}}};class cd{constructor({toolOperation:t,selection:e}){_(this,"el");_(this,"btnEl");_(this,"toolOperation");_(this,"selection");this.toolOperation=t,this.selection=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.selection.getSelectNodes().length===1?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"add-brother",tipLabel:"Add Topic"});return e.addEventListener("click",()=>{this.toolOperation.addBrotherNode()},!1),{el:t,btnEl:e}}}class dd{constructor({textEditor:t,selection:e}){_(this,"el");_(this,"btnEl");_(this,"textEditor");_(this,"selection");this.textEditor=t,this.selection=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.selection.getSelectNodes().length===1?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"edit",tipLabel:"Edit Text"});return e.addEventListener("click",()=>{this.textEditor.showBySelectionLabel()},!1),{el:t,btnEl:e}}}class ud{constructor({toolOperation:t,selection:e}){_(this,"el");_(this,"btnEl");_(this,"toolOperation");_(this,"selection");this.toolOperation=t,this.selection=e;const s=this.element();this.el=s.el,this.btnEl=s.btnEl}setState(){this.selection.getSelectNodes().length>0?this.btnEl.removeClass("disabled"):this.btnEl.addClass("disabled")}element(){const{el:t,btnEl:e}=Ge({iconName:"delete",tipLabel:"Delete"});return e.addEventListener("click",()=>{this.toolOperation.removeNode()},!1),{el:t,btnEl:e}}}class fd{constructor({viewportInteraction:t}){_(this,"el");_(this,"btnEl");_(this,"viewportInteraction");this.viewportInteraction=t;const e=this.element();this.el=e.el,this.btnEl=e.btnEl}element(){const{el:t,btnEl:e}=Ge({iconName:"target",tipLabel:"Locate to center",isDisabled:!1});return e.addEventListener("click",()=>{this.viewportInteraction.translateToCenter()},!1),{el:t,btnEl:e}}}class pd{constructor({paperWrapper:t,toolOperation:e,selection:s,dataHandler:n,textEditor:l,viewportInteraction:c}){_(this,"undo");_(this,"redo");_(this,"addChildNode");_(this,"addBrotherNode");_(this,"edit");_(this,"delete");_(this,"target");this.undo=new ad({toolOperation:e,dataHandler:n}),this.redo=new ld({toolOperation:e,dataHandler:n}),this.addChildNode=new hd({toolOperation:e,selection:s}),this.addBrotherNode=new cd({toolOperation:e,selection:s}),this.edit=new dd({textEditor:l,selection:s}),this.delete=new ud({toolOperation:e,selection:s}),this.target=new fd({viewportInteraction:c});const o=ee("div"),h=[this.undo.el,this.redo.el,this.buildDivider(),this.addChildNode.el,this.addBrotherNode.el,this.buildDivider(),Pt?o:this.edit.el,this.delete.el,this.buildDivider(),this.target.el],g=t.getWrapperDom(),m=ee("div","toolbar");h.forEach(E=>{m.setChildren(E)}),g.appendChild(m.getDom()),s.on("select",()=>{this.setState()}),n.on("data",()=>{setTimeout(()=>{this.setState()},0)})}buildDivider(){return ee("div","toolbar-divider")}setState(){this.undo.setState(),this.redo.setState(),this.addChildNode.setState(),this.addBrotherNode.setState(),this.edit.setState(),this.delete.setState()}}const $n=.25;class gd{constructor({paperWrapper:t,viewport:e}){_(this,"viewport");_(this,"el");_(this,"scaleLabelEl");this.viewport=e;const s=this.element();this.el=s.el,this.scaleLabelEl=s.scaleLabelEl,t.getWrapperDom().appendChild(this.el.getDom()),e.on("changeScale",l=>{this.scaleLabelEl.setHtml(this.getScalePercent(l))})}element(){const t=this.viewport.getScale(),e=ee("div","scale-btn").setChild(ee("div","scale-btn-icon zoom-out")),s=ee("div","scale-btn").setChild(ee("div","scale-btn-icon zoom-in")),n=ee("div","scale-label").setChild(this.getScalePercent(t)),l=ee("div","viewport-scale-controller").setChildren(e,n,s);return e.addEventListener("click",()=>{this.viewport.addScale(-$n)},!1),s.addEventListener("click",()=>{this.viewport.addScale($n)},!1),n.addEventListener("click",()=>{this.viewport.setScale(1)},!1),{el:l,scaleLabelEl:n}}getScalePercent(t){return`${Math.floor(t*100)}%`}}class md{constructor(t,e){_(this,"selectNodes");this.selectNodes=t.getSelectNodes(),t.on("select",s=>{var m;const n=this.selectNodes;this.selectNodes=s;const l=s[0];if(s.length!==1||l.isInvisible()||this.selectNodes[0].id&&this.selectNodes[0].id===((m=n[0])==null?void 0:m.id))return;const c=l.getBBox(),o=e.getViewbox();let h=o.x,g=o.y;c.x<o.x?h=c.x-15:c.x2>o.x+o.width&&(h=c.x2-o.width+15),c.y<o.y?g=c.y-15:c.y2>o.y+o.height&&(g=c.y2-o.height+15),!(h===o.x&&g===o.y)&&e.translateTo(h,g)})}}class yd{constructor(t){_(this,"undoManager");this.undoManager=new Zl(t)}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}}const cs=(r,t,e)=>{const s=r.get(t);if(!s)return;const n={...s,...e};r.set(t,n)},wd=r=>{let t;const e=r.values();for(let s of e)s.isRoot&&(t=s);return t},na=(r,t)=>{const e=r.entries();let s;for(let n of e)n[1].children.includes(t)&&(s=n);return s},Pn="Main Topic",Yn="Subtopic";class vd{constructor(t,e){this.ydoc=t,this.nodeDataMap=e}addChildNode(t,e,s){var c;const n=this.nodeDataMap.get(t);if(!n)return;let l=n.direction;if(n.isRoot){const o=(c=n.children)==null?void 0:c.reduce((h,g)=>{const m=this.nodeDataMap.get(g);return(m==null?void 0:m.direction)===_t.LEFT?h[0]+=1:h[1]+=1,h},[0,0]);l=o[1]>o[0]?_t.LEFT:_t.RIGHT}this.ydoc.transact(()=>{this.nodeDataMap.set(s,{label:e===Wt.firstLevel?Pn:Yn,direction:l,children:[]});const o=this.nodeDataMap.get(t).children;o.push(s),cs(this.nodeDataMap,t,{children:o,isExpand:!0})})}addBrotherNode(t,e,s){const n=this.nodeDataMap.get(t);if(n){if(n.isRoot)return this.addChildNode(t,e,s);this.ydoc.transact(()=>{this.nodeDataMap.set(s,{label:e===Wt.firstLevel?Pn:Yn,direction:n.direction,children:[]});const[l,c]=na(this.nodeDataMap,t),o=c.children;o.push(s),cs(this.nodeDataMap,l,{children:o,isExpand:!0})})}}}class bd{constructor(t,e){this.ydoc=t,this.nodeDataMap=e}removeNode(t){const e=wd(this.nodeDataMap),s=this.getTopNodeIdsInner(["",e],t);s.length!==0&&this.ydoc.transact(()=>{s.forEach(n=>this.removeNodeDataInner(n))})}getTopNodeIdsInner([t,e],s){var l;if(!e)return[];if(!e.isRoot&&s.includes(t))return[t];let n=[];return(l=e.children)==null||l.forEach(c=>{const o=this.getTopNodeIdsInner([c,this.nodeDataMap.get(c)],s);o.length>0&&(n=n.concat(o))}),n}removeNodeDataInner(t){const e=this.nodeDataMap.get(t);e&&(e==null||e.children.forEach(s=>{this.removeNodeDataInner(s)}),this.nodeDataMap.delete(t))}}class xd{constructor(t,e){this.ydoc=t,this.nodeDataMap=e}changeFather({selectionId:t,newFatherId:e,direction:s,childIndex:n}){this.ydoc.transact(()=>{const[l,c]=na(this.nodeDataMap,t),o=c.children;let h=o.findIndex(D=>D===t);h=h===void 0?-1:h,h>-1&&(o.splice(h,1),cs(this.nodeDataMap,l,{children:o}));const g=this.nodeDataMap.get(e),m=g.children,E=n===void 0?m.length:n;g.isRoot?this.spliceChildInRoot({children:m,start:E,childId:t,direction:s}):m.splice(E,0,t),cs(this.nodeDataMap,e,{children:m,isExpand:!0}),this.changeDirection(t,s)})}spliceChildInRoot({children:t,start:e,childId:s,direction:n}){let l=-1,c=0,o=0;for(o=0;o<t.length;o++){const h=this.nodeDataMap.get(t[o]);if((h==null?void 0:h.direction)===n){if(e===c){l=o;break}c++}}l===-1&&(l=o),t.splice(l,0,s)}changeDirection(t,e){const s=this.nodeDataMap.get(t);s&&(cs(this.nodeDataMap,t,{direction:e}),s.children.forEach(n=>this.changeDirection(n,e)))}}const Sd=r=>{const t=r||{root:{children:[],label:"Central Topic",direction:_t.NONE,isRoot:!0}};return Object.keys(t).forEach(e=>{const s=t[e],n=s.isExpand;s.isExpand=n===void 0?!0:n}),t};class kd{constructor(t,e,s){_(this,"ydoc");_(this,"nodeDataMap");_(this,"eventEmitter");_(this,"undoHandler");_(this,"addHandler");_(this,"removeHandler");_(this,"changeFatherHandler");_(this,"preSelectIds",[]);this.selection=t,this.eventEmitter=new ks,this.ydoc=s||new xs,this.nodeDataMap=this.ydoc.getMap("mindmaptree node data map"),e&&Object.keys(e).forEach(n=>{const l=e[n];this.nodeDataMap.set(n,l)}),this.undoHandler=new yd(this.nodeDataMap),this.addHandler=new vd(this.ydoc,this.nodeDataMap),this.removeHandler=new bd(this.ydoc,this.nodeDataMap),this.changeFatherHandler=new xd(this.ydoc,this.nodeDataMap),this.nodeDataMap.observe(n=>{this.eventEmitter.emit("data",{data:n.target.toJSON(),preSelectIds:[...this.preSelectIds]}),this.preSelectIds=[]})}on(t,e){this.eventEmitter.on(t,e)}undo(){this.undoHandler.undo()}redo(){this.undoHandler.redo()}canUndo(){return this.undoHandler.canUndo()}canRedo(){return this.undoHandler.canRedo()}addChildNode(t,e){const s=ci();this.preSelectIds=[s],this.addHandler.addChildNode(t,e,s)}addBrotherNode(t,e){const s=ci();this.preSelectIds=[s],this.addHandler.addBrotherNode(t,e,s)}removeNode(t){const e=this.selection.getRemoveNextNode();e&&(this.preSelectIds=[e.id]),this.removeHandler.removeNode(t)}changeFather(t){this.preSelectIds=[t.selectionId],this.changeFatherHandler.changeFather(t)}update(t,e){cs(this.nodeDataMap,t,e)}}const Gn=[{name:"Alice",color:"#30bced"},{name:"Bob",color:"#6eeb83"},{name:"Ben",color:"#ffbc42"},{name:"Lily",color:"#ecd444"},{name:"Juicy",color:"#ee6352"},{name:"Nana",color:"#9ac2c9"},{name:"Edwin",color:"#8acb88"},{name:"Jimmy",color:"#1be7ff"}],oa=(Number(localStorage.getItem("accessTime"))||0)+1;localStorage.setItem("accessTime",`${oa}`);class _d{constructor(t,e,s,n){_(this,"userSelectList",[]);_(this,"getNodeMap",()=>{const t={};return this.getNodeMapInner(this.root,t),t});_(this,"getNodeMapInner",(t,e)=>{var s;t&&(e[t.id]=t,(s=t.children)==null||s.forEach(n=>{this.getNodeMapInner(n,e)}))});this.selection=e,this.root=s,this.paperWrapper=n;const l=Gn[oa%Gn.length];this.createUserNameDom(l.name),t.on("change",()=>{setTimeout(()=>{const o=Array.from(t.getStates().values()).reduce((g,m)=>{var D,L,I;const E=(D=Object.keys(m))==null?void 0:D[0];if(E){const O=((L=m[E])==null?void 0:L.selectId)||"",q=((I=m[E])==null?void 0:I.color)||"";g.push({user:E,color:q,selectId:O})}return g},[]),h=this.getNodeMap();this.userSelectList.forEach(({selectId:g})=>{const m=h[g];m==null||m.setCollaborateStyle(null)}),o.forEach(({user:g,selectId:m,color:E})=>{if(g===l.name)return;const D=h[m];D==null||D.setCollaborateStyle({name:g,color:E})}),this.userSelectList=o},200)}),this.selection.on("select",()=>{var o;const c=this.selection.getSelectNodes();t.setLocalStateField(l.name,{selectId:((o=c[0])==null?void 0:o.id)||"",color:l.color,timestamp:Date.now()})})}createUserNameDom(t){const e=this.paperWrapper.getWrapperDom(),s=document.createElement("div");s.style.position="fixed",s.style.top="34px",s.style.left="30px",s.innerHTML=`user: ${t}`,e.appendChild(s)}}class Ed{constructor({container:t,data:e,isDebug:s=!1,scale:n,ydoc:l}){_(this,"paperWrapper");_(this,"viewportInteraction");_(this,"tree");_(this,"keyboard");_(this,"multiSelect");_(this,"nodeCreator");_(this,"dataHandler");_(this,"selection");cc({isDebug:s}),this.paperWrapper=new jh(t);const c=this.paperWrapper.getPaper(),o=new Yc(this.paperWrapper,n);this.nodeCreator=new $c({paper:c,viewport:o});const h=Sd(e);this.tree=new sc({viewport:o,data:h,nodeCreator:this.nodeCreator});const g=this.tree.getRoot(),m=new td(g);this.selection=m;const E=new kd(m,h,l);this.dataHandler=E,E.on("data",({data:I,preSelectIds:O})=>{this.tree.render(I),O.length>0&&this.selection.selectByIds(O)});const D=new Jc({viewport:o,selection:m,dataHandler:E,paperWrapper:this.paperWrapper});new Pc({nodeCreator:this.nodeCreator,selection:m,textEditor:D,dataHandler:E}),new md(m,o),this.viewportInteraction=new qc({paperWrapper:this.paperWrapper,viewport:o,root:g});const L=new nd({root:g,tree:this.tree,selection:m,dataHandler:E});this.multiSelect=new sd({paperWrapper:this.paperWrapper,viewport:o,selection:m,toolOperation:L}),this.keyboard=new id({toolOperation:L,selection:m,textEditor:D,multiSelect:this.multiSelect,viewportInteraction:this.viewportInteraction}),new pd({paperWrapper:this.paperWrapper,toolOperation:L,selection:m,dataHandler:E,textEditor:D,viewportInteraction:this.viewportInteraction}),new gd({paperWrapper:this.paperWrapper,viewport:o})}on(t,e){t==="data"&&this.dataHandler.on(t,e)}clear(){this.paperWrapper.clear(),this.nodeCreator.clear(),this.tree.clear(),this.viewportInteraction.clear(),this.multiSelect.clear(),this.keyboard.clear()}bindAwareness(t){new _d(t,this.selection,this.tree.getRoot(),this.paperWrapper)}}const fi=r=>{const t=new URLSearchParams(window.location.search);return Object.fromEntries(t.entries())[r]||""},Cd=()=>{const r=document.createElement("div");r.classList.add("github-link");const t=document.createElement("a");t.classList.add("github-icon"),t.href="https://github.com/RockyRen/mindmaptree",Pt&&r.classList.add("mobile"),r.appendChild(t),document.body.appendChild(r)},Qr=fi("id");class Dd{constructor(t){_(this,"data",null);_(this,"pageKey","page");if(t&&(this.pageKey=t),Qr){const e=localStorage.getItem(`${this.pageKey}-${Qr}`)||"";e&&(this.data=JSON.parse(e))}}getData(){return this.data}save(t){const e=JSON.stringify(t);localStorage.setItem(`${this.pageKey}-${Qr}`,e),console.log("save",e)}}const Yd=({pageName:r,options:t})=>{Cd();const e=new Dd(r),s=e.getData()||(t==null?void 0:t.data),n=new Ed({container:"#container",isDebug:fi("debug")==="1",scale:parseFloat(fi("scale")),...t,data:s});return n.on("data",({data:l})=>{e.save(l)}),n};export{os as A,La as B,Hd as C,Od as D,Hs as E,Fs as F,ys as G,Fd as H,Rd as I,vl as J,ii as K,fs as L,ro as M,Sl as N,Xn as O,ho as P,xs as Q,Yd as R,Pt as S,io as U,Td as a,Id as b,ds as c,$d as d,Wo as e,Ad as f,xi as g,Ud as h,te as i,Vd as j,Qt as k,Ld as l,Wn as m,zd as n,Bd as o,Te as p,Pr as q,wt as r,Me as s,Md as t,Nr as u,Ia as v,St as w,as as x,ce as y,ws as z};
